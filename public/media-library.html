<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Media Library - T4L Ambassador</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <style>
      /* Custom styles for mobile sidebar toggle */
      .sidebar-toggle {
        display: none;
      }
      
      @media (max-width: 768px) {
        .sidebar-toggle {
          display: block;
          position: fixed;
          top: 1rem;
          left: 1rem;
          z-index: 50;
          background: #4b0d7f;
          color: white;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          position: fixed;
          height: 100vh;
          z-index: 40;
        }
        
        .sidebar.active {
          transform: translateX(0);
        }
        
        .overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.5);
          z-index: 30;
        }
        
        .overlay.active {
          display: block;
        }
      }
      
      /* Media Library Styles */
      .media-card {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        border-radius: 12px;
      }
      
      .media-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
      }
      
      .media-thumbnail {
        width: 100%;
        height: 200px;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        position: relative;
        overflow: hidden;
      }
      
      .media-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .media-thumbnail-icon {
        font-size: 48px;
        opacity: 0.7;
      }
      
      .media-info {
        padding: 16px;
        background: white;
      }
      
      .media-title {
        font-weight: 600;
        color: #1a1a1a;
        margin-bottom: 8px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .media-meta {
        font-size: 12px;
        color: #666;
        margin-bottom: 12px;
      }
      
      .media-actions {
        display: flex;
        gap: 8px;
      }
      
      .media-actions button {
        flex: 1;
        padding: 8px 12px;
        border: none;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .btn-view {
        background: #4b0d7f;
        color: white;
      }
      
      .btn-view:hover {
        background: #3a0a61;
      }
      
      .btn-delete {
        background: #f0f0f0;
        color: #d32f2f;
      }
      
      .btn-delete:hover {
        background: #e0e0e0;
      }
      
      .filter-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-right: 8px;
        margin-bottom: 8px;
        border: 2px solid #ddd;
        background: white;
        color: #666;
      }
      
      .filter-badge.active {
        background: #4b0d7f;
        color: white;
        border-color: #4b0d7f;
      }
      
      .filter-badge:hover {
        border-color: #4b0d7f;
      }
      
      .empty-state {
        text-align: center;
        padding: 60px 20px;
      }
      
      .empty-state-icon {
        font-size: 64px;
        margin-bottom: 16px;
      }
      
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 100;
        align-items: center;
        justify-content: center;
      }
      
      .modal.active {
        display: flex;
      }
      
      .modal-content {
        background: white;
        border-radius: 12px;
        padding: 32px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
      }
      
      .modal-header {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #999;
      }
      
      .form-group {
        margin-bottom: 20px;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
      }
      
      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-family: inherit;
        font-size: 14px;
      }
      
      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }
      
      .form-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
      }
      
      .form-actions button {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
      }
      
      .btn-primary {
        background: #4b0d7f;
        color: white;
      }
      
      .btn-primary:hover {
        background: #3a0a61;
      }
      
      .btn-secondary {
        background: #f0f0f0;
        color: #333;
      }
      
      .btn-secondary:hover {
        background: #e0e0e0;
      }
      
      .loading-skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 2s infinite;
      }
      
      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
      
      .grid-cols-1 {
        grid-template-columns: 1fr;
      }
      
      .grid-cols-2 {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .grid-cols-3 {
        grid-template-columns: repeat(3, 1fr);
      }
      
      @media (max-width: 768px) {
        .grid-cols-3 {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      
      @media (max-width: 480px) {
        .grid-cols-2,
        .grid-cols-3 {
          grid-template-columns: 1fr;
        }
      }

      .truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
    </style>
  </head>
  <body class="bg-gray-50 font-sans">
    <!-- Global Notification Script -->
    <script src="/js/notifications.js"></script>
    <!-- Global Ambassador Sidebar -->
    <script src="/js/ambassador-sidebar.js"></script>
    
    <!-- Mobile Sidebar Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="bx bx-menu text-xl"></i>
    </button>
    
    <!-- Overlay for mobile sidebar -->
    <div class="overlay" id="overlay"></div>
    
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <aside class="sidebar w-20 lg:w-20 md:w-20 bg-white shadow-md flex flex-col items-center py-6 space-y-6 z-40">
        <div class="mb-4">
          <div class="bg-[#4b0d7f] text-white px-3 py-2 rounded-xl font-semibold text-sm">T4L</div>
        </div>
        <nav class="flex flex-col space-y-4 text-gray-700 w-full">
          <a href="/ambassador-dashboard.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bxs-home text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Home</span>
          </a>
          <a href="/article-amb.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-edit-alt text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Publishing</span>
          </a>
          <a href="/media-library.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50 bg-purple-50">
            <i class="bx bx-image text-2xl text-[#4b0d9f] group-hover:scale-110 transition-transform duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-[#4b0d9f] transition-colors duration-200">Media</span>
          </a>
          <a href="/Impactlog.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-line-chart text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Impact Log</span>
          </a>
          <a href="/Partner-Calls.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-briefcase text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Partners</span>
          </a>
          <a href="/services.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-briefcase-alt-2 text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Services</span>
          </a>
          <a href="https://www.t4leader.com/event" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-calendar-event text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Events</span>
          </a>
          <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-user text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Profile</span>
          </a>
          <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-cog text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Settings</span>
          </a>
          <div id="logoutBtn" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-red-50">
            <i class="bx bx-log-out text-2xl group-hover:text-red-600 group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-red-600 transition-colors duration-200">Logout</span>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 p-4 md:p-6 lg:p-6">
        <!-- Top Navbar -->
        <header class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
          <h1 class="text-2xl font-semibold text-gray-900">Media Library</h1>
          <div class="flex items-center space-x-4 w-full md:w-auto">
            <div class="relative flex-1 md:flex-none">
              <input
                type="text"
                placeholder="Search media..."
                id="searchInput"
                class="border border-gray-400 rounded-full pl-10 pr-4 py-2 text-sm w-full md:w-80 focus:outline-none focus:ring-2 focus:ring-purple-500"
              />
              <i class="bx bx-search absolute left-3 top-2.5 text-gray-900"></i>
            </div>
            <div class="flex items-center space-x-2">
              <i class="bx bx-bell text-2xl text-gray-900"></i>
              <div class="w-10 h-10 bg-[#4b0d7f] flex items-center justify-center rounded-full font-bold text-white" id="userAvatar">
                SM
              </div>
            </div>
          </div>
        </header>

        <!-- Hero Section -->
        <section class="bg-gradient-to-r from-[#4b0d7f] to-[#a36737] text-white p-4 md:p-6 rounded-2xl mb-6 shadow-md">
          <div class="flex justify-between items-start md:items-center gap-4">
            <div>
              <h2 class="text-xl md:text-2xl font-semibold mb-2">Organize Your Creative Assets</h2>
              <p class="text-sm opacity-90">Keep all your designs, images, and media in one place</p>
            </div>
            <button id="addMediaBtn" class="bg-white text-[#4b0d7f] px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-colors whitespace-nowrap flex items-center gap-2">
              <i class="bx bx-plus text-xl"></i>
              Add Media
            </button>
          </div>
        </section>

        <!-- Filter Section -->
        <section class="mb-6">
          <h3 class="text-sm font-semibold text-gray-900 mb-3">Filter by Type:</h3>
          <div class="flex flex-wrap">
            <span class="filter-badge active" data-filter="all">All Media</span>
            <span class="filter-badge" data-filter="canva">üé® Canva Designs</span>
            <span class="filter-badge" data-filter="image">üñºÔ∏è Images</span>
            <span class="filter-badge" data-filter="video">üé• Videos</span>
            <span class="filter-badge" data-filter="document">üìÑ Documents</span>
            <span class="filter-badge" data-filter="other">üì¶ Other</span>
          </div>
        </section>

        <!-- Media Grid -->
        <section>
          <div id="mediaGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Loading skeletons -->
            <div class="media-card bg-white shadow rounded-lg border border-gray-100">
              <div class="media-thumbnail loading-skeleton"></div>
              <div class="media-info">
                <div class="h-4 bg-gray-200 rounded mb-2 loading-skeleton"></div>
                <div class="h-3 bg-gray-100 rounded loading-skeleton"></div>
              </div>
            </div>
            <div class="media-card bg-white shadow rounded-lg border border-gray-100">
              <div class="media-thumbnail loading-skeleton"></div>
              <div class="media-info">
                <div class="h-4 bg-gray-200 rounded mb-2 loading-skeleton"></div>
                <div class="h-3 bg-gray-100 rounded loading-skeleton"></div>
              </div>
            </div>
            <div class="media-card bg-white shadow rounded-lg border border-gray-100">
              <div class="media-thumbnail loading-skeleton"></div>
              <div class="media-info">
                <div class="h-4 bg-gray-200 rounded mb-2 loading-skeleton"></div>
                <div class="h-3 bg-gray-100 rounded loading-skeleton"></div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- Add Media Modal -->
    <div class="modal" id="addMediaModal">
      <div class="modal-content">
        <div class="modal-header">
          <span>Add New Media</span>
          <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <form id="addMediaForm">
          <div class="form-group">
            <label for="mediaTitle">Media Title</label>
            <input type="text" id="mediaTitle" name="title" required placeholder="e.g., Product Launch Canva Design" />
          </div>
          
          <div class="form-group">
            <label for="mediaType">Media Type</label>
            <select id="mediaType" name="type" required>
              <option value="">Select a type...</option>
              <option value="canva">Canva Design</option>
              <option value="image">Image</option>
              <option value="video">Video</option>
              <option value="document">Document</option>
              <option value="other">Other</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="mediaUrl">Media URL or Link</label>
            <input type="url" id="mediaUrl" name="url" required placeholder="https://www.canva.com/design/..." />
          </div>
          
          <div class="form-group">
            <label for="mediaDescription">Description (Optional)</label>
            <textarea id="mediaDescription" name="description" placeholder="Add notes about this media..."></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-secondary" id="cancelBtn">Cancel</button>
            <button type="submit" class="btn-primary">Save Media</button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // ============================================
      // MEDIA LIBRARY STATE & CONFIG
      // ============================================
      const MEDIA_TYPE_ICONS = {
        'canva': 'üé®',
        'image': 'üñºÔ∏è',
        'video': 'üé•',
        'document': 'üìÑ',
        'other': 'üì¶'
      };

      const MEDIA_TYPE_COLORS = {
        'canva': 'from-purple-100 to-purple-200',
        'image': 'from-pink-100 to-pink-200',
        'video': 'from-red-100 to-red-200',
        'document': 'from-blue-100 to-blue-200',
        'other': 'from-gray-100 to-gray-200'
      };

      let allMedia = [];
      let currentFilter = 'all';
      let currentSearchQuery = '';

      // ============================================
      // DOM INITIALIZATION
      // ============================================
      function initializeDOM() {
        // Mobile sidebar toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.getElementById('overlay');
        
        if (sidebarToggle && sidebar && overlay) {
          sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
          });
          
          overlay.addEventListener('click', function() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
          });
        }

        // Modal controls
        const addMediaBtn = document.getElementById('addMediaBtn');
        const closeModal = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const addMediaModal = document.getElementById('addMediaModal');
        
        if (addMediaBtn) {
          addMediaBtn.addEventListener('click', () => {
            addMediaModal.classList.add('active');
          });
        }
        
        if (closeModal) {
          closeModal.addEventListener('click', () => {
            addMediaModal.classList.remove('active');
          });
        }
        
        if (cancelBtn) {
          cancelBtn.addEventListener('click', () => {
            addMediaModal.classList.remove('active');
          });
        }

        // Search input
        const searchInput = document.getElementById('searchInput');
        if (searchInput) {
          searchInput.addEventListener('input', (e) => {
            currentSearchQuery = e.target.value.toLowerCase();
            renderMedia();
          });
        }

        // Filter badges
        document.querySelectorAll('.filter-badge').forEach(badge => {
          badge.addEventListener('click', () => {
            document.querySelectorAll('.filter-badge').forEach(b => b.classList.remove('active'));
            badge.classList.add('active');
            currentFilter = badge.dataset.filter;
            renderMedia();
          });
        });

        // Form submission
        const addMediaForm = document.getElementById('addMediaForm');
        if (addMediaForm) {
          addMediaForm.addEventListener('submit', handleAddMedia);
        }

        // Close modal on outside click
        if (addMediaModal) {
          addMediaModal.addEventListener('click', (e) => {
            if (e.target === addMediaModal) {
              addMediaModal.classList.remove('active');
            }
          });
        }

        // Logout
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function() {
            fetch('/api/logout', { method: 'POST' })
              .then(() => {
                window.location.href = '/signin';
              })
              .catch(error => {
                console.error('Logout error:', error);
                window.location.href = '/signin';
              });
          });
        }
      }

      // ============================================
      // LOAD USER DATA
      // ============================================
      async function loadUserData() {
        try {
          const response = await fetch('/api/me');
          if (!response.ok) {
            throw new Error('Not authenticated');
          }
          const data = await response.json();
          
          const avatarElement = document.getElementById('userAvatar');
          if (avatarElement && data.name) {
            const initials = data.name.split(' ')
              .map(word => word[0])
              .join('')
              .toUpperCase()
              .substring(0, 2);
            avatarElement.textContent = initials;
          }
        } catch (error) {
          console.error('Error loading user data:', error);
          window.location.href = '/signin';
        }
      }

      // ============================================
      // LOAD MEDIA FROM API
      // ============================================
      async function loadMedia() {
        try {
          console.log('üì¶ Loading media...');
          const response = await fetch('/api/media', { credentials: 'include' });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          allMedia = data.media || [];
          console.log(`‚úÖ Loaded ${allMedia.length} media items`);
          
          renderMedia();
        } catch (error) {
          console.error('‚ùå Error loading media:', error);
          renderEmptyState();
        }
      }

      // ============================================
      // RENDER MEDIA GRID
      // ============================================
      function renderMedia() {
        const mediaGrid = document.getElementById('mediaGrid');
        if (!mediaGrid) return;

        let filteredMedia = allMedia;

        // Apply filter
        if (currentFilter !== 'all') {
          filteredMedia = filteredMedia.filter(m => m.type === currentFilter);
        }

        // Apply search
        if (currentSearchQuery) {
          filteredMedia = filteredMedia.filter(m => 
            m.title.toLowerCase().includes(currentSearchQuery) ||
            (m.description && m.description.toLowerCase().includes(currentSearchQuery))
          );
        }

        if (filteredMedia.length === 0) {
          renderEmptyState();
          return;
        }

        mediaGrid.innerHTML = filteredMedia.map(media => createMediaCard(media)).join('');
      }

      // ============================================
      // CREATE MEDIA CARD
      // ============================================
      function createMediaCard(media) {
        const icon = MEDIA_TYPE_ICONS[media.type] || 'üì¶';
        const colorGradient = MEDIA_TYPE_COLORS[media.type] || 'from-gray-100 to-gray-200';
        const formattedDate = new Date(media.created_at).toLocaleDateString('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric'
        });

        return `
          <div class="media-card bg-white shadow rounded-lg border border-gray-100">
            <div class="media-thumbnail bg-gradient-to-br ${colorGradient} cursor-pointer" onclick="openMedia('${media.id}', '${media.url.replace(/'/g, "\\'")}')">
              <div class="media-thumbnail-icon">${icon}</div>
            </div>
            <div class="media-info">
              <div class="media-title">${escapeHtml(media.title)}</div>
              <div class="media-meta">${formattedDate} ‚Ä¢ ${media.type}</div>
              ${media.description ? `<div class="text-xs text-gray-500 mb-2 line-clamp-2">${escapeHtml(media.description)}</div>` : ''}
              <div class="media-actions">
                <button class="btn-view" onclick="openMedia('${media.id}', '${media.url.replace(/'/g, "\\'")}')">
                  <i class="bx bx-link"></i> Open
                </button>
                <button class="btn-delete" onclick="deleteMedia('${media.id}')">
                  <i class="bx bx-trash"></i>
                </button>
              </div>
            </div>
          </div>
        `;
      }

      // ============================================
      // OPEN MEDIA
      // ============================================
      function openMedia(id, url) {
        console.log(`Opening media: ${id}`);
        try {
          // Check if URL is valid
          new URL(url);
          window.open(url, '_blank');
        } catch (e) {
          console.error('Invalid URL:', url);
          alert('Invalid media URL');
        }
      }

      // ============================================
      // DELETE MEDIA
      // ============================================
      async function deleteMedia(id) {
        if (!confirm('Are you sure you want to delete this media?')) {
          return;
        }

        try {
          const response = await fetch(`/api/media/${id}`, {
            method: 'DELETE',
            credentials: 'include'
          });

          if (!response.ok) {
            throw new Error('Failed to delete media');
          }

          console.log('‚úÖ Media deleted');
          loadMedia(); // Reload media list
        } catch (error) {
          console.error('‚ùå Error deleting media:', error);
          alert('Failed to delete media');
        }
      }

      // ============================================
      // HANDLE ADD MEDIA
      // ============================================
      async function handleAddMedia(e) {
        e.preventDefault();

        const title = document.getElementById('mediaTitle').value;
        const type = document.getElementById('mediaType').value;
        const url = document.getElementById('mediaUrl').value;
        const description = document.getElementById('mediaDescription').value;

        try {
          const response = await fetch('/api/media', {
            method: 'POST',
            credentials: 'include',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              title,
              type,
              url,
              description
            })
          });

          if (!response.ok) {
            throw new Error('Failed to add media');
          }

          console.log('‚úÖ Media added successfully');
          
          // Reset form
          document.getElementById('addMediaForm').reset();
          document.getElementById('addMediaModal').classList.remove('active');
          
          // Reload media
          loadMedia();
        } catch (error) {
          console.error('‚ùå Error adding media:', error);
          alert('Failed to add media');
        }
      }

      // ============================================
      // RENDER EMPTY STATE
      // ============================================
      function renderEmptyState() {
        const mediaGrid = document.getElementById('mediaGrid');
        if (!mediaGrid) return;

        mediaGrid.innerHTML = `
          <div class="col-span-full">
            <div class="empty-state">
              <div class="empty-state-icon">üì¶</div>
              <h3 class="text-xl font-semibold text-gray-900 mb-2">No media found</h3>
              <p class="text-gray-500 mb-6">
                ${currentFilter !== 'all' ? `No ${currentFilter} items yet` : `Start by adding your first media`}
              </p>
              <button id="emptyStateAddBtn" class="bg-[#4b0d7f] text-white px-6 py-2 rounded-lg font-semibold hover:bg-[#3a0a61] transition-colors">
                Add Your First Media
              </button>
            </div>
          </div>
        `;

        const emptyStateAddBtn = document.getElementById('emptyStateAddBtn');
        if (emptyStateAddBtn) {
          emptyStateAddBtn.addEventListener('click', () => {
            document.getElementById('addMediaModal').classList.add('active');
          });
        }
      }

      // ============================================
      // HELPER FUNCTIONS
      // ============================================
      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // ============================================
      // INITIALIZE ON PAGE LOAD
      // ============================================
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Media Library initializing...');
        initializeDOM();
        loadUserData();
        loadMedia();
        console.log('‚úÖ Media Library initialized');
      });
    </script>
  </body>
</html>
