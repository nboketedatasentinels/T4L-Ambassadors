<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>T4L Ambassador Dashboard</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <style>
      /* Custom styles for mobile sidebar toggle */
      .sidebar-toggle {
        display: none;
      }
      
      @media (max-width: 768px) {
        .sidebar-toggle {
          display: block;
          position: fixed;
          top: 1rem;
          left: 1rem;
          z-index: 50;
          background: #4b0d7f;
          color: white;
          border-radius: 50%;
          width: 40px;
          height: 40px;
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar {
          transform: translateX(-100%);
          transition: transform 0.3s ease;
          position: fixed;
          height: 100vh;
          z-index: 40;
        }
        
        .sidebar.active {
          transform: translateX(0);
        }
        
        .overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.5);
          z-index: 30;
        }
        
        .overlay.active {
          display: block;
        }
      }
      
      /* Add line clamp utility */
      .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }
      
      .truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      /* Video specific styles */
      .video-preview {
        transition: all 0.3s ease;
      }
      
      .video-preview:hover {
        transform: scale(1.02);
      }
      
      .play-button {
        transition: all 0.3s ease;
      }
      
      .play-button:hover {
        transform: scale(1.1);
      }
      
      /* Loading animation */
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      
      .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
    </style>
  </head>
  <body class="bg-gray-50 font-sans">
    <!-- Global Notification Script -->
    <script src="/js/notifications.js"></script>
    <!-- Global Ambassador Sidebar -->
    <script src="/js/ambassador-sidebar.js"></script>
    <!-- Mobile Sidebar Toggle -->
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="bx bx-menu text-xl"></i>
    </button>
    
    <!-- Overlay for mobile sidebar -->
    <div class="overlay" id="overlay"></div>
    
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <aside class="sidebar w-20 lg:w-20 md:w-20 bg-white shadow-md flex flex-col items-center py-6 space-y-6 z-40">
        <div class="mb-4">
          <div class="bg-[#4b0d7f] text-white px-3 py-2 rounded-xl font-semibold text-sm">T4L</div>
        </div>
        <nav class="flex flex-col space-y-4 text-gray-700 w-full">
          <a href="/ambassador-dashboard.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50 bg-purple-50">
            <i class="bx bxs-home text-2xl text-[#4b0d9f] group-hover:scale-110 transition-transform duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-[#4b0d9f] transition-colors duration-200">Home</span>
          </a>
          <a href="/article-amb.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-edit-alt text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Publishing</span>
          </a>
          <a href="/journey.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-line-chart text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Impact Log</span>
          </a>
          <a href="/Partner-Calls.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-briefcase text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Partners</span>
          </a>
        <a href="/services.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-briefcase-alt-2 text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Services</span>
        </a>
          <a href="https://www.t4leader.com/event" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-calendar-event text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Events</span>
          </a>
          <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-user text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Profile</span>
          </a>
          <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
            <i class="bx bx-cog text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Settings</span>
          </a>
          <div id="logoutBtn" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-red-50">
            <i class="bx bx-log-out text-2xl group-hover:text-red-600 group-hover:scale-110 transition-all duration-200"></i>
            <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-red-600 transition-colors duration-200">Logout</span>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 p-4 md:p-6 lg:p-6">
        <!-- Top Navbar -->
        <header class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
          <h1 class="text-xl font-semibold text-gray-900">T4L Ambassador</h1>
          <div class="flex items-center space-x-4 w-full md:w-auto">
            <div class="relative flex-1 md:flex-none">
              <input
                type="text"
                placeholder="Search articles, events, partners..."
                class="border border-gray-400 rounded-full pl-10 pr-4 py-2 text-sm w-full md:w-80 focus:outline-none focus:ring-2 focus:ring-purple-500"
              />
              <i class="bx bx-search absolute left-3 top-2.5 text-gray-900"></i>
            </div>
            <div class="flex items-center space-x-2">
              <i class="bx bx-bell text-2xl text-gray-900"></i>
              <div class="w-10 h-10 bg-[#4b0d7f] flex items-center justify-center rounded-full font-bold text-white" id="userAvatar">
                SM
              </div>
            </div>
          </div>
        </header>

        <!-- Hero Section -->
        <section
          class="bg-gradient-to-r from-[#4b0d7f] to-[#a36737] text-white p-4 md:p-6 rounded-2xl mb-6 shadow-md"
        >
          <h2 class="text-xl md:text-2xl font-semibold mb-2" id="welcomeHeading">Welcome back</h2>
          <p class="text-sm mb-6" id="heroDescription">
            You're in Month 1 <span class="font-semibold">Visibility Stage</span><br />
            There's an opportunity for you to be featured on our next podcast!
          </p>

          <div class="flex flex-col md:flex-row gap-4 items-stretch">
            <div
              class="flex-1 bg-white/20 backdrop-blur-md px-4 md:px-6 py-4 rounded-lg flex flex-col justify-center shadow-sm"
              id="nextMilestoneCard"
            >
              <p class="font-semibold text-sm flex items-center gap-2">
                <i class="bx bx-target-lock text-xl"></i>
                Next Milestone
              </p>
              <p class="text-base mt-1 font-medium" id="nextMilestoneText">Loading...</p>
            </div>

            <div
              class="flex-1 bg-white/20 backdrop-blur-md px-4 md:px-6 py-4 rounded-lg flex flex-col justify-center shadow-sm"
              id="journeyStatsCard"
            >
              <p class="font-semibold text-sm flex items-center gap-2">
                <i class="bx bx-calendar text-xl"></i>
                <span id="daysInProgramLabel">Journey Progress</span>
              </p>
              <p class="text-base mt-1 font-medium" id="daysInProgramText">Loading...</p>
            </div>

            <!-- Join Your Tribe Button -->
            <a href="https://www.youtube.com/@T4Leaders/podcasts"
              class="flex items-center justify-center gap-4 bg-white/20 backdrop-blur-md px-4 md:px-6 py-4 rounded-lg shadow-sm hover:shadow-md transition-all flex-1"
            >
            <i class="bx bx-microphone text-xl"></i>
              <span class="font-medium">Discover Our Podcast Channel</span>
          </a>
          </div>
        </section>

        <!-- Stats -->
        <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-6">
          <!-- Journey Progress -->
          <a href="/journey.html"
            class="bg-white border border-purple-300 shadow hover:shadow-2xl rounded-xl p-4 md:p-5 text-center transition-all hover:-translate-y-1 hover:border-purple-500"
          >
            <i class="bx bx-trending-up text-3xl text-purple-600 mx-auto mb-2"></i>
            <p class="font-bold text-black text-lg" id="journeyProgress">25%</p>
            <p class="text-black text-sm">Journey Progress</p>
            <p class="text-black text-xs" id="journeyMonth">Month 3 of 12</p>
        </a>

          <!-- Completed Tasks -->
          <a href="/journey.html"
            class="bg-white border border-green-300 shadow hover:shadow-2xl rounded-xl p-4 md:p-5 text-center transition-all hover:-translate-y-1 hover:border-green-500"
          >
            <i class="bx bx-check-circle text-3xl text-green-600 mx-auto mb-2"></i>
            <p class="font-bold text-black text-lg" id="completedTasksCount">--</p>
            <p class="text-black text-sm">Completed Tasks</p>
            <p class="text-black text-xs" id="upcomingTasksCount">-- upcoming</p>
          </a>

          <!-- Article Due -->
          <a href="/article-amb.html"
            class="bg-white border border-blue-300 shadow hover:shadow-2xl rounded-xl p-4 md:p-5 text-center transition-all hover:-translate-y-1 hover:border-blue-500"
          >
            <i class="bx bx-edit text-3xl text-blue-600 mx-auto mb-2"></i>
            <p class="font-bold text-black text-lg" id="articlesPendingCount">--</p>
            <p class="text-black text-sm">Articles Pending</p>
            <p class="text-black text-xs" id="nextArticleDue">Next due: --</p>
          </a>

          <!-- Partner Application -->
          <a href="/Partner-Calls.html"
            class="bg-white border border-yellow-300 shadow hover:shadow-2xl rounded-xl p-4 md:p-5 text-center transition-all hover:-translate-y-1 hover:border-yellow-500"
          >
            <i class="bx bx-briefcase text-3xl text-yellow-600 mx-auto mb-2"></i>
            <p class="font-bold text-black text-lg" id="applicationsCount">--</p>
            <p class="text-black text-sm">Partner Applications</p>
            <p class="text-black text-xs" id="applicationsStatus">--</p>
          </a>
        </section>

        <!-- Middle Section -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
          <!-- Video -->
          <div class="bg-white rounded-2xl p-4 md:p-6 lg:col-span-2 border border-gray-100 flex flex-col">
            <!-- Header -->
            <div class="flex justify-between items-center mb-4">
              <h4 class="font-semibold text-gray-900 text-lg" id="videoTitle">This Month's Video</h4>
              <a href="/journey.html" class="text-purple-600 text-sm font-medium hover:text-purple-700 transition-colors">View Journey</a>
            </div>

            <!-- Video Container -->
            <div id="videoContainer" class="rounded-2xl min-h-[16rem] relative overflow-hidden">
              <!-- Loading State -->
              <div class="flex flex-col items-center justify-center h-full bg-gradient-to-br from-purple-50 to-pink-50">
                <div class="animate-pulse flex flex-col items-center">
                  <div class="bg-white rounded-full p-4 mb-4">
                    <i class="bx bx-loader-alt text-3xl text-purple-600 animate-spin"></i>
                  </div>
                  <p class="text-gray-700 font-medium">Loading your video...</p>
                </div>
              </div>
            </div>

            <!-- Video Info -->
            <div class="text-center mt-4">
              <p class="font-semibold text-gray-900" id="videoDescription">Loading...</p>
              <p class="text-sm text-gray-500" id="videoMeta">Preparing your journey content</p>
            </div>


          </div>

          <!-- Events + Partner Calls Column -->
          <div class="flex flex-col gap-6">
            <!-- Events -->
            <div class="bg-white rounded-2xl p-4 md:p-6 border border-gray-100">
              <div class="flex justify-between items-center mb-4">
                <h4 class="font-semibold text-gray-900 text-lg">Tasks</h4>
              </div>
              <div class="space-y-3">
                <!-- Event 1 -->
                <a href="https://www.t4leader.com/ambassador-events" target="_blank" rel="noopener noreferrer" class="block">
                  <div class="border border-gray-200 rounded-2xl p-4 hover:border-purple-300 hover:shadow-sm transition-all cursor-pointer">
                    <div class="flex items-start gap-3">
                      <div class="bg-purple-100 rounded-xl p-2 flex-shrink-0">
                        <i class="bx bxs-group text-purple-600 text-xl"></i>
                      </div>
                      <div class="flex-1">
                        <p class="font-semibold text-gray-900 text-sm mb-1">Ambassador Events</p>
                      </div>
                    </div>
                  </div>
                </a>

                <!-- Event 2 - Shameless Podcast -->
                <a href="https://cal.com/shameless-podcast-t4l/20-mins-shameless-guest-pre-interview-call?month=2025-11" 
                   target="_blank"
                   renderer="_blank"
                   class="block">
                  <div class="border border-gray-200 rounded-2xl p-4 hover:border-purple-300 hover:shadow-sm transition-all cursor-pointer">
                    <div class="flex items-start gap-3">
                      <div class="bg-purple-100 rounded-xl p-2 flex-shrink-0">
                        <i class="bx bx-microphone text-purple-600 text-xl"></i>
                      </div>
                      <div class="flex-1">
                        <p class="font-semibold text-gray-900 text-sm mb-1">Shameless Podcast-Booking</p>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            </div>

            <!-- Partner Calls -->
            <div class="bg-white rounded-2xl p-4 md:p-6 border border-gray-100">
              <div class="flex justify-between items-center mb-4">
                <h4 class="font-semibold text-gray-900 text-lg">Partner Calls</h4>
                <a href="/Partner-Calls.html" class="text-purple-600 text-sm font-medium hover:text-purple-700 transition-colors">View all</a>
              </div>
              <div class="space-y-3" id="partnerCallsContainer">
                <!-- Loading state -->
                <div class="flex justify-center items-center py-8">
                  <div class="animate-pulse flex flex-col items-center">
                    <div class="bg-purple-100 rounded-full p-3 mb-2">
                      <i class="bx bx-loader-alt text-2xl text-purple-600 animate-spin"></i>
                    </div>
                    <p class="text-gray-500 text-sm">Loading partner opportunities...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>


      </main>
    </div>

    <script>
      // ============================================
      // VIDEO CONFIGURATION - MATCHES SERVER.JS EXACTLY
      // ============================================
      const VIDEO_CONFIG = [
        {
          month: 1,
          title: "FOUNDATION",
          url: "https://www.canva.com/design/DAG1M6MU20c/C1-a9vTfy3AOESPfRhyxfQ/watch?embed",
          description: "Foundation Set: Onboarding complete, first course done",
          duration: "5:30 mins"
        },
        {
          month: 2,
          title: "OPTIMIZE",
          url: "https://www.canva.com/design/DAGymyxxfQs/vtkXrZ8joa0giowAh60-zg/watch?embed",
          description: "Optimized Presence: Profile updated, first article submitted",
          duration: "6:15 mins"
        },
        {
          month: 3,
          title: "ENGAGE",
          url: "https://www.canva.com/design/DAGym0x892o/YmDTuaFm1nNjSaJYa93ePA/watch?embed",
          description: "Engaged Member: Building relationships, consistent content",
          duration: "5:45 mins"
        },
        {
          month: 4,
          title: "LEAD",
          url: "https://www.canva.com/design/DAGymzmB9zo/Oz_eCZ8_EDoXnTeseB6R-A/watch?embed",
          description: "Leadership Activated: Growing visibility, all courses complete",
          duration: "7:00 mins"
        },
        {
          month: 5,
          title: "AMPLIFY",
          url: "https://www.canva.com/design/DAGym1aI8Gw/Sf85oXevN7qOm5zvehr9dQ/watch?embed",
          description: "Amplified Impact: Leading initiatives, consistent support",
          duration: "6:30 mins"
        },
        {
          month: 6,
          title: "MIDPOINT",
          url: "https://www.canva.com/design/DAGym9YIUZk/OIRe6vWYWkaZjWLuMomzrg/watch?embed",
          description: "Halfway Strong: Story shared, momentum building",
          duration: "8:00 mins"
        },
        {
          month: 7,
          title: "VISIBILITY",
          url: "https://www.canva.com/design/DAGym2_NkFI/NLk8fNcIBNm7mX3lT5mJGQ/watch?embed",
          description: "Visible Leader: Podcast prep, strong content cadence",
          duration: "6:45 mins"
        },
        {
          month: 8,
          title: "EXPAND",
          url: "https://www.canva.com/design/DAGzJ0qBXKM/JeRKp6jCYA88iE3RJBUvGA/watch?embed",
          description: "Expanded Reach: Podcast recorded, portfolio growing",
          duration: "7:15 mins"
        },
        {
          month: 9,
          title: "CONNECT",
          url: "https://www.canva.com/design/DAGynDXe7nM/XwF5fSUo3GJfpJBR4sO4Vg/watch?embed",
          description: "Connected Leader: Deep relationships, podcast live",
          duration: "6:00 mins"
        },
        {
          month: 10,
          title: "ACCELERATE",
          url: "https://www.canva.com/design/DAGynMCn0XU/-9LPKLzn5Zc6W5bJS8ktXQ/watch?embed",
          description: "Accelerating: Final articles, opportunities in pipeline",
          duration: "7:30 mins"
        },
        {
          month: 11,
          title: "CELEBRATE",
          url: "https://www.canva.com/design/DAGynKgil_I/FVdnkZFWNsKo1iBsbX7omg/watch?embed",
          description: "Celebrating: Year documented, impact quantified",
          duration: "8:15 mins"
        },
        {
          month: 12,
          title: "RENEW",
          url: "https://www.canva.com/design/DAGynMcNxQI/INWdK-bvAm30aMLK45OMfw/watch?embed",
          description: "Transformation Complete: Full year tracked, portfolio built",
          duration: "9:00 mins"
        }
      ];

      // ============================================
      // PLAY VIDEO FUNCTION - FIXED WITH AUTOPLAY
      // ============================================
      function playVideo() {
        console.log('üé¨ Play button clicked!');
        const videoContainer = document.getElementById('videoContainer');
        const currentVideo = window.currentVideo;
        
        if (videoContainer && currentVideo) {
          console.log('‚ñ∂Ô∏è Loading video with AUTOPLAY:', currentVideo.title);
          
          // Clean URL and ensure autoplay is enabled
          let playUrl = currentVideo.url.split('?')[0];
          playUrl += '?autoplay=1'; // Add autoplay parameter
          
          console.log('üîä Final URL:', playUrl);
          
          videoContainer.innerHTML = `
            <div class="relative w-full rounded-2xl overflow-hidden shadow-2xl video-preview" style="padding-top: 56.25%;">
              <iframe 
                class="absolute top-0 left-0 w-full h-full border-0"
                src="${playUrl}"
                allow="autoplay; fullscreen; accelerometer; gyroscope; picture-in-picture; clipboard-write"
                allowfullscreen
                frameborder="0"
                title="Month ${currentVideo.month}: ${currentVideo.title}">
              </iframe>
            </div>
            
            <!-- Autoplay info message -->
            <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
              <div class="flex items-start gap-2">
                <i class="bx bx-check-circle text-green-600 text-lg mt-0.5"></i>
                <div>
                  <p class="text-sm text-green-800 font-medium">Video is playing automatically</p>
                  <p class="text-xs text-green-600 mt-1">If you don't hear sound, check your browser's autoplay settings</p>
                </div>
              </div>
            </div>
          `;
          
          console.log('‚úÖ Video loaded with autoplay enabled');
          
        } else {
          console.error('‚ùå Video container or current video not found');
          showVideoError();
        }
      }

      // ============================================
      // SHOW VIDEO ERROR STATE
      // ============================================
      function showVideoError() {
        const videoContainer = document.getElementById('videoContainer');
        if (videoContainer) {
          videoContainer.innerHTML = `
            <div class="flex flex-col items-center justify-center p-8 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl">
              <i class="bx bx-error-circle text-5xl text-red-500 mb-4"></i>
              <p class="text-gray-700 font-medium mb-2">Unable to load video</p>
              <p class="text-gray-500 text-sm text-center mb-4">Please refresh the page or contact support</p>
              <button onclick="loadCurrentMonthVideo()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                <i class="bx bx-refresh mr-2"></i> Try Again
              </button>
            </div>
          `;
        }
      }

      // Helper functions
      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      function getPostTypeIcon(postType) {
        const icons = {
          'speaking': 'bx-microphone',
          'podcast': 'bx-podcast',
          'webinar': 'bx-video',
          'volunteering': 'bx-heart',
          'general': 'bx-briefcase'
        };
        return icons[postType?.toLowerCase()] || 'bx-briefcase';
      }

      function formatDate(dateString) {
        try {
          const date = new Date(dateString);
          return date.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric',
            year: 'numeric'
          });
        } catch (e) {
          return 'Recently';
        }
      }

      // ============================================
      // LOAD CURRENT MONTH'S VIDEO - FIXED
      // ============================================
      async function loadCurrentMonthVideo() {
        try {
          console.log('üé• Loading video for current month...');
          
          const response = await fetch('/api/journey');
          
          if (!response.ok) {
            throw new Error('Failed to load journey data');
          }
          
          const journeyData = await response.json();
          
          // Get currentMonth from API response
          let currentMonth = journeyData.currentMonth || 1;
          currentMonth = Math.max(1, Math.min(12, currentMonth));
          
          console.log(`üìÖ User is in Month ${currentMonth}`);
          
          // Get the correct video for this month
          const currentVideo = VIDEO_CONFIG.find(v => v.month === currentMonth);
          
          if (!currentVideo) {
            throw new Error('Video configuration missing');
          }
          
          console.log('üé¨ Selected video:', currentVideo.title);
          
          // Store current video globally
          window.currentVideo = currentVideo;
          
          // ============================================
          // UPDATE STATS SECTION - SAME CALCULATION AS JOURNEY PAGE
          // ============================================
          const completedTasks = journeyData.completedTasks || {};
          const months = journeyData.months || [];
          
          // Calculate overall progress EXACTLY like journey page (lines 3032-3035)
          const overallProgress = months.length > 0 ? months.reduce((acc, m) => {
            const completed = m.tasks.filter(task => completedTasks[`${m.month}-${task.id}`]).length;
            return acc + (completed / m.tasks.length);
          }, 0) / months.length * 100 : 0;
          
          const journeyProgress = document.getElementById('journeyProgress');
          if (journeyProgress) {
            journeyProgress.textContent = `${Math.round(overallProgress)}%`;
          }

          const journeyMonth = document.getElementById('journeyMonth');
          if (journeyMonth) {
            journeyMonth.textContent = `Month ${currentMonth} of 12`;
          }

          // ============================================
          // UPDATE HERO DESCRIPTION
          // ============================================
          const heroDescription = document.getElementById('heroDescription');
          if (heroDescription) {
            const milestone = journeyData.currentMonthMilestone || currentVideo.description;
            heroDescription.innerHTML = `
              You're in Month ${currentMonth} <span class="font-semibold">${journeyData.currentMonthTitle || currentVideo.title} Stage</span><br />
              ${milestone}
            `;
          }
          
          // ============================================
          // UPDATE VIDEO SECTION
          // ============================================
          const videoTitle = document.getElementById('videoTitle');
          if (videoTitle) {
            videoTitle.textContent = `Month ${currentMonth}: ${currentVideo.title}`;
          }
          
          const videoDescription = document.getElementById('videoDescription');
          if (videoDescription) {
            videoDescription.textContent = currentVideo.description;
          }
          
          const videoMeta = document.getElementById('videoMeta');
          if (videoMeta) {
            videoMeta.textContent = `${currentVideo.duration} ‚Ä¢ Month ${currentMonth}`;
          }
          
          // ============================================
          // RENDER VIDEO PREVIEW WITH PLAY BUTTON
          // ============================================
          const videoContainer = document.getElementById('videoContainer');
          if (videoContainer) {
            console.log('üé® Rendering video preview');
            
            videoContainer.innerHTML = `
              <div class="relative w-full rounded-2xl overflow-hidden cursor-pointer video-preview" style="padding-top: 56.25%;" onclick="playVideo()">
                <!-- Video Preview Background -->
                <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-purple-900 to-purple-700 flex items-center justify-center">
                  <div class="text-center text-white p-8">
                    <div class="text-4xl mb-4">üé•</div>
                    <p class="text-xl font-bold mb-2">Month ${currentMonth}</p>
                    <p class="text-sm opacity-90">${currentVideo.title}</p>
                    <p class="text-xs opacity-80 mt-2">${currentVideo.duration}</p>
                  </div>
                </div>
                
                <!-- Dark Overlay -->
                <div class="absolute inset-0 bg-black/30 hover:bg-black/40 transition-all duration-300"></div>
                
                <!-- Play Button -->
                <div class="absolute inset-0 flex items-center justify-center">
                  <div class="relative group">
                    <!-- Outer glow effect -->
                    <div class="absolute inset-0 bg-red-600 rounded-full blur-xl opacity-50 group-hover:opacity-70 transition-all duration-300"></div>
                    
                    <!-- Play button -->
                    <div class="relative bg-red-600 group-hover:bg-red-700 rounded-full w-20 h-20 md:w-24 md:h-24 flex items-center justify-center shadow-2xl group-hover:scale-110 transition-all duration-300 transform play-button">
                      <svg class="w-10 h-10 md:w-12 md:h-12 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                      </svg>
                    </div>
                  </div>
                </div>
                
                <!-- Video Info -->
                <div class="absolute bottom-4 left-4 right-4 pointer-events-none">
                  <div class="flex items-center justify-between">
                    <div class="text-white">
                      <p class="font-semibold text-sm">Click to Play</p>
                      <p class="text-xs opacity-80">Autoplay with sound enabled</p>
                    </div>
                    <div class="bg-black/50 text-white text-xs px-2 py-1 rounded">
                      Month ${currentMonth}
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Instructions -->
              <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-start gap-2">
                  <i class="bx bx-info-circle text-blue-600 text-lg mt-0.5"></i>
                  <div>
                    <p class="text-sm text-blue-800 font-medium">Click the red play button to start video</p>
                    <p class="text-xs text-blue-600 mt-1">Video will play automatically with sound</p>
                  </div>
                </div>
              </div>
            `;
            
            console.log('‚úÖ Video preview rendered successfully');
          }
          
        } catch (error) {
          console.error('‚ùå Error loading video:', error);
          showVideoError();
        }
      }

      // ============================================
      // LOAD PARTNER CALLS
      // ============================================
      async function loadPartnerCalls() {
        try {
          console.log('üîÑ Loading partner calls...');
          
          const response = await fetch('/api/posts');
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          const data = await response.json();
          const partnerCallsContainer = document.getElementById('partnerCallsContainer');
          
          if (!partnerCallsContainer) return;
          
          const posts = data.posts || [];
          console.log(`Found ${posts.length} posts`);
          
          const latestPosts = posts.slice(0, 2);
          
          if (latestPosts.length === 0) {
            partnerCallsContainer.innerHTML = `
              <div class="text-center py-8">
                <i class="bx bx-info-circle text-4xl text-gray-400 mb-2"></i>
                <p class="text-gray-500 text-sm">No partner opportunities available yet</p>
              </div>
            `;
            return;
          }
          
          partnerCallsContainer.innerHTML = latestPosts.map(post => {
            const formattedDate = formatDate(post.created_at);
            const icon = getPostTypeIcon(post.category);
            const title = escapeHtml(post.title || 'Partner Opportunity');
            const content = escapeHtml(post.content || '');
            
            return `
              <a href="/Partner-Calls.html" class="block">
                <div class="border border-gray-200 rounded-2xl p-4 hover:border-purple-300 hover:shadow-sm transition-all cursor-pointer">
                  <div class="flex items-start gap-3">
                    <div class="bg-purple-100 rounded-xl p-2 flex-shrink-0">
                      <i class="bx ${icon} text-purple-600 text-xl"></i>
                    </div>
                    <div class="flex-1">
                      <p class="font-semibold text-gray-900 text-sm mb-1 truncate">${title}</p>
                      <p class="text-xs text-gray-500 mb-1">${formattedDate} ‚Ä¢ ${post.category || 'General'}</p>
                      <p class="text-xs text-gray-600 line-clamp-2">${content}</p>
                    </div>
                  </div>
                </div>
              </a>
            `;
          }).join('');
          
          console.log('‚úÖ Partner calls loaded');
          
        } catch (error) {
          console.error('‚ùå Error loading partner calls:', error);
          const partnerCallsContainer = document.getElementById('partnerCallsContainer');
          if (partnerCallsContainer) {
            partnerCallsContainer.innerHTML = `
              <div class="text-center py-8">
                <i class="bx bx-error-circle text-4xl text-red-400 mb-2"></i>
                <p class="text-gray-500 text-sm">Unable to load partner opportunities</p>
                <button onclick="loadPartnerCalls()" class="mt-2 text-purple-600 text-xs font-medium hover:text-purple-700 transition-colors">
                  Try Again
                </button>
              </div>
            `;
          }
        }
      }

      // ============================================
      // LOAD DASHBOARD STATS - Uses same APIs as respective pages
      // ============================================
      async function loadDashboardStats() {
        try {
          console.log('üìä Loading dashboard stats from source APIs...');
          
          // 1. Load journey data (same as journey page) for completed tasks
          const journeyResponse = await fetch('/api/journey', { credentials: 'include' });
          console.log('Journey API response status:', journeyResponse.status);
          
          if (journeyResponse.ok) {
            const journeyData = await journeyResponse.json();
            console.log('‚úÖ Journey data loaded:', journeyData);
            
            // EXACT SAME CALCULATION AS JOURNEY PAGE
            const currentMonth = journeyData.currentMonth || 1;
            const completedTasks = journeyData.completedTasks || {};
            const months = journeyData.months || [];
            
            // Find current month data from months array (SAME AS JOURNEY PAGE)
            const currentMonthData = months.find(m => m.month === currentMonth);
            
            // Calculate overall progress (SAME AS JOURNEY PAGE LINE 3032-3035)
            const overallProgress = months.reduce((acc, m) => {
              const completed = m.tasks.filter(task => completedTasks[`${m.month}-${task.id}`]).length;
              return acc + (completed / m.tasks.length);
            }, 0) / months.length * 100;
            
            // Calculate current month stats (SAME AS JOURNEY PAGE LINE 2540-2542)
            let currentMonthCompleted = 0;
            let currentMonthTotal = 0;
            if (currentMonthData && currentMonthData.tasks) {
              currentMonthCompleted = currentMonthData.tasks.filter(task => 
                completedTasks[`${currentMonth}-${task.id}`]
              ).length;
              currentMonthTotal = currentMonthData.tasks.length;
            }
            const currentMonthRemaining = currentMonthTotal - currentMonthCompleted;
            
            console.log(`üìä Overall Progress: ${Math.round(overallProgress)}%`);
            console.log(`üìä Month ${currentMonth}: ${currentMonthCompleted}/${currentMonthTotal} tasks (${Math.round((currentMonthCompleted/currentMonthTotal)*100)}%)`);
            
            // Update Journey Progress card
            const journeyProgress = document.getElementById('journeyProgress');
            const journeyMonth = document.getElementById('journeyMonth');
            if (journeyProgress) {
              journeyProgress.textContent = `${Math.round(overallProgress)}%`;
            }
            if (journeyMonth) {
              journeyMonth.textContent = `Month ${currentMonth} of 12`;
            }
            
            // Update Completed Tasks card (shows CURRENT MONTH's progress like journey page)
            const completedTasksCount = document.getElementById('completedTasksCount');
            const upcomingTasksCount = document.getElementById('upcomingTasksCount');
            if (completedTasksCount) {
              completedTasksCount.textContent = currentMonthCompleted;
            }
            if (upcomingTasksCount) {
              upcomingTasksCount.textContent = `${currentMonthRemaining} remaining`;
            }
            
            // Update Hero Milestone Cards
            const nextMilestoneText = document.getElementById('nextMilestoneText');
            const daysInProgramLabel = document.getElementById('daysInProgramLabel');
            const daysInProgramText = document.getElementById('daysInProgramText');
            
            if (nextMilestoneText && currentMonthData) {
              nextMilestoneText.textContent = currentMonthData.milestone || journeyData.currentMonthMilestone || 'Continue your journey';
            }
            
            if (daysInProgramLabel && daysInProgramText) {
              const daysIn = journeyData.statistics?.daysInProgram || 0;
              const daysRemaining = Math.max(0, 365 - daysIn);
              daysInProgramLabel.textContent = `Day ${daysIn} of 365`;
              daysInProgramText.textContent = `${daysRemaining} days remaining`;
            }
          } else {
            console.error('‚ùå Journey API failed:', journeyResponse.status, await journeyResponse.text());
          }
          
          // 2. Load articles data (same as article-amb page)
          const articlesResponse = await fetch('/api/ambassador/articles?limit=100', { credentials: 'include' });
          console.log('Articles API response status:', articlesResponse.status);
          
          if (articlesResponse.ok) {
            const articlesData = await articlesResponse.json();
            console.log('‚úÖ Articles loaded:', articlesData);
            
            const articles = articlesData.items || [];
            const pendingArticles = articles.filter(a => 
              a.status === 'pending' || a.status === 'needs_update' || a.status === 'draft'
            );
            const publishedArticles = articles.filter(a => a.status === 'published');
            
            // Update Articles card
            const articlesPendingCount = document.getElementById('articlesPendingCount');
            const nextArticleDue = document.getElementById('nextArticleDue');
            
            if (articlesPendingCount) {
              articlesPendingCount.textContent = pendingArticles.length;
            }
            if (nextArticleDue) {
              if (publishedArticles.length > 0) {
                nextArticleDue.textContent = `${publishedArticles.length} published`;
              } else if (articles.length > 0) {
                nextArticleDue.textContent = `${articles.length} total`;
              } else {
                nextArticleDue.textContent = 'Write your first!';
              }
            }
          } else {
            console.error('‚ùå Articles API failed:', articlesResponse.status);
          }
          
          // 3. Load applications data (same as applications page)
          const appsResponse = await fetch('/api/ambassador/applications', { credentials: 'include' });
          console.log('Applications API response status:', appsResponse.status);
          
          if (appsResponse.ok) {
            const appsData = await appsResponse.json();
            console.log('‚úÖ Applications loaded:', appsData);
            
            const applications = appsData.items || [];
            const pendingApps = applications.filter(a => a.status === 'pending');
            const acceptedApps = applications.filter(a => a.status === 'accepted' || a.status === 'approved');
            
            // Update Applications card
            const applicationsCount = document.getElementById('applicationsCount');
            const applicationsStatus = document.getElementById('applicationsStatus');
            
            if (applicationsCount) {
              applicationsCount.textContent = applications.length;
            }
            if (applicationsStatus) {
              if (pendingApps.length > 0) {
                applicationsStatus.textContent = `${pendingApps.length} pending review`;
              } else if (acceptedApps.length > 0) {
                applicationsStatus.textContent = `${acceptedApps.length} accepted`;
              } else if (applications.length > 0) {
                applicationsStatus.textContent = `${applications.length} submitted`;
              } else {
                applicationsStatus.textContent = 'Apply to opportunities';
              }
            }
          } else {
            console.error('‚ùå Applications API failed:', appsResponse.status);
          }
          
          console.log('‚úÖ Dashboard stats loaded successfully');
          
        } catch (error) {
          console.error('‚ùå Error loading dashboard stats:', error);
          // Set fallback values
          const fallbacks = {
            'completedTasksCount': '0',
            'upcomingTasksCount': '-- remaining',
            'articlesPendingCount': '0',
            'nextArticleDue': '--',
            'applicationsCount': '0',
            'applicationsStatus': '--'
          };
          Object.keys(fallbacks).forEach(id => {
            const el = document.getElementById(id);
            if (el) el.textContent = fallbacks[id];
          });
        }
      }

      // ============================================
      // INITIALIZE ON PAGE LOAD
      // ============================================
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Dashboard initializing...');
        
        // Mobile sidebar toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.getElementById('overlay');
        
        if (sidebarToggle && sidebar && overlay) {
          sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
          });
          
          overlay.addEventListener('click', function() {
            sidebar.classList.remove('active');
            overlay.classList.remove('active');
          });
        }

        // Fetch user data
        fetch('/api/me')
          .then(response => {
            if (!response.ok) {
              throw new Error('Not authenticated');
            }
            return response.json();
          })
          .then(data => {
            console.log('üë§ User data loaded:', data);
            
            // Update welcome message
            const welcomeHeading = document.getElementById('welcomeHeading');
            if (welcomeHeading && data.name) {
              welcomeHeading.textContent = `Welcome back, ${data.name}!`;
            }
            
            // Update avatar initials
            const avatarElement = document.getElementById('userAvatar');
            if (avatarElement && data.name) {
              const initials = data.name.split(' ')
                .map(word => word[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
              avatarElement.textContent = initials;
            }
          })
          .catch(error => {
            console.error('‚ùå Error fetching user data:', error);
            window.location.href = '/signin';
          });

        // Logout functionality
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function() {
            fetch('/api/logout', { method: 'POST' })
              .then(() => {
                window.location.href = '/signin';
              })
              .catch(error => {
                console.error('Logout error:', error);
                window.location.href = '/signin';
              });
          });
        }

        // Load current month's video
        loadCurrentMonthVideo();
        
        // Load partner calls
        loadPartnerCalls();
        
        // Load dashboard stats (dynamic data)
        loadDashboardStats();
        
        console.log('‚úÖ Dashboard initialized');
      });
    </script>
  </body>
</html>