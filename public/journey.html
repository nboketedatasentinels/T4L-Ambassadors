<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>T4L Journey Tracker</title>
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    /* Custom styles for the journey tracker */
    .sidebar-toggle {
      display: none;
    }

    @media (max-width: 768px) {
      .sidebar-toggle {
        display: block;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 50;
        background: #4b0d7f;
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        position: fixed;
        height: 100vh;
        z-index: 40;
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 30;
      }

      .overlay.active {
        display: block;
      }
    }

    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    .toast {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 100;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast.success {
      background: #10b981;
      color: white;
    }

    .toast.error {
      background: #ef4444;
      color: white;
    }

    .toast.info {
      background: #3b82f6;
      color: white;
    }

    .journey-card {
      transition: all 0.3s ease;
    }

    .journey-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }

    .task-checkbox:checked+label {
      text-decoration: line-through;
      opacity: 0.6;
    }

    .progress-ring {
      transform: rotate(-90deg);
    }

    .progress-ring-circle {
      transition: stroke-dashoffset 0.35s;
    }

    /* Updated Popup Styles */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .popup-content {
      background: white;
      border-radius: 16px;
      max-width: 1000px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      position: relative;
      /* This is the key fix */
    }

    .popup-close {
      position: absolute;
      top: 16px;
      /* Changed from 12px to 16px */
      right: 16px;
      background: none;
      border: none;
      font-size: 1.8rem;
      cursor: pointer;
      color: #666;
      z-index: 10;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s ease;
    }

    .popup-close:hover {
      background: #f5f5f5;
      color: #333;
    }

    /* Transformation Story Styles */
    .template-container {
      padding: 30px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #4b0d7f;
      color: white;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 0.75em;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .badge i {
      font-size: 0.9em;
    }

    .template-title {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #1f2937;
      margin-bottom: 8px;
      font-size: 1.5em;
      font-weight: 700;
    }

    .template-title i {
      font-size: 0.9em;
      color: #4b0d7f;
    }

    .template-subtitle {
      color: #6b7280;
      margin-bottom: 24px;
      font-size: 0.95em;
      line-height: 1.5;
    }

    .template-preview {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      background: #fafafa;
      position: relative;
      height: 320px;
    }

    .template-preview iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
      background: white;
    }

    .preview-overlay {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(75, 13, 127, 0.95);
      color: white;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 0.75em;
      font-weight: 600;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 4px;
      backdrop-filter: blur(4px);
    }

    .preview-overlay i {
      font-size: 0.9em;
    }

    .btn-canva {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #3f8bd7 20%, #560886 100%);
      color: white;
      padding: 14px 32px;
      text-decoration: none;
      border-radius: 12px;
      font-weight: 600;
      font-size: 0.95em;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 114, 255, 0.25);
      margin-bottom: 24px;
      border: none;
      cursor: pointer;
    }

    .btn-canva i {
      font-size: 1.1em;
    }

    .btn-canva:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 114, 255, 0.35);
    }

    .instructions {
      background: #f8faff;
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #4b0d7f;
      margin-bottom: 24px;
    }

    .instructions h3 {
      color: #4b0d7f;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.1em;
      font-weight: 600;
    }

    .instructions h3 i {
      font-size: 1.1em;
    }

    .instructions ol {
      margin-left: 18px;
      color: #4b5563;
      line-height: 1.6;
      font-size: 0.9em;
    }

    .instructions li {
      margin-bottom: 8px;
    }

    .upload-section {
      background: #faf8ff;
      padding: 24px;
      border-radius: 12px;
      border: 2px dashed #d1d5db;
      text-align: center;
      transition: all 0.3s ease;
    }

    .upload-section:hover {
      border-color: #4b0d7f;
      background: #f5f0ff;
    }

    .upload-section h3 {
      color: #4b0d7f;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 1.1em;
      font-weight: 600;
    }

    .upload-section h3 i {
      font-size: 1.1em;
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      margin-bottom: 16px;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-input-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 12px 24px;
      background: white;
      border: 2px solid #4b0d7f;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      color: #4b0d7f;
      transition: all 0.3s ease;
      font-size: 0.9em;
    }

    .file-input-label i {
      font-size: 1.1em;
    }

    .file-input-label:hover {
      background: #4b0d7f;
      color: white;
      transform: translateY(-1px);
    }

    .file-name {
      margin-top: 12px;
      color: #6b7280;
      font-size: 0.85em;
      font-style: normal;
    }

    .btn-submit {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, #4b0d7f, #7c3aed);
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 12px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(75, 13, 127, 0.25);
    }

    .btn-submit i {
      font-size: 1.1em;
    }

    .btn-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(75, 13, 127, 0.35);
    }

    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-linkedin {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: linear-gradient(135deg, #0077b5 0%, #005885 100%);
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 12px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 119, 181, 0.25);
      text-decoration: none;
    }

    .btn-linkedin i {
      font-size: 1.1em;
    }

    .btn-linkedin:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 119, 181, 0.35);
      color: white;
    }

    .success-message {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #f0eaff;
      color: #4b0d7f;
      padding: 12px;
      border-radius: 8px;
      margin-top: 16px;
      border: 1px solid #e9d5ff;
      font-size: 0.9em;
      font-weight: 500;
    }

    .success-message.show {
      display: flex;
    }

    .loading-message {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #f8f9ff;
      z-index: 5;
      border-radius: 12px;
    }

    .loading-message.hidden {
      display: none;
    }

    .loader {
      width: 40px;
      height: 40px;
      border: 4px solid #e5e7eb;
      border-top: 4px solid #4b0d7f;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 12px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .loading-message p {
      color: #4b0d7f;
      font-weight: 600;
      font-size: 0.95em;
    }

    .hidden {
      display: none !important;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 16px;
    }

    /* Month 1 Carousel Popup Styles - SMALLER SIZE */
    .carousel-popup .popup-content {
      max-width: 1200px;
    }

    /* UPDATED: Horizontal carousel selection */
    .carousel-options {
      display: flex;
      flex-direction: row;
      gap: 20px;
      margin-bottom: 24px;
      overflow-x: auto;
      padding-bottom: 10px;
      justify-content: center;
    }

    .carousel-option {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
      min-width: 260px;
      max-width: 280px;
      flex-shrink: 0;
    }

    .carousel-option:hover {
      border-color: #4b0d7f;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .carousel-option.selected {
      border-color: #4b0d7f;
      background: #f5f0ff;
      box-shadow: 0 4px 15px rgba(75, 13, 127, 0.2);
    }

    .carousel-preview-small {
      position: relative;
      width: 100%;
      height: 0;
      padding-top: 80%;
      margin-bottom: 10px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .carousel-preview-small iframe {
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      border: none;
    }

    .carousel-name {
      text-align: center;
      font-weight: 600;
      color: #4b0d7f;
      margin-bottom: 8px;
    }

    .select-indicator {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 6px;
      color: #4b0d7f;
      font-weight: 600;
      font-size: 0.9em;
    }

    .carousel-option.selected .select-indicator {
      display: flex;
    }

    .btn-select {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: #4b0d7f;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 8px;
      width: 100%;
      text-decoration: none;
    }

    .btn-select:hover {
      background: #3a0a63;
      transform: translateY(-1px);
    }

    /* Professional spacing improvements */
    .template-container>*:not(:last-child) {
      margin-bottom: 20px;
    }

    /* Improved typography */
    .template-title,
    .instructions h3,
    .upload-section h3 {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* Better button consistency */
    .btn-canva,
    .btn-submit,
    .btn-linkedin,
    .btn-select,
    .btn-back {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      letter-spacing: -0.01em;
    }

    /* Celebration Popup Styles */
    /* Daily Reminder Popup Styles */
    .daily-reminder-popup {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .daily-reminder-popup.active {
      opacity: 1;
      visibility: visible;
    }

    .daily-reminder-content {
      background: linear-gradient(135deg, #4b0d7f 0%, #6c3aed 100%);
      border-radius: 24px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      position: relative;
      box-shadow: 0 20px 60px rgba(75, 13, 127, 0.4);
      animation: dailyReminderSlideIn 0.5s ease-out;
    }

    @keyframes dailyReminderSlideIn {
      from {
        transform: translateY(-30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .daily-reminder-icon-container {
      margin-bottom: 20px;
    }

    .daily-reminder-icon {
      font-size: 64px;
      color: #fff;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }

    .daily-reminder-message {
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 24px;
      line-height: 1.4;
    }

    .daily-reminder-task-container {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      backdrop-filter: blur(10px);
    }

    .daily-reminder-task-label {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .daily-reminder-task-name {
      font-size: 18px;
      font-weight: 600;
      color: #fff;
      line-height: 1.5;
    }

    .daily-reminder-cta {
      font-size: 16px;
      color: rgba(255, 255, 255, 0.9);
      margin-top: 16px;
      font-weight: 500;
    }

    .daily-reminder-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: #fff;
      font-size: 20px;
    }

    .daily-reminder-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }

    .celebration-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(75, 13, 127, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s ease, visibility 0.5s ease;
    }

    .celebration-popup.active {
      opacity: 1;
      visibility: visible;
    }

    .celebration-content {
      background: linear-gradient(135deg, #4b0d7f 0%, #6c3aed 100%);
      border-radius: 30px;
      padding: 60px 50px;
      text-align: center;
      max-width: 800px;
      width: 90%;
      color: white;
      box-shadow: 0 30px 60px rgba(75, 13, 127, 0.5);
      position: relative;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.5s ease;
    }

    .celebration-popup.active .celebration-content {
      transform: scale(1);
    }

    .celebration-icons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .celebration-icon {
      font-size: 3.5rem;
      color: white;
      opacity: 0.9;
      animation: float 3s ease-in-out infinite;
    }

    .celebration-icon:nth-child(1) { animation-delay: 0s; }
    .celebration-icon:nth-child(2) { animation-delay: 0.2s; }
    .celebration-icon:nth-child(3) { animation-delay: 0.4s; }
    .celebration-icon:nth-child(4) { animation-delay: 0.6s; }
    .celebration-icon:nth-child(5) { animation-delay: 0.8s; }

    .celebration-main-icons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      margin-bottom: 40px;
    }

    .celebration-main-icon {
      font-size: 4.5rem;
      color: white;
      opacity: 0.95;
      animation: pulse 2s ease-in-out infinite;
    }

    .celebration-main-icon:nth-child(2) { animation-delay: 0.5s; }

    .celebration-title {
      font-size: 3.2rem;
      font-weight: 800;
      margin-bottom: 30px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      line-height: 1.3;
    }

    .celebration-subtitle {
      font-size: 1.8rem;
      margin-top: 40px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      backdrop-filter: blur(10px);
      line-height: 1.4;
      font-weight: 500;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .celebration-button {
      margin-top: 40px;
      padding: 18px 50px;
      font-size: 1.3rem;
      background: white;
      color: #4b0d7f;
      border: none;
      border-radius: 50px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .celebration-button:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 30px rgba(75, 13, 127, 0.4);
      background: #f5f0ff;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 0.95;
      }
      50% {
        transform: scale(1.1);
        opacity: 1;
      }
    }

    .confetti {
      position: absolute;
      width: 15px;
      height: 15px;
      background: #f1c40f;
      border-radius: 50%;
      opacity: 0;
    }

    @keyframes float {

      0%,
      100% {
        transform: translateY(0px);
      }

      50% {
        transform: translateY(-20px);
      }
    }

    @keyframes bounce {

      0%,
      20%,
      50%,
      80%,
      100% {
        transform: translateY(0);
      }

      40% {
        transform: translateY(-30px);
      }

      60% {
        transform: translateY(-15px);
      }
    }

    /* Admin Dashboard Journey Styles */
    .admin-journey-table th {
      background-color: #f8fafc;
      border-bottom: 2px solid #e5e7eb;
    }

    .admin-journey-table tr:hover {
      background-color: #f9fafb;
    }

    .progress-bar-container {
      min-width: 100px;
    }

    .month-badge {
      background: linear-gradient(135deg, #4b0d7f, #7c3aed);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.85em;
    }

    /* Journey Detail Modal */
    .journey-modal {
      max-height: 90vh;
      overflow-y: auto;
    }

    .month-card-admin {
      border-left: 4px solid #e5e7eb;
      transition: all 0.3s ease;
    }

    .month-card-admin.current {
      border-left-color: #4b0d7f;
    }

    .month-card-admin.completed {
      border-left-color: #10b981;
    }

    .task-item-admin {
      border-radius: 8px;
      padding: 8px 12px;
      margin: 4px 0;
      background: #f9fafb;
    }

    .task-item-admin.completed {
      background: #f0fdf4;
    }

    .task-item-admin.critical {
      border-left: 3px solid #ef4444;
    }
  </style>
</head>

<body class="bg-gray-50 font-sans">
  <!-- Global Notification Script -->
  <script src="/js/notifications.js"></script>
  <!-- Note: Journey page has its own React-based sidebar, so global sidebar is not used here -->
  <div id="root"></div>

  <!-- Profile Audit Recommendations Popup - Simplified Flex Layout -->
  <div id="profileAuditRecommendationsPopup" class="popup-overlay hidden">
    <div class="popup-content" style="max-width: 900px;">
      <button class="popup-close" onclick="closeProfileAuditRecommendationsPopup()">×</button>
      <div class="template-container" style="padding: 40px 30px;">
        <!-- Flex container for the two audit sections -->
        <div style="display: flex; flex-direction: row; gap: 24px; flex-wrap: wrap; justify-content: center;">
          
          <!-- LinkedIn Profile Audit Section -->
          <div style="flex: 1; min-width: 300px; max-width: 400px; border: 3px dashed #350e6f; border-radius: 16px; padding: 32px; text-align: center; background: white;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 16px;">
              <i class='bx bxl-linkedin' style="font-size: 1.8rem; color: #350e6f;"></i>
              <h3 style="color: #350e6f; font-size: 1.3rem; font-weight: 700; margin: 0;">LinkedIn Profile Audit</h3>
            </div>
            <p style="color: #6b7280; margin-bottom: 20px; font-size: 0.95rem;">Our team has reviewed your LinkedIn profile. Here are your personalized recommendations:</p>
            <a href="#" id="linkedinAuditLink" style="display: flex; align-items: center; justify-content: center; gap: 8px; background: #350e6f; color: white; padding: 14px 24px; text-decoration: none; border-radius: 12px; font-weight: 600; font-size: 0.95rem; margin-bottom: 16px; transition: all 0.3s ease; cursor: pointer;">
              <i class='bx bx-loader-alt bx-spin'></i> Loading...
            </a>
            <p style="color: #9ca3af; font-size: 0.85rem; margin: 0;">Last updated: <span id="linkedinAuditDate">--</span></p>
          </div>

          <!-- Speaker Bio Audit Section -->
          <div style="flex: 1; min-width: 300px; max-width: 400px; border: 3px dashed #350e6f; border-radius: 16px; padding: 32px; text-align: center; background: white;">
            <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 16px;">
              <i class='bx bx-microphone' style="font-size: 1.8rem; color: #350e6f;"></i>
              <h3 style="color: #350e6f; font-size: 1.3rem; font-weight: 700; margin: 0;">Speaker Bio Audit</h3>
            </div>
            <p style="color: #6b7280; margin-bottom: 20px; font-size: 0.95rem;">Our team has reviewed your speaker bio. Here are your personalized recommendations:</p>
            <a href="#" id="speakerBioLink" style="display: flex; align-items: center; justify-content: center; gap: 8px; background: #350e6f; color: white; padding: 14px 24px; text-decoration: none; border-radius: 12px; font-weight: 600; font-size: 0.95rem; margin-bottom: 16px; transition: all 0.3s ease; cursor: pointer;">
              <i class='bx bx-loader-alt bx-spin'></i> Loading...
            </a>
            <p style="color: #9ca3af; font-size: 0.85rem; margin: 0;">Last updated: <span id="speakerBioDate">--</span></p>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Transformation Story Popup - UPDATED: No file upload, direct email -->
  <div id="transformationPopup" class="popup-overlay hidden">
    <div class="popup-content">
      <button class="popup-close" onclick="closeTransformationPopup()">×</button>
      <div class="template-container">
        <a href="https://ior.ad/bdhG?iframeHash=trysteps-1" target="_blank" class="badge" style="text-decoration: none; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'"><i class='bx bx-edit'></i> How to Use</a>
        <h1 class="template-title"><i class='bx bx-movie-play'></i> Your Transformation Story</h1>
        <p class="template-subtitle">Fill in the template with your personal journey and inspire others!</p>

        <div class="template-preview">
          <div class="preview-overlay">
            <i class='bx bx-show'></i> Live Preview
          </div>
          <div class="loading-message" id="templateLoader">
            <div class="loader"></div>
            <p>Loading template preview...</p>
          </div>
          <iframe src="https://www.canva.com/design/DAG-q8LXm-8/pQdNs7l82wMHYxk1xgtkFw/view?embed" allow="fullscreen"
            title="Transformation Story Template" loading="lazy"
            onload="document.getElementById('templateLoader').classList.add('hidden')">
          </iframe>
        </div>

        <a href="https://www.canva.com/design/DAG-q8LXm-8/pQdNs7l82wMHYxk1xgtkFw/edit?utm_content=DAG-q8LXm-8&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
          target="_blank" class="btn-canva">
          <i class='bx bx-edit-alt'></i> Fill Template in Canva
        </a>

        <div class="instructions">
          <h3><i class='bx bx-list-check'></i> How to Complete Your Story</h3>
          <ol>
            <li><strong>Preview the template above</strong> to see the layout and design</li>
            <li><strong>Click the blue button</strong> to open the template in Canva</li>
            <li><strong>Canva will create your own copy</strong> - you can edit freely!</li>
            <li><strong>Fill in your story:</strong> Add your before/after photos, write your journey, include key
              milestones</li>
            <li><strong>Download your completed template</strong> (PDF or PNG)</li>
            <li><strong>Click "Email Your Story" below</strong> to submit it to the T4L team</li>
          </ol>
        </div>

        <div class="upload-section">
          <h3><i class='bx bx-envelope'></i> Submit Your Completed Story</h3>
          <p style="color: #666; margin-bottom: 20px;">
            Once you've filled the template in Canva, download it and submit via email
          </p>

          <div class="action-buttons">
            <button class="btn-submit" onclick="emailTransformationStory()">
              <i class='bx bx-envelope'></i> Email Your Story
            </button>
          </div>

          <div class="success-message" id="successMsg">
            <i class='bx bx-check-circle'></i> Email opened! Please attach your story and send it.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- UPDATED: Month 1 Carousel Popup with 3 Options -->
  <div id="month1CarouselPopup" class="popup-overlay carousel-popup hidden">
    <div class="popup-content">
      <button class="popup-close" onclick="closeMonth1CarouselPopup()">×</button>
      <div class="template-container">
        <a href="https://ior.ad/bdhG?iframeHash=trysteps-1" target="_blank" class="badge" style="text-decoration: none; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'"><i class='bx bx-carousel'></i> How to Use</a>
        <h1 class="template-title"><i class='bx bx-megaphone'></i> Choose Your Announcement Style</h1>
        <p class="template-subtitle">Select one of these carousel designs to announce your T4L Ambassador enrollment on LinkedIn</p>

        <div class="carousel-options" id="month1CarouselOptions">
          <!-- White Logo Carousel -->
          <div class="carousel-option" onclick="selectMonth1Carousel(0)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5o8vwpxI/lsg3GSwcnzVNAqZ4rSWe0w/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">White Logo Style</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5o8vwpxI/yuNiXv2TTZR4cAjn5wSL9g/edit?utm_content=DAG5o8vwpxI&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Purple Logo Carousel -->
          <div class="carousel-option" onclick="selectMonth1Carousel(1)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5o2jynA4/RlILpAgN8c4xIeNULjgX1w/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Purple Logo Style</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5o2jynA4/RodOgg0K56onGLT1XuqN_w/edit?utm_content=DAG5o2jynA4&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Yellow Logo Carousel -->
          <div class="carousel-option" onclick="selectMonth1Carousel(2)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5Dwb0bbQ/rsTRWkwDlsvy5KboUqAPBA/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Yellow Logo Style</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5Dwb0bbQ/kYnErKjEpJh7gwticIVYFg/edit?utm_content=DAG5Dwb0bbQ&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>
        </div>

          <div class="instructions">
          <h3><i class='bx bx-list-check'></i> How to Announce Your Ambassadorship</h3>
          <ol>
            <li><strong>Preview all 3 designs</strong> above - each has a different logo color</li>
            <li><strong>Click on your preferred design</strong> to select it</li>
            <li><strong>Click on the link to "duplicate the file in Canva"</strong> to customize your selected design</li>
            <li><strong>Add your name, photo, or personal touch</strong> in Canva (optional)</li>
            <li><strong>Download the image</strong> from Canva</li>
            <li><strong>Click "Post on LinkedIn"</strong> below to share your announcement.</li>
            <li><strong>The LinkedIn message is pre-filled</strong> - just add the image , tag Transformation Leader, and publish!</li>
          </ol>
        </div>

        <div class="action-buttons">
          <a href="#" class="btn-linkedin" id="month1LinkedinBtn" target="_blank" onclick="postMonth1ToLinkedIn()">
            <i class='bx bxl-linkedin'></i> Post on LinkedIn
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Month 8 Speaker Materials Popup - UPDATED with 3 Templates -->
  <div id="month8SpeakerPopup" class="popup-overlay hidden">
    <div class="popup-content">
      <button class="popup-close" onclick="closeMonth8SpeakerPopup()">×</button>
      <div class="template-container">
        <a href="https://ior.ad/bdhG?iframeHash=trysteps-1" target="_blank" class="badge" style="text-decoration: none; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'"><i class='bx bx-microphone'></i> How to Use</a>
        <h1 class="template-title"><i class='bx bx-slideshow'></i> Update Your Speaker Materials</h1>
        <p class="template-subtitle">Choose and edit one of these speaker templates in Canva to create your professional speaker profile</p>

        <div class="carousel-options" id="speakerCarouselOptions">
          <!-- Speaker Bio Template -->
          <div class="carousel-option" onclick="selectSpeakerCarousel(0)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG-q8LXm-8/pQdNs7l82wMHYxk1xgtkFw/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Speaker Bio Template</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG-q8LXm-8/pQdNs7l82wMHYxk1xgtkFw/edit?utm_content=DAG-q8LXm-8&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Speaker Introduction Script -->
          <div class="carousel-option" onclick="selectSpeakerCarousel(1)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG487XIzBw/ab9uKfmdoSxAoRxn8T_C6Q/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Speaker Introduction Script</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG487XIzBw/HUyiGKtboJeoMQqhvH-aHw/edit?utm_content=DAG487XIzBw&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Signature Talk Outline -->
          <div class="carousel-option" onclick="selectSpeakerCarousel(2)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG481m8Mlk/ib2otg2e97iFfRlP0jKuQw/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Signature Talk Outline</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG481m8Mlk/1qo874aCGBPHi74LOTvjWw/edit?utm_content=DAG481m8Mlk&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>
        </div>

        <div class="instructions">
          <h3><i class='bx bx-list-check'></i> How to Update Your Speaker Materials</h3>
          <ol>
            <li><strong>Preview the 3 speaker templates above</strong> - click on any to select it</li>
            <li><strong>Click "Open in Canva"</strong> to customize your selected template</li>
            <li><strong>Customize the template</strong> with your personal info, bio, and speaking topics</li>
            <li><strong>Download your completed materials</strong> (PDF or PNG)</li>
            <li><strong>Click "Email Your Materials" below</strong> to submit via email to the T4L team</li>
          </ol>
        </div>

        <!-- Upload & Email Section -->
        <div class="upload-section">
          <h3><i class='bx bx-envelope'></i> Submit Your Updated Materials</h3>
          <p style="color: #666; margin-bottom: 20px;">
            Once you've edited the template in Canva, download it and submit via email
          </p>

          <div class="file-input-wrapper">
            <input type="file" id="speakerFile" accept=".pdf,.png,.jpg,.jpeg,.doc,.docx,.ppt,.pptx" onchange="handleSpeakerFileSelect(event)">
            <label for="speakerFile" class="file-input-label">
              <i class='bx bx-folder-open'></i> Choose File
            </label>
          </div>

          <div class="file-name" id="speakerFileName">No file selected</div>

          <div class="action-buttons">
            <button class="btn-submit" id="speakerSubmitBtn" onclick="uploadSpeakerMaterials()" disabled>
              <i class='bx bx-send'></i> Email Your Materials
            </button>

            <a href="#" class="btn-linkedin hidden" id="emailBtn" onclick="openEmailWithMaterials()">
              <i class='bx bx-envelope'></i> Open Email
            </a>
          </div>

          <div class="success-message" id="speakerSuccessMsg">
            <i class='bx bx-check-circle'></i> Success! Your speaker materials have been prepared for email submission.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Month 11 Year End Popup -->
  <div id="month11YearEndPopup" class="popup-overlay carousel-popup hidden">
    <div class="popup-content">
      <button class="popup-close" onclick="closeMonth11YearEndPopup()">×</button>
      <div class="template-container">
        <a href="https://ior.ad/bdhG?iframeHash=trysteps-1" target="_blank" class="badge" style="text-decoration: none; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'"><i class='bx bx-calendar-star'></i> How to Use</a>
        <h1 class="template-title"><i class='bx bx-trophy'></i> Share Your Year-End Transformation Story</h1>
        <p class="template-subtitle">Reflect on your incredible journey and inspire others with your transformation
          story</p>

        <div class="carousel-preview-container">
          <iframe loading="lazy" src="https://www.canva.com/design/DAG5ogvFLxw/ABiJQJE_RsKilotb6vZ36w/view?embed"
            allowfullscreen="allowfullscreen" allow="fullscreen">
          </iframe>
        </div>
        <a
          href="https://www.canva.com/design/DAG5ogvFLxw/ABiJQJE_RsKilotb6vZ36w/edit?utm_content=DAG5ogvFLxw&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
          target="_blank"
          rel="noopener"
          class="btn-canva">
          <i class='bx bx-edit-alt'></i> Fill Template in Canva
        </a>

        <div class="instructions">
          <h3><i class='bx bx-list-check'></i> How to Share Your Year-End Story</h3>
          <ol>
            <li><strong>View the carousel above</strong> - this is your year-end reflection graphic</li>
            <li><strong>Click the link above</strong> to open it in Canva if you want to customize</li>
            <li><strong>Download the image</strong> from Canva (or use as is)</li>
            <li><strong>Click "Post on LinkedIn"</strong> below to share your reflection</li>
            <li><strong>Upload the carousel image</strong> when posting on LinkedIn</li>
            <li><strong>The message is pre-filled</strong> - just add your personal story and publish!</li>
          </ol>
        </div>

        <div class="action-buttons">
          <a href="#" class="btn-linkedin" id="month11LinkedinBtn" target="_blank" onclick="postMonth11ToLinkedIn()">
            <i class='bx bxl-linkedin'></i> Post on LinkedIn
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Month 4 Multi-Carousel Popup -->
  <div id="month4CarouselPopup" class="popup-overlay carousel-popup hidden">
    <div class="popup-content">
      <button class="popup-close" onclick="closeMonth4CarouselPopup()">×</button>
      <div class="template-container">
        <a href="https://ior.ad/bdhG?iframeHash=trysteps-1" target="_blank" class="badge" style="text-decoration: none; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'"><i class='bx bx-carousel'></i> How to Use</a>
        <h1 class="template-title"><i class='bx bx-images'></i> Choose Your LinkedIn quote template</h1>
        <p class="template-subtitle">Post 4x on LinkedIn this month</p>

        <div class="carousel-options" id="carouselOptions">
          <!-- Carousel Option 1 -->
          <div class="carousel-option" onclick="selectCarousel(0)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5ECU1jl0/Vqqy9w8nd64foKUx_fwVNA/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name"> Quote Design 1</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5ECU1jl0/FDDd65p9a0c2lrAiqgGq-A/edit?utm_content=DAG5ECU1jl0&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Carousel Option 2 -->
          <div class="carousel-option" onclick="selectCarousel(1)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5ovIvtPA/H7HVYxY16IwE6F0-cCDQ7Q/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Quote Design 2</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5ovIvtPA/OmgdOiisi8cFWaFAnPBgdg/edit?utm_content=DAG5ovIvtPA&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Carousel Option 3 -->
          <div class="carousel-option" onclick="selectCarousel(2)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5on2c3N0/oNrnW8orLOtD5_OJAFRuSg/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Quote Design 3</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5on2c3N0/L2jcFqK-b8VBYTJ8_-2mGQ/edit?utm_content=DAG5on2c3N0&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>
        </div>

        <div class="instructions">
          <h3><i class='bx bx-list-check'></i> How to Use These Quote Templates</h3>
          <ol>
            <li><strong>Preview the quote templates above</strong> - click on any to select it</li>
            <li><strong>Click "Open in Canva"</strong> to customize your selected quote template</li>
            <li><strong>Customize the quote template</strong> in Canva with your content</li>
            <li><strong>Download the images</strong> from Canva</li>
            <li><strong>Click "Post on LinkedIn"</strong> below to share your quote template</li>
            <li><strong>Upload the quote template image</strong> when posting on LinkedIn</li>
          </ol>
        </div>

        <div class="action-buttons">
          <a href="#" class="btn-linkedin" id="month4LinkedinBtn" target="_blank" onclick="postMonth4ToLinkedIn()">
            <i class='bx bxl-linkedin'></i> Post on LinkedIn
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Month 7 Multi-Carousel Popup - UPDATED WITH NEW CAROUSELS -->
  <div id="month7CarouselPopup" class="popup-overlay carousel-popup hidden">
    <div class="popup-content">
      <button class="popup-close" onclick="closeMonth7CarouselPopup()">×</button>
      <div class="template-container">
        <a href="https://ior.ad/bdhG?iframeHash=trysteps-1" target="_blank" class="badge" style="text-decoration: none; cursor: pointer; transition: opacity 0.2s;" onmouseover="this.style.opacity='0.8'" onmouseout="this.style.opacity='1'"><i class='bx bx-carousel'></i> How to Use</a>
        <h1 class="template-title"><i class='bx bx-images'></i> Choose Your LinkedIn Carousel</h1>
        <p class="template-subtitle">Select one of these carousels to post on LinkedIn this month</p>

        <div class="carousel-options" id="carouselOptionsMonth7">
          <!-- Carousel Template 1 -->
          <div class="carousel-option" onclick="selectCarouselMonth7(0)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5DyBXpPY/GW_NAYOZPuS7rm7Wm_XK0Q/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Carousel Template 1</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5DyBXpPY/o47RrTQypnSWEMSyiRhj4A/edit"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Carousel Template 2 -->
          <div class="carousel-option" onclick="selectCarouselMonth7(1)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG49VTOPfk/dXVzkR1Fv7QWjPornm2UAA/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Carousel Template 2</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG49VTOPfk/dXVzkR1Fv7QWjPornm2UAA/edit"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>

          <!-- Carousel Template 3 -->
          <div class="carousel-option" onclick="selectCarouselMonth7(2)">
            <div class="carousel-preview-small">
              <iframe loading="lazy" src="https://www.canva.com/design/DAG5D7iKVt0/DlVlI-T937daKjq1gQEXNA/view?embed"
                allowfullscreen="allowfullscreen" allow="fullscreen">
              </iframe>
            </div>
            <div class="carousel-name">Carousel Template 3</div>
            <div class="select-indicator">
              <i class='bx bx-check-circle'></i> Selected
            </div>
            <a href="https://www.canva.com/design/DAG5D7iKVt0/DlVlI-T937daKjq1gQEXNA/edit"
              target="_blank" class="btn-select" onclick="event.stopPropagation();">
              <i class='bx bx-edit-alt'></i> Open in Canva
            </a>
          </div>
        </div>

        <div class="instructions">
          <h3><i class='bx bx-list-check'></i> How to Use These Carousels</h3>
          <ol>
            <li><strong>Preview all 3 designs above</strong> - each has a different logo color</li>
            <li><strong>Click on your preferred design</strong> to select it</li>
            <li><strong>Click on the link to "duplicate the file in Canva"</strong> to customize your selected design</li>
            <li><strong>Add your name, photo, or personal touch in Canva</strong> (optional)</li>
            <li><strong>Download the image</strong> from Canva</li>
            <li><strong>Click "Post on LinkedIn"</strong> below to share your announcement</li>
            <li><strong>The LinkedIn message is pre-filled</strong> - just add the image, tag Transformation Leader, and publish!</li>
          </ol>
        </div>

        <div class="action-buttons">
          <a href="#" class="btn-linkedin" id="month7LinkedinBtn" target="_blank" onclick="postMonth7ToLinkedIn()">
            <i class='bx bxl-linkedin'></i> Post on LinkedIn
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Audit Popup -->
  <div id="profileAuditPopup" class="popup-overlay hidden">
    <div class="popup-content">
      <button class="popup-close" onclick="closeProfileAuditPopup()">×</button>
      <div class="template-container">
        <span class="badge"><i class='bx bx-user-check'></i> Profile Audit</span>
        <h1 class="template-title"><i class='bx bx-search-alt'></i> LinkedIn Profile Optimization</h1>
        <p class="template-subtitle">Get your LinkedIn profile reviewed and optimized for maximum impact</p>

        <div class="instructions">
          <h3><i class='bx bx-list-check'></i> How to Complete Your Profile Audit</h3>
          <ol>
            <li><strong>Review the audit guidelines</strong> in the document below</li>
            <li><strong>Update your LinkedIn profile</strong> based on the recommendations</li>
            <li><strong>Submit your profile URL</strong> for final review</li>
            <li><strong>Get certified</strong> as a T4L Ambassador with an optimized profile</li>
          </ol>
        </div>

        <div class="action-buttons">
          <a href="https://gamma.app/docs/Lyonga-Mbesa-Digital-Audit-qo6eoxg0ai618j3" target="_blank" class="btn-canva">
            <i class='bx bx-file'></i> View Audit Guidelines
          </a>

          <a href="https://www.linkedin.com/" target="_blank" class="btn-linkedin">
            <i class='bx bxl-linkedin'></i> View Example Profile
          </a>
        </div>

        <div class="upload-section">
          <h3><i class='bx bx-link'></i> Submit Your Profile for Review</h3>
          <p style="color: #666; margin-bottom: 20px;">
            Paste your LinkedIn profile URL below for final review and certification
          </p>

          <input type="url" id="profileUrl" placeholder="https://www.linkedin.com/in/your-profile"
            class="w-full p-3 border border-gray-300 rounded-lg mb-4">

          <button class="btn-submit" onclick="submitProfileForReview()">
            <i class='bx bx-check-shield'></i> Submit for Review
          </button>

          <div class="success-message" id="profileSuccessMsg">
            <i class='bx bx-check-circle'></i> Profile submitted successfully! You'll hear back within 48 hours.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Daily Reminder Popup -->
  <div id="dailyReminderPopup" class="daily-reminder-popup hidden">
    <div class="daily-reminder-content">
      <!-- Motivational Icon -->
      <div class="daily-reminder-icon-container">
        <i class='bx bx-bullseye daily-reminder-icon'></i>
      </div>

      <!-- Motivational Message -->
      <div class="daily-reminder-message" id="dailyReminderMessage">
        💪 Keep pushing forward!
      </div>

      <!-- Task Name -->
      <div class="daily-reminder-task-container">
        <div class="daily-reminder-task-label">Your current task:</div>
        <div class="daily-reminder-task-name" id="dailyReminderTaskName">
          Complete your current task
        </div>
      </div>

      <!-- Call to Action -->
      <div class="daily-reminder-cta">
        Complete it to keep your momentum going! 💪
      </div>

      <!-- Close Button -->
      <button class="daily-reminder-close" onclick="closeDailyReminder()">
        <i class='bx bx-x'></i>
      </button>
    </div>
  </div>

  <!-- Celebration Popup -->
  <div id="completionCelebration" class="celebration-popup hidden">
    <div class="celebration-content">
      <!-- Celebration Icons -->
      <div class="celebration-icons">
        <i class='bx bx-party celebration-icon'></i>
        <i class='bx bx-trophy celebration-icon'></i>
        <i class='bx bx-star celebration-icon'></i>
        <i class='bx bx-rocket celebration-icon'></i>
        <i class='bx bx-check-circle celebration-icon'></i>
      </div>

      <!-- Main Icons -->
      <div class="celebration-main-icons">
        <i class='bx bx-trophy celebration-main-icon'></i>
        <i class='bx bx-check-circle celebration-main-icon'></i>
      </div>

      <!-- Main Congratulations Text -->
      <h1 class="celebration-title">
        Congratulations! You've Completed Your 12-Month Transformation Journey!
      </h1>

      <!-- Secondary Message -->
      <div class="celebration-subtitle">
        Your journey continues - time to mentor the next generation
      </div>
    </div>
  </div>

  <!-- Journey Progress Detail Modal (Admin Feature) -->
  <div id="journeyDetailModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl w-full max-w-6xl shadow-2xl flex flex-col max-h-[90vh] journey-modal">
      <div class="p-4 border-b border-gray-200 flex items-center justify-between">
        <div class="flex items-center gap-3">
          <h3 id="journeyAmbassadorName" class="text-xl font-semibold text-gray-900">Ambassador Journey</h3>
          <span id="journeyCurrentMonth" class="px-3 py-1 rounded-lg text-xs font-semibold bg-purple-100 text-purple-700">Month 1</span>
        </div>
        <button id="closeJourneyDetail" class="text-gray-600 hover:text-gray-900">
          <i class="bx bx-x text-2xl"></i>
        </button>
      </div>
      
      <div id="journeyDetailContent" class="flex-1 overflow-y-auto p-6">
        <!-- Progress Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-purple-50 rounded-xl p-4 border border-purple-200">
            <div class="text-sm text-purple-600 font-semibold mb-1">Overall Progress</div>
            <div class="text-3xl font-bold text-purple-700" id="journeyOverallProgress">0%</div>
          </div>
          <div class="bg-blue-50 rounded-xl p-4 border border-blue-200">
            <div class="text-sm text-blue-600 font-semibold mb-1">Current Month</div>
            <div class="text-3xl font-bold text-blue-700" id="journeyCurrentMonthProgress">0%</div>
          </div>
          <div class="bg-green-50 rounded-xl p-4 border border-green-200">
            <div class="text-sm text-green-600 font-semibold mb-1">Tasks Completed</div>
            <div class="text-3xl font-bold text-green-700" id="journeyCompletedCount">0/0</div>
          </div>
          <div class="bg-orange-50 rounded-xl p-4 border border-orange-200">
            <div class="text-sm text-orange-600 font-semibold mb-1">Started</div>
            <div class="text-sm font-semibold text-orange-700" id="journeyStartDate">-</div>
          </div>
        </div>

        <!-- Current Month Highlight -->
        <div id="journeyCurrentMonthInfo" class="bg-gradient-to-r from-purple-600 to-purple-800 text-white rounded-xl p-4 mb-6">
          <div class="text-sm font-medium opacity-90 mb-1">Current Focus</div>
          <h2 class="text-2xl font-bold" id="journeyCurrentMonthTitle">Month X: Title</h2>
          <p class="text-sm opacity-90 mt-2" id="journeyCurrentMonthMilestone">Milestone</p>
        </div>

        <!-- Month-by-Month Progress -->
        <div id="journeyMonthsList" class="space-y-4">
          <!-- Months will be rendered here -->
        </div>
      </div>
    </div>
  </div>

  <!-- T4L Community Channels Popup -->
  <div id="communityPopup" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl w-full max-w-3xl shadow-2xl overflow-hidden">
      <div class="flex items-center justify-between px-5 py-4 border-b border-gray-200">
        <div>
          <h3 class="text-lg font-semibold text-gray-900">T4L Community Channels</h3>
        </div>
        <button onclick="closeCommunityPopup()" class="text-gray-500 hover:text-gray-800">
          <i class="bx bx-x text-2xl"></i>
        </button>
      </div>
      <div class="p-5">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
          <a href="https://www.facebook.com/t4leader/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-blue-50 text-blue-800 hover:bg-blue-100 transition-colors">
            <i class="bx bxl-facebook-square text-xl"></i>
            <span>Facebook</span>
          </a>
          <a href="https://www.linkedin.com/company/t4leader/posts/?feedView=all" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-sky-50 text-sky-800 hover:bg-sky-100 transition-colors">
            <i class="bx bxl-linkedin-square text-xl"></i>
            <span>LinkedIn</span>
          </a>
          <a href="https://www.youtube.com/@T4Leaders" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-red-50 text-red-700 hover:bg-red-100 transition-colors">
            <i class="bx bxl-youtube text-xl"></i>
            <span>YouTube</span>
          </a>
          <a href="https://www.instagram.com/t4leader/?hl=en" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-pink-50 text-pink-700 hover:bg-pink-100 transition-colors">
            <i class="bx bxl-instagram text-xl"></i>
            <span>Instagram</span>
          </a>
          <a href="https://x.com/T4Leaders" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-50 text-slate-800 hover:bg-slate-100 transition-colors">
            <i class="bx bxl-twitter text-xl"></i>
            <span>X (Twitter)</span>
          </a>
          <a href="https://chat.whatsapp.com/JhxsDohAsB5GHKmxDdKhq8" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 px-3 py-2 rounded-lg bg-green-50 text-green-800 hover:bg-green-100 transition-colors">
            <i class="bx bxl-whatsapp text-xl"></i>
            <span>Ambassador WhatsApp Community</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;
    
    // Helper to split combined audit feedback into separate LinkedIn and Speaker sections.
    // This keeps compatibility with the single `feedback` field stored in the backend.
    function parseAuditFeedback(rawFeedback) {
      const defaultResult = {
        linkedinFeedback: rawFeedback || '',
        speakerFeedback: ''
      };

      if (!rawFeedback) return defaultResult;

      const markerLinkedin = /LINKEDIN FEEDBACK:/i;
      const markerSpeaker = /SPEAKER FEEDBACK:/i;

      // If no markers exist, treat the full text as LinkedIn feedback only
      if (!markerLinkedin.test(rawFeedback) && !markerSpeaker.test(rawFeedback)) {
        return defaultResult;
      }

      let linkedinFeedback = '';
      let speakerFeedback = '';

      // Ensure we always have a LinkedIn marker at the start when markers are used
      let text = rawFeedback.trim();
      if (!markerLinkedin.test(text)) {
        text = 'LINKEDIN FEEDBACK:\n' + text;
      }

      // Split around the speaker marker, if present
      const speakerIndex = text.search(markerSpeaker);
      if (speakerIndex === -1) {
        // Only LinkedIn section present
        linkedinFeedback = text.replace(markerLinkedin, '').trim();
      } else {
        const linkedinPart = text.slice(0, speakerIndex);
        const speakerPart = text.slice(speakerIndex);

        linkedinFeedback = linkedinPart.replace(markerLinkedin, '').trim();
        speakerFeedback = speakerPart.replace(markerSpeaker, '').trim();
      }

      return {
        linkedinFeedback,
        speakerFeedback
      };
    }
    
    // Store for audit recommendations
    let auditRecommendations = {
      linkedin: {
        hasRecommendations: false,
        url: '',
        feedback: '',
        lastUpdated: ''
      },
      speakerBio: {
        hasRecommendations: false,
        url: '',
        feedback: '',
        lastUpdated: ''
      }
    };

    // Function to load audit recommendations from backend API
    async function loadAuditRecommendations() {
      try {
        const response = await fetch('/api/journey/linkedin-audit', {
          method: 'GET',
          credentials: 'include'
        });

        if (!response.ok) {
          console.error('Failed to fetch audit recommendations');
          return auditRecommendations;
        }

        const data = await response.json();
        
        if (data.hasAudit && data.audit) {
          const submittedDate = data.audit.submittedAt 
            ? new Date(data.audit.submittedAt).toLocaleDateString() 
            : new Date().toLocaleDateString();

          // Split the combined feedback string into LinkedIn-only and Speaker-only sections
          const parsedFeedback = parseAuditFeedback(data.audit.feedback || '');
          
          auditRecommendations = {
            linkedin: {
              hasRecommendations: true,
              url: data.audit.linkedin_url || '',
              feedback: parsedFeedback.linkedinFeedback || '',
              lastUpdated: submittedDate
            },
            speakerBio: {
              hasRecommendations: !!data.audit.speaker_bio_url,
              url: data.audit.speaker_bio_url || '',
              feedback: parsedFeedback.speakerFeedback || '',
              lastUpdated: submittedDate
            }
          };
          
          console.log('✅ Loaded audit recommendations from backend:', auditRecommendations);
        } else {
          console.log('📭 No audit recommendations found');
          auditRecommendations = {
            linkedin: { hasRecommendations: false, url: '', feedback: '', lastUpdated: '' },
            speakerBio: { hasRecommendations: false, url: '', feedback: '', lastUpdated: '' }
          };
        }
        
        return auditRecommendations;
      } catch (error) {
        console.error('❌ Error loading audit recommendations:', error);
        return auditRecommendations;
      }
    }

    // Open profile audit recommendations popup
    async function openProfileAuditRecommendationsPopup() {
      const popup = document.getElementById('profileAuditRecommendationsPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Show loading state
      const linkedinLink = document.getElementById('linkedinAuditLink');
      const linkedinDate = document.getElementById('linkedinAuditDate');
      const speakerBioLink = document.getElementById('speakerBioLink');
      const speakerBioDate = document.getElementById('speakerBioDate');
      
      linkedinLink.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Loading...';
      speakerBioLink.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Loading...';
      
      // Load recommendations from backend
      const recommendations = await loadAuditRecommendations();
      
      // Update LinkedIn section
      if (recommendations.linkedin.hasRecommendations) {
        linkedinLink.innerHTML = '<i class="bx bx-file"></i> View LinkedIn Audit Recommendations';
        linkedinLink.onclick = (e) => {
          e.preventDefault();
          showAuditFeedbackModal('LinkedIn Profile Audit', recommendations.linkedin.feedback, recommendations.linkedin.url);
        };
        linkedinDate.textContent = recommendations.linkedin.lastUpdated;
      } else {
        linkedinLink.innerHTML = '<i class="bx bx-time"></i> Audit Pending';
        linkedinLink.onclick = (e) => {
          e.preventDefault();
          alert('Your LinkedIn profile audit is pending. The admin will review your profile and provide recommendations soon.');
        };
        linkedinDate.textContent = 'Pending';
      }
      
      // Update Speaker Bio section
      if (recommendations.speakerBio.hasRecommendations) {
        speakerBioLink.innerHTML = '<i class="bx bx-file"></i> View Speaker Bio Recommendations';
        speakerBioLink.onclick = (e) => {
          e.preventDefault();
          showAuditFeedbackModal('Speaker Bio Audit', recommendations.speakerBio.feedback, recommendations.speakerBio.url);
        };
        speakerBioDate.textContent = recommendations.speakerBio.lastUpdated;
      } else {
        speakerBioLink.innerHTML = '<i class="bx bx-time"></i> Audit Pending';
        speakerBioLink.onclick = (e) => {
          e.preventDefault();
          alert('Your speaker bio audit is pending. The admin will review your bio and provide recommendations soon.');
        };
        speakerBioDate.textContent = 'Pending';
      }
    }
    
    // Show audit feedback in a modal
    function showAuditFeedbackModal(title, feedback, profileUrl) {
      // Create modal overlay
      const modalOverlay = document.createElement('div');
      modalOverlay.id = 'auditFeedbackModal';
      modalOverlay.className = 'popup-overlay';
      modalOverlay.style.cssText = 'position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999;';
      
      // Determine the URL label based on the title
      const urlLabel = title.includes('LinkedIn') ? 'LinkedIn Profile URL:' : 'Speaker Bio URL:';
      
      modalOverlay.innerHTML = `
        <div style="background: white; border-radius: 16px; max-width: 600px; width: 90%; max-height: 80vh; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
          <div style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0; font-size: 1.25rem; font-weight: 700; color: #350e6f;">${title}</h3>
            <button onclick="closeAuditFeedbackModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280; padding: 4px;">&times;</button>
          </div>
          <div style="padding: 24px; max-height: 50vh; overflow-y: auto;">
            <h4 style="margin: 0 0 12px 0; font-size: 1rem; font-weight: 600; color: #374151;">Recommendations & Feedback:</h4>
            <div style="background: #f9fafb; border-radius: 12px; padding: 16px; white-space: pre-wrap; color: #374151; line-height: 1.6; font-size: 0.95rem;">
              ${feedback || 'No feedback provided yet.'}
            </div>
            ${profileUrl ? `
            <div style="margin-top: 20px;">
              <h4 style="margin: 0 0 8px 0; font-size: 1rem; font-weight: 600; color: #374151;">${urlLabel}</h4>
              <a href="${profileUrl}" target="_blank" style="color: #350e6f; font-size: 0.95rem; word-break: break-all; text-decoration: underline;">
                ${profileUrl}
              </a>
            </div>
            ` : ''}
          </div>
          <div style="padding: 16px 24px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end;">
            <button onclick="closeAuditFeedbackModal()" style="background: #350e6f; color: white; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; cursor: pointer;">
              Close
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modalOverlay);
      
      // Close on overlay click
      modalOverlay.addEventListener('click', (e) => {
        if (e.target === modalOverlay) {
          closeAuditFeedbackModal();
        }
      });
    }
    
    // Close audit feedback modal
    function closeAuditFeedbackModal() {
      const modal = document.getElementById('auditFeedbackModal');
      if (modal) {
        modal.remove();
      }
    }

    // Close popup
    function closeProfileAuditRecommendationsPopup() {
      const popup = document.getElementById('profileAuditRecommendationsPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    // Mark as complete
    function markProfileAuditAsComplete() {
      // In real app, this would update the task status via API
      alert('Task marked as complete! The task will now show as checked.');
      closeProfileAuditRecommendationsPopup();
      
      // Find and check the task checkbox (simulated)
      const taskCheckbox = document.querySelector('input[id*="implement_audit"]');
      if (taskCheckbox) {
        taskCheckbox.checked = true;
        taskCheckbox.dispatchEvent(new Event('change'));
      }
    }

    // Note: Admin audit submission is now handled via the backend API
    // Admin submits audits through /admin/api/ambassadors/:id/linkedin-audit
    // Ambassadors receive audits through /api/journey/linkedin-audit

    // Carousel selection state for Month 1 (NEW: 3 options)
    let selectedMonth1CarouselIndex = 0;
    const month1CarouselLinks = [
      'https://www.canva.com/design/DAG5o8vwpxI/yuNiXv2TTZR4cAjn5wSL9g/edit?utm_content=DAG5o8vwpxI&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton',
      'https://www.canva.com/design/DAG5o2jynA4/RodOgg0K56onGLT1XuqN_w/edit?utm_content=DAG5o2jynA4&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton',
      'https://www.canva.com/design/DAG5Dwb0bbQ/kYnErKjEpJh7gwticIVYFg/edit?utm_content=DAG5Dwb0bbQ&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton'
    ];

    // Carousel selection state for Month 4
    let selectedCarouselIndex = 0;
    const carouselLinks = [
      'https://www.canva.com/design/DAG5ECU1jl0/Vqqy9w8nd64foKUx_fwVNA/view?utm_content=DAG5ECU1jl0&utm_campaign=designshare&utm_medium=embeds&utm_source=link',
      'https://www.canva.com/design/DAG5ovIvtPA/H7HVYxY16IwE6F0-cCDQ7Q/view?utm_content=DAG5ovIvtPA&utm_campaign=designshare&utm_medium=embeds&utm_source=link',
      'https://www.canva.com/design/DAG5on2c3N0/oNrnW8orLOtD5_OJAFRuSg/view?utm_content=DAG5on2c3N0&utm_campaign=designshare&utm_medium=embeds&utm_source=link'
    ];

    // Carousel selection state for Month 7
    let selectedCarouselIndexMonth7 = 0;

    // UPDATED: Month 8 Speaker Materials Variables with 3 templates
    let selectedSpeakerCarouselIndex = 0;
    let selectedSpeakerFile = null;
    let uploadedSpeakerFileName = '';
    const speakerCarouselLinks = [
      'https://www.canva.com/design/DAG5D4YdK2I/9Je3_IkDr2j3cr46NzM6rQ/edit?utm_content=DAG5D4YdK2I&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton',
      'https://www.canva.com/design/DAG487XIzBw/HUyiGKtboJeoMQqhvH-aHw/edit?utm_content=DAG487XIzBw&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton',
      'https://www.canva.com/design/DAG481m8Mlk/1qo874aCGBPHi74LOTvjWw/edit?utm_content=DAG481m8Mlk&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton'
    ];

    // Journey Progress Admin Functions
    function openJourneyDetail(ambassadorId) {
      console.log('Opening journey detail for:', ambassadorId);
      // In a real implementation, this would fetch from server
      // For now, we'll show a demo
      renderJourneyDetail({
        ambassadorId: ambassadorId,
        currentMonth: 3,
        completedTasks: {
          '1-linkedin_course': true,
          '1-submit_profile': true,
          '1-second_course': true,
          '1-connect_10': true,
          '1-post_3x': true,
          '2-implement_audit': true,
          '2-third_course': true,
          '2-submit_article_1': true,
          '2-engage_15': false,
          '3-first_event': true,
          '3-transformation_post': true,
          '3-submit_article_2': false,
          '3-update_impact_log': true
        },
        statistics: {
          totalTasks: 48,
          completedCount: 11,
          overallProgress: 23,
          currentMonthProgress: 75,
          currentMonthTitle: "Foundation Building",
          currentMonthMilestone: "Establish your digital presence and complete core training"
        }
      });
      
      const modal = document.getElementById('journeyDetailModal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function renderJourneyDetail(data) {
      document.getElementById('journeyAmbassadorName').textContent = 
        `Ambassador ${data.ambassadorId}'s Journey`;
      
      document.getElementById('journeyCurrentMonth').textContent = `Month ${data.currentMonth}`;
      document.getElementById('journeyOverallProgress').textContent = `${data.statistics.overallProgress}%`;
      document.getElementById('journeyCurrentMonthProgress').textContent = `${data.statistics.currentMonthProgress}%`;
      document.getElementById('journeyCompletedCount').textContent = 
        `${data.statistics.completedCount}/${data.statistics.totalTasks}`;
      document.getElementById('journeyStartDate').textContent = 'Jan 15, 2024';
      
      document.getElementById('journeyCurrentMonthTitle').textContent = 
        `Month ${data.currentMonth}: ${data.statistics.currentMonthTitle}`;
      document.getElementById('journeyCurrentMonthMilestone').textContent = 
        data.statistics.currentMonthMilestone;
      
      // Render months
      const monthsList = document.getElementById('journeyMonthsList');
      const monthsData = [
        { month: 1, title: "Foundation Building", milestone: "Establish your digital presence and complete core training", totalTasks: 5 },
        { month: 2, title: "Content Creation & Community Engagement", milestone: "Start creating valuable content and engage with the full T4L community", totalTasks: 4 },
        { month: 3, title: "ENGAGE", milestone: "Engaged Member: Attended event, building relationships, consistent content, impact tracked", totalTasks: 4 },
        { month: 4, title: "LEAD", milestone: "Leadership Activated: Volunteered for opportunity, all courses complete, growing visibility", totalTasks: 4 },
        { month: 5, title: "AMPLIFY", milestone: "Amplified Impact: Led something, article progress, consistent support", totalTasks: 4 },
        { month: 6, title: "MIDPOINT", milestone: "Halfway Strong: Story shared, podcast scheduled, 50+ people impacted, momentum building", totalTasks: 3 },
        { month: 7, title: "VISIBILITY", milestone: "Visible Leader: Podcast prep underway, leading regularly, strong content cadence", totalTasks: 3 },
        { month: 8, title: "EXPAND", milestone: "Expanded Reach: Podcast recorded/scheduled, applied for external opportunities, portfolio growing", totalTasks: 4 },
        { month: 9, title: "CONNECT", milestone: "Connected Leader: Deep relationships built, podcast live, third leadership opportunity completed", totalTasks: 2 },
        { month: 10, title: "ACCELERATE", milestone: "Accelerating: Final articles submitted, 85+ impacted, speaking opportunities in pipeline", totalTasks: 3 },
        { month: 11, title: "CELEBRATE", milestone: "Celebrating: Year documented, story shared, impact quantified", totalTasks: 3 },
        { month: 12, title: "RENEW", milestone: "Transformation Complete: Full year tracked, portfolio built, thought leadership established, decision made", totalTasks: 2 }
      ];
      
      monthsList.innerHTML = monthsData.map(month => {
        const isCompleted = month.month < data.currentMonth;
        const isCurrentMonth = month.month === data.currentMonth;
        
        // Calculate progress for this month
        const monthCompleted = Object.keys(data.completedTasks).filter(key => {
          const [monthNum, taskId] = key.split('-');
          return parseInt(monthNum) === month.month && data.completedTasks[key];
        }).length;
        const monthProgress = month.totalTasks > 0 ? Math.round((monthCompleted / month.totalTasks) * 100) : 0;
        
        const statusColor = isCompleted ? 'bg-green-50 border-green-200' :
                           isCurrentMonth ? 'bg-purple-50 border-purple-200' :
                           'bg-gray-50 border-gray-200';
        
        const statusBadge = isCompleted ? 
          '<span class="px-2 py-1 rounded-lg bg-green-100 text-green-700 text-xs font-semibold">✓ Completed</span>' :
          isCurrentMonth ? 
          '<span class="px-2 py-1 rounded-lg bg-purple-100 text-purple-700 text-xs font-semibold">→ Current</span>' :
          '<span class="px-2 py-1 rounded-lg bg-gray-100 text-gray-600 text-xs font-semibold">⏳ Upcoming</span>';
        
        // Get tasks for this month
        const tasks = getTasksForMonth(month.month).map(task => {
          const taskKey = `${month.month}-${task.id}`;
          const completed = !!data.completedTasks[taskKey];
          return {
            ...task,
            completed,
            critical: task.critical || false,
            time: task.time || ''
          };
        });
        
        return `
          <div class="border-2 ${statusColor} rounded-xl p-4 month-card-admin ${isCurrentMonth ? 'current' : ''} ${isCompleted ? 'completed' : ''}">
            <div class="flex items-center justify-between mb-3">
              <div>
                <h4 class="font-bold text-gray-900">Month ${month.month}: ${month.title}</h4>
                <p class="text-sm text-gray-600 mt-1">${month.milestone}</p>
              </div>
              ${statusBadge}
            </div>
            
            <div class="mb-3">
              <div class="flex items-center justify-between text-sm mb-1">
                <span class="text-gray-600">Progress: ${monthCompleted}/${month.totalTasks} tasks</span>
                <span class="font-semibold">${monthProgress}%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-purple-600 h-2 rounded-full transition-all" style="width: ${monthProgress}%"></div>
              </div>
            </div>
            
            <div class="space-y-2">
              ${tasks.map(task => `
                <div class="flex items-start gap-2 text-sm task-item-admin ${task.completed ? 'completed' : ''} ${task.critical ? 'critical' : ''}">
                  <i class="bx ${task.completed ? 'bx-check-circle text-green-600' : 'bx-circle text-gray-400'} text-lg flex-shrink-0"></i>
                  <span class="${task.completed ? 'text-gray-600 line-through' : 'text-gray-900'}">
                    ${task.text}
                    ${task.critical ? '<span class="ml-2 px-2 py-0.5 bg-red-100 text-red-700 text-xs rounded font-semibold">CRITICAL</span>' : ''}
                    ${task.time ? `<span class="ml-2 text-gray-500">⏱ ${task.time}</span>` : ''}
                    ${task.id === 'engage_15' ? '<button type="button" class="ml-2 text-purple-600 underline hover:text-purple-800" onclick="openCommunityPopup()">View community channels</button>' : ''}
                  </span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }).join('');
    }

    function getTasksForMonth(monthNumber) {
      const tasksByMonth = {
        1: [
          { id: 'linkedin_course', text: 'Complete LinkedIn Warrior Course', time: '2 hours', critical: true },
          { id: 'submit_profile', text: 'Submit LinkedIn profile for audit', time: '30 mins', critical: true },
          { id: 'second_course', text: 'Complete Transformational Leadership Course', time: '3 hours', critical: true },
          { id: 'connect_10', text: 'Connect with 10 new people in your industry', time: '1 hour' },
          { id: 'post_3x', text: 'Announce your T4L Ambassador enrollment on LinkedIn', time: '2 hours' }
        ],
        2: [
        { id: 'implement_audit', text: 'Implement profile audit recommendations', time: '1 hour', critical: true },
        { id: 'third_course', text: 'Complete Science of You: Personality & Strengths', time: '2 hours', critical: true },
        { id: 'submit_article_1', text: 'Submit your first article idea', time: '45 mins' },
        { id: 'engage_15', text: 'Engage with 15 posts in T4L community (LinkedIn, Facebook, WhatsApp, X, YouTube, Instagram)', time: '1 hour' }
        ],
        3: [
          { id: 'first_event', text: 'Attend your first quarterly networking event', time: '2 hours', critical: true },
          { id: 'transformation_post', text: 'Post transformation update on LinkedIn (90 days)', time: '2 hours' },
          { id: 'submit_article_2', text: 'Submit second article (if first is published)', time: '3 hours' },
          { id: 'update_impact_log', text: 'Update your impact log', time: '30 mins' }
        ],
        4: [
          { id: 'volunteer', text: 'Volunteer for a leadership opportunity', time: '2 hours', critical: true },
          { id: 'complete_courses', text: 'AI Stacking 101', time: '4 hours', critical: true },
          { id: 'request_recommendation', text: 'Request letter of recommendation (if needed)', time: '1 hour' },
          { id: 'post_4x', text: 'Post 4x on LinkedIn this month', time: '2 hours' }
        ],
        5: [
          { id: 'lead_something', text: "Lead or co-lead (book club, session, event). If you haven't completed the form yet, please do so here.", time: '3 hours', critical: true },
          { id: 'check_article', text: 'Check article status and take action', time: '30 mins', critical: true },
          { id: 'daily_engage', text: 'Engage with Ambassadors content daily (5 min/day)', time: '2 hours' },
          { id: 'update_impact_5', text: 'Update impact log', time: '45 mins' }
        ],
        6: [
          { id: 'quarterly_event_2', text: 'Attend your second quarterly networking event', time: '2 hours', critical: true },
          { id: 'schedule_podcast', text: 'Schedule your podcast episode', time: '30 mins', critical: true },
          { id: 'halfway_story', text: 'Post your halfway transformation story', time: '2 hours' }
        ],
        7: [
          { id: 'submit_article_next', text: "Submit next article (if you haven't already)", time: '3 hours' },
          { id: 'lead_second', text: 'Host or lead an opportunity (if you haven\'t completed the form already)', time: '3 hours' },
          { id: 'post_4x_m7', text: 'Post consistently: 4x this month', time: '2 hours' }
        ],
        8: [
          { id: 'check_partners', text: 'Check T4L Partners portal weekly', time: '1 hour' },
          { id: 'update_speaker', text: 'Update Speaker Materials', time: '2 hours', critical: true },
          { id: 'speaking_pitch', text: 'Submit speaking pitch (outside T4L)', time: '3 hours' },
          { id: 'update_impact_8', text: 'Update impact log', time: '45 mins' }
        ],
        9: [
          { id: 'quarterly_event_3', text: 'Attend your Third quarterly networking event', time: '2 hours', critical: true },
          { id: 'follow_up_5', text: 'Follow up with 5 people from event', time: '1.5 hours', critical: true }
        ],
        10: [
          { id: 'submit_final', text: 'Submit final articles', time: '3 hours', critical: true },
          { id: 'update_impact_10', text: 'Update impact log', time: '45 mins', critical: true },
          { id: 'apply_speaking', text: 'Apply for 2+ speaking opportunities', time: '3 hours' }
        ],
        11: [
          { id: 'quarterly_event_4', text: 'Attend your Final quarterly networking event', time: '2 hours', critical: true },
          { id: 'final_impact', text: 'Complete final impact log', time: '2 hours', critical: true },
          { id: 'transformation_story', text: 'Post full year transformation story', time: '3 hours' }
        ],
        12: [
          { id: 'decide_renewal', text: 'Decide on renewal (Top Voices, free tier, or alumni)', time: '1 hour' },
          { id: 'schedule_call', text: 'Schedule renewal call with T4L', time: '30 mins' }
        ]
      };
      
      return tasksByMonth[monthNumber] || [];
    }

    // Close journey detail modal
    document.getElementById('closeJourneyDetail').addEventListener('click', () => {
      const modal = document.getElementById('journeyDetailModal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    });

    // UPDATED: Month 8 Speaker Materials Functions with 3 templates
    function openMonth8SpeakerPopup() {
      const popup = document.getElementById('month8SpeakerPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Reset selection
      selectedSpeakerCarouselIndex = 0;
      updateSpeakerCarouselSelection();
      resetSpeakerPopupState();
    }

    function closeMonth8SpeakerPopup() {
      const popup = document.getElementById('month8SpeakerPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function selectSpeakerCarousel(index) {
      selectedSpeakerCarouselIndex = index;
      updateSpeakerCarouselSelection();
    }

    function updateSpeakerCarouselSelection() {
      const options = document.querySelectorAll('#speakerCarouselOptions .carousel-option');
      options.forEach((option, index) => {
        if (index === selectedSpeakerCarouselIndex) {
          option.classList.add('selected');
        } else {
          option.classList.remove('selected');
        }
      });
    }

    function handleSpeakerFileSelect(event) {
      selectedSpeakerFile = event.target.files[0];
      const fileNameDisplay = document.getElementById('speakerFileName');
      const submitBtn = document.getElementById('speakerSubmitBtn');

      if (selectedSpeakerFile) {
        fileNameDisplay.textContent = `Selected: ${selectedSpeakerFile.name}`;
        fileNameDisplay.style.color = '#3a0a63';
        fileNameDisplay.style.fontWeight = 'bold';
        submitBtn.disabled = false;
        uploadedSpeakerFileName = selectedSpeakerFile.name;
      } else {
        fileNameDisplay.textContent = 'No file selected';
        fileNameDisplay.style.color = '#666';
        submitBtn.disabled = true;
        uploadedSpeakerFileName = '';
      }
    }

    function uploadSpeakerMaterials() {
      if (!selectedSpeakerFile) {
        alert('Please select a file first!');
        return;
      }

      const submitBtn = document.getElementById('speakerSubmitBtn');
      const emailBtn = document.getElementById('emailBtn');
      const successMsg = document.getElementById('speakerSuccessMsg');

      submitBtn.innerHTML = '<i class="bx bx-loader-alt bx-spin"></i> Preparing...';
      submitBtn.disabled = true;

      // Simulate upload/processing
      setTimeout(() => {
        successMsg.classList.add('show');

        setTimeout(() => {
          submitBtn.classList.add('hidden');
          emailBtn.classList.remove('hidden');

          successMsg.innerHTML = '<i class="bx bx-check-circle"></i> Ready! Click "Open Email" to submit your materials.';
        }, 1000);
      }, 1500);
    }

    function openEmailWithMaterials() {
      const subject = 'Updated Speaker Materials - Month 8';
      const body = `Hello T4L Team,

Please find my updated speaker materials attached.

Name: [Your Full Name]
LinkedIn Profile: [Your LinkedIn URL]
Current Month: Month 8

Materials included:
- Updated speaker introduction script
- [Add any other materials you're submitting]

Notes: [Add any specific notes or requests]

Thank you,
[Your Name]`;

      const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=ambassadors@t4leader.com&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      
      window.open(gmailUrl, '_blank');
      
      // Show confirmation
      setTimeout(() => {
        alert('Email opened! Please attach your file and send it to complete this task.\n\nReturn here and mark the task as complete when done.');
      }, 1000);
    }

    function resetSpeakerPopupState() {
      selectedSpeakerFile = null;
      document.getElementById('speakerFile').value = '';
      document.getElementById('speakerFileName').textContent = 'No file selected';
      document.getElementById('speakerFileName').style.color = '#666';
      document.getElementById('speakerSubmitBtn').innerHTML = '<i class="bx bx-send"></i> Email Your Materials';
      document.getElementById('speakerSubmitBtn').disabled = true;
      document.getElementById('speakerSubmitBtn').classList.remove('hidden');
      document.getElementById('emailBtn').classList.add('hidden');
      document.getElementById('speakerSuccessMsg').classList.remove('show');
    }

    // Global function to ensure scrolling is always enabled
    function ensureScrollEnabled() {
      // Check if any popup is currently open
      const openPopups = document.querySelectorAll('.popup-overlay:not(.hidden), .celebration-popup.active');
      if (openPopups.length === 0) {
        // No popups open, ensure scroll is enabled
        document.body.style.overflow = '';
        document.body.style.overflow = 'auto';
        document.documentElement.style.overflow = '';
        document.documentElement.style.overflow = 'auto';
      }
    }

    // Celebration popup functions
    function openCompletionCelebration() {
      const popup = document.getElementById('completionCelebration');
      if (popup) {
        popup.classList.remove('hidden');
        popup.classList.add('active');
        document.body.style.overflow = 'hidden';

        // Add confetti effect
        createConfetti();
      }
    }

    // Daily Reminder Functions
    function showDailyReminder(motivationalMessage, taskName) {
      const popup = document.getElementById('dailyReminderPopup');
      const messageEl = document.getElementById('dailyReminderMessage');
      const taskEl = document.getElementById('dailyReminderTaskName');
      
      if (!popup) return;

      // Safety filter: remove deprecated message text if it ever appears
      if (typeof motivationalMessage === 'string' && motivationalMessage.includes('Remember why you started')) {
        motivationalMessage = '💪 Keep pushing forward!';
      }
      
      // Set the content
      if (messageEl) messageEl.textContent = motivationalMessage;
      if (taskEl) taskEl.textContent = taskName;
      
      // Show the popup
      popup.classList.remove('hidden');
      popup.classList.add('active');
      document.body.style.overflow = 'hidden';
      
      console.log('✅ Daily reminder shown:', { motivationalMessage, taskName });
    }

    function closeDailyReminder() {
      const popup = document.getElementById('dailyReminderPopup');
      if (!popup) return;
      
      popup.classList.remove('active');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
      document.documentElement.style.overflow = 'auto';
      
      // Store that reminder was seen today
      const today = new Date().toDateString();
      localStorage.setItem('dailyReminderSeen', today);
      // Also update the last shown timestamp
      localStorage.setItem('dailyReminderLastShown', Date.now().toString());
    }

    // Close reminder when clicking outside
    document.addEventListener('DOMContentLoaded', function() {
      const popup = document.getElementById('dailyReminderPopup');
      if (popup) {
        popup.addEventListener('click', (e) => {
          if (e.target === popup) {
            closeDailyReminder();
          }
        });
      }
    });

    function closeCompletionCelebration() {
      const popup = document.getElementById('completionCelebration');
      if (popup) {
        popup.classList.remove('active');
        popup.classList.add('hidden');
        // Always restore body scroll
        document.body.style.overflow = '';
        document.body.style.overflow = 'auto';
        // Also ensure html can scroll
        document.documentElement.style.overflow = '';
        document.documentElement.style.overflow = 'auto';
        // Ensure scroll is enabled after a brief delay
        setTimeout(ensureScrollEnabled, 100);
      }
    }

    // Simple confetti effect
    function createConfetti() {
      const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
      const confettiContainer = document.createElement('div');
      confettiContainer.style.position = 'fixed';
      confettiContainer.style.top = '0';
      confettiContainer.style.left = '0';
      confettiContainer.style.width = '100%';
      confettiContainer.style.height = '100%';
      confettiContainer.style.pointerEvents = 'none';
      confettiContainer.style.zIndex = '9999';
      document.body.appendChild(confettiContainer);

      for (let i = 0; i < 150; i++) {
        const confetti = document.createElement('div');
        confetti.innerHTML = ['🎉', '🎊', '🌟', '⭐', '🎈', '🔥'][Math.floor(Math.random() * 6)];
        confetti.style.position = 'absolute';
        confetti.style.fontSize = Math.random() * 20 + 10 + 'px';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.top = '-50px';
        confetti.style.opacity = Math.random() + 0.5;
        confettiContainer.appendChild(confetti);

        // Animation
        const animation = confetti.animate([
          { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
          { transform: `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
        ], {
          duration: Math.random() * 3000 + 2000,
          easing: 'cubic-bezier(0.1, 0.2, 0.8, 0.9)'
        });

        animation.onfinish = () => confetti.remove();
      }

      // Remove confetti container after animation
      setTimeout(() => {
        if (document.body.contains(confettiContainer)) {
          document.body.removeChild(confettiContainer);
        }
      }, 5000);
    }

    // UPDATED: Transformation Story Email Function
    function emailTransformationStory() {
      const subject = 'Transformation Story Submission';
      const body = `Hello T4L Team,

I have completed my transformation story as part of the ambassador journey.

Please find my completed transformation story attached.

Name: [Your Full Name]
Ambassador ID: [Your Ambassador ID]
Current Month: [Month Number]

I've included:
- My personal journey story
- Before/after insights
- Key milestones achieved
- [Add any other details]

Thank you,
[Your Name]`;

      const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=ambassadors@t4leader.com&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      
      window.open(gmailUrl, '_blank');
      
      // Show success message
      const successMsg = document.getElementById('successMsg');
      successMsg.classList.add('show');
      
      setTimeout(() => {
        alert('Email opened! Please attach your completed transformation story file and send it to complete this task.');
      }, 1000);
    }

    // Popup Functions
    function openTransformationPopup() {
      const popup = document.getElementById('transformationPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      resetTransformationPopupState();
    }

    function closeTransformationPopup() {
      const popup = document.getElementById('transformationPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function resetTransformationPopupState() {
      // Reset success message
      const successMsg = document.getElementById('successMsg');
      successMsg.classList.remove('show');
    }

    // T4L Community popup helpers
    function openCommunityPopup() {
      const popup = document.getElementById('communityPopup');
      if (!popup) return;
      popup.classList.remove('hidden');
      popup.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }

    function closeCommunityPopup() {
      const popup = document.getElementById('communityPopup');
      if (!popup) return;
      popup.classList.add('hidden');
      popup.classList.remove('flex');
      document.body.style.overflow = 'auto';
    }

    // UPDATED: Month 1 Carousel Functions with 3 options
    function openMonth1CarouselPopup() {
      const popup = document.getElementById('month1CarouselPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      // Reset selection and generate LinkedIn URL
      selectedMonth1CarouselIndex = 0;
      updateMonth1CarouselSelection();
      const linkedinUrl = generateMonth1LinkedInPostUrl();
      document.getElementById('month1LinkedinBtn').href = linkedinUrl;
    }

    function closeMonth1CarouselPopup() {
      const popup = document.getElementById('month1CarouselPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function selectMonth1Carousel(index) {
      selectedMonth1CarouselIndex = index;
      updateMonth1CarouselSelection();

      // Update LinkedIn URL with selected carousel
      const linkedinUrl = generateMonth1LinkedInPostUrl();
      document.getElementById('month1LinkedinBtn').href = linkedinUrl;
    }

    function updateMonth1CarouselSelection() {
      const options = document.querySelectorAll('#month1CarouselOptions .carousel-option');
      options.forEach((option, index) => {
        if (index === selectedMonth1CarouselIndex) {
          option.classList.add('selected');
        } else {
          option.classList.remove('selected');
        }
      });
    }

    function openMonth11YearEndPopup() {
      const popup = document.getElementById('month11YearEndPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      // Generate LinkedIn URL for Year End
      const linkedinUrl = generateMonth11LinkedInPostUrl();
      document.getElementById('month11LinkedinBtn').href = linkedinUrl;
    }

    function closeMonth11YearEndPopup() {
      const popup = document.getElementById('month11YearEndPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    // Month 4 Multi-Carousel Popup Functions
    function openMonth4CarouselPopup() {
      const popup = document.getElementById('month4CarouselPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      // Reset selection and generate LinkedIn URL
      selectedCarouselIndex = 0;
      updateCarouselSelection();
      const linkedinUrl = generateMonth4LinkedInPostUrl();
      document.getElementById('month4LinkedinBtn').href = linkedinUrl;
    }

    function closeMonth4CarouselPopup() {
      const popup = document.getElementById('month4CarouselPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function selectCarousel(index) {
      selectedCarouselIndex = index;
      updateCarouselSelection();

      // Update LinkedIn URL with selected carousel
      const linkedinUrl = generateMonth4LinkedInPostUrl();
      document.getElementById('month4LinkedinBtn').href = linkedinUrl;
    }

    function updateCarouselSelection() {
      const options = document.querySelectorAll('#month4CarouselPopup .carousel-option');
      options.forEach((option, index) => {
        if (index === selectedCarouselIndex) {
          option.classList.add('selected');
        } else {
          option.classList.remove('selected');
        }
      });
    }

    // Month 7 Multi-Carousel Popup Functions
    function openMonth7CarouselPopup() {
      const popup = document.getElementById('month7CarouselPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';

      // Reset selection and generate LinkedIn URL
      selectedCarouselIndexMonth7 = 0;
      updateCarouselSelectionMonth7();
      const linkedinUrl = generateMonth7LinkedInPostUrl();
      document.getElementById('month7LinkedinBtn').href = linkedinUrl;
    }

    function closeMonth7CarouselPopup() {
      const popup = document.getElementById('month7CarouselPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function selectCarouselMonth7(index) {
      selectedCarouselIndexMonth7 = index;
      updateCarouselSelectionMonth7();

      // Update LinkedIn URL with selected carousel
      const linkedinUrl = generateMonth7LinkedInPostUrl();
      document.getElementById('month7LinkedinBtn').href = linkedinUrl;
    }

    function updateCarouselSelectionMonth7() {
      const options = document.querySelectorAll('#carouselOptionsMonth7 .carousel-option');
      options.forEach((option, index) => {
        if (index === selectedCarouselIndexMonth7) {
          option.classList.add('selected');
        } else {
          option.classList.remove('selected');
        }
      });
    }

    // Profile Audit Popup Functions
    function openProfileAuditPopup() {
      const popup = document.getElementById('profileAuditPopup');
      popup.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeProfileAuditPopup() {
      const popup = document.getElementById('profileAuditPopup');
      popup.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    function submitProfileForReview() {
      const profileUrl = document.getElementById('profileUrl').value;
      const successMsg = document.getElementById('profileSuccessMsg');

      if (!profileUrl) {
        alert('Please enter your LinkedIn profile URL');
        return;
      }

      successMsg.classList.add('show');

      // Simulate API call
      setTimeout(() => {
        alert('Profile submitted for review! Our team will get back to you within 48 hours.');
      }, 1000);
    }

    function generateMonth1LinkedInPostUrl() {
      const postText = `Exciting News!

I'm pleased to announce that I have been selected as Transformation Leader (T4L), Top Voice Ambassador.

T4L helps organisations move from top-down control to a culture of collaboration. Our mission is to impact one million lives by the end of this year—but more importantly, it's about being part of an ecosystem building digital leaders who are driving transformation not only in their organisations but in their communities.

This opportunity represents my commitment to positive impact and sustainable change.

#DigitalTransformation #Leadership #T4L #TopVoice`;

      return `https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(postText)}`;
    }

    // Generate LinkedIn URL for Month 4
    function generateMonth4LinkedInPostUrl() {
      const postText = `Continuing my journey as a T4L Top Voice Ambassador! 🚀

This month, I'm diving deeper into leadership development and community impact. Every conversation, every connection, and every challenge is shaping me into a better leader.

Grateful for this platform that allows me to grow while contributing to meaningful change in our digital landscape.

#LeadershipDevelopment #CommunityImpact #T4L #DigitalTransformation`;

      return `https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(postText)}`;
    }

    // Generate LinkedIn URL for Month 7
    function generateMonth7LinkedInPostUrl() {
      const postText = `Month 7 of my T4L Ambassador journey! 🌟

As I continue to grow in visibility and leadership, I'm excited to share insights from my journey. This month has been about building momentum and creating meaningful content that resonates with our community.

The connections I'm making and the impact we're creating together continue to inspire me every day.

#T4L #LeadershipJourney #DigitalTransformation #CommunityImpact`;

      return `https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(postText)}`;
    }

    function generateMonth11LinkedInPostUrl() {
      const postText = `Session Reflection (Month 11)
Reflecting on My Journey
Almost a year ago, I stepped into the role of Transformation Leader (T4L) Top Voice Ambassador. Here's what I didn't expect:
The conversations mattered more than the content. The community became as valuable as the information received. And the transformation I set out to share? It started with me.
[Share a specific insight, story, or outcome from your experience]
To anyone considering this path—the investment in yourself ripples outward in ways you can't predict.
#DigitalLeadership #PersonalGrowth #T4L #Transformation`;

      return `https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(postText)}`;
    }

    function generateTransformationPostUrl() {
      const postText = `Three months into my journey as a @Transformation Leader (T4L) Top Voice Ambassador, and this quote keeps coming back to me.
When I first joined this movement, I thought transformation was about systems and processes. I've since learned it's really about people: how we lead, how we collaborate, and how we create space for others to grow.
What quote guides your approach to leadership or change?
#Leadership #Transformation #GrowthMindset`;

      return `https://www.linkedin.com/feed/?shareActive=true&text=${encodeURIComponent(postText)}`;
    }

    // UPDATED: Month 1 LinkedIn Post Function with 3 options
    function postMonth1ToLinkedIn() {
      console.log('User posting Month 1 announcement to LinkedIn, selected carousel:', selectedMonth1CarouselIndex);

      fetch('/api/track-linkedin-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: 'month1_announcement',
          carouselIndex: selectedMonth1CarouselIndex,
          timestamp: new Date().toISOString()
        })
      }).catch(err => console.log('Analytics tracking failed:', err));

      setTimeout(() => {
        alert(`🎉 Amazing! Your T4L Ambassador announcement (with the ${['White Logo', 'Purple Logo', 'Yellow Logo'][selectedMonth1CarouselIndex]} style) is now being shared on LinkedIn!\n\nWelcome to the T4L Ambassador family! 🚀`);
      }, 1000);
    }

    // Month 4 LinkedIn Post Function
    function postMonth4ToLinkedIn() {
      console.log('User posting Month 4 carousel to LinkedIn, selected:', selectedCarouselIndex);

      fetch('/api/track-linkedin-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: 'month4_carousel',
          carouselIndex: selectedCarouselIndex,
          timestamp: new Date().toISOString()
        })
      }).catch(err => console.log('Analytics tracking failed:', err));

      setTimeout(() => {
        alert('🎨 Excellent! Your selected carousel is now being shared on LinkedIn!\n\nKeep up the great content creation! 📱');
      }, 1000);
    }

    // Month 7 LinkedIn Post Function
    function postMonth7ToLinkedIn() {
      console.log('User posting Month 7 carousel to LinkedIn, selected:', selectedCarouselIndexMonth7);

      fetch('/api/track-linkedin-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: 'month7_carousel',
          carouselIndex: selectedCarouselIndexMonth7,
          timestamp: new Date().toISOString()
        })
      }).catch(err => console.log('Analytics tracking failed:', err));

      setTimeout(() => {
        alert('🌟 Fantastic! Your Month 7 carousel is now being shared on LinkedIn!\n\nYour visibility and impact continue to grow! 🚀');
      }, 1000);
    }

    function postMonth11ToLinkedIn() {
      console.log('User posting Month 11 year-end reflection to LinkedIn');

      fetch('/api/track-linkedin-post', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: 'month11_year_end',
          timestamp: new Date().toISOString()
        })
      }).catch(err => console.log('Analytics tracking failed:', err));

      setTimeout(() => {
        alert('🌟 Incredible! Your year-end transformation story is now being shared on LinkedIn!\n\nWhat an amazing journey it has been! 🎊');
      }, 1000);
    }

    // Mock fetch for demo
    if (!window.fetch.polyfilled) {
      const originalFetch = window.fetch;
      window.fetch = function (url, options) {
        if (url === '/api/upload-template') {
          return new Promise((resolve) => {
            setTimeout(() => {
              resolve({
                ok: true,
                json: () => Promise.resolve({ success: true, fileName: 'transformation-story.pdf' })
              });
            }, 1500);
          });
        }
        if (url === '/api/track-linkedin-post') {
          return new Promise((resolve) => {
            setTimeout(() => {
              resolve({
                ok: true,
                json: () => Promise.resolve({ tracked: true })
              });
            }, 500);
          });
        }
        return originalFetch(url, options);
      };
      window.fetch.polyfilled = true;
    }

    // Toast Component
    function Toast({ message, type, onClose }) {
      useEffect(() => {
        const timer = setTimeout(() => onClose(), 3000);
        return () => clearTimeout(timer);
      }, [onClose]);
      return (
        <div className={`toast ${type}`}>
          {message}
        </div>
      );
    }

    // Task Item Component
    function TaskItem({ task, monthIndex, isCompleted, onToggle, isLocked, hasCertificate, onRequestCertificateUpload }) {
      const getTaskAction = (taskId) => {
        const actions = {
          'linkedin_course': 'https://www.t4leader.com/challenge-page/linkedin-warrior-set-up-your-profile?programId=51ebfc25-4d89-4894-b317-9a607bb0d7e2',
          'submit_profile': 'email',
          'second_course': 'https://www.t4leader.com/challenge-page/transformational-leadership?programId=d4e58ca0-f0e6-4f12-b2a8-9dc5fcf6e335',
          'connect_10': 'https://www.linkedin.com/',
          'post_3x': 'popup:month1-carousel',
          'implement_audit': 'popup:audit-recommendations', // Changed to new popup
          'third_course': 'https://www.t4leader.com/challenge-page/the-science-of-you-personality-strengths-for-growth?programId=18da4c45-2f2d-4535-9bf3-fd3672ec8121',
          'submit_article_1': '/article-amb.html',
          'engage_15': 'https://www.linkedin.com/company/t4leader/posts/?feedView=all',
          'first_event': 'https://www.t4leader.com/ambassador-events',
          'follow_up_3': 'https://www.linkedin.com/mynetwork/',
          'transformation_post': 'popup:transformation',
          'submit_article_2': '/article-amb.html',
          'update_impact_log': '/impactlog-ambassador.html',
          'post_5x': 'popup:month1-carousel',
          'volunteer': 'https://survey.zohopublic.com/zs/BcDAGm',
          'complete_courses': 'https://www.t4leader.com/challenge-page/4973307e-2f81-4641-a160-ca5fde2db9b6?programId=4973307e-2f81-4641-a160-ca5fde2db9b6',
          'request_recommendation': 'https://survey.zohopublic.com/zs/UgMRQs',
          'post_4x': 'popup:month4-carousel',
          'lead_something': 'https://survey.zohopublic.com/zs/BcDAGm',
          'check_article': '/article-progress.html',
          'daily_engage': 'https://www.linkedin.com/company/t4leader/posts/?feedView=all',
          'update_impact_5': '/impactlog-ambassador.html',
          'webinar_1': 'https://www.t4leader.com/ambassador-events',
          'quarterly_event_2': 'https://www.t4leader.com/ambassador-events',
          'review_progress': '/journey.html?view=review',
          'schedule_podcast': 'https://cal.com/shameless-podcast-t4l/20-mins-shameless-guest-pre-interview-call',
          'halfway_story': 'popup:transformation',
          'prep_podcast': '/podcast.html?action=prep',
          'submit_article_next': '/article-amb.html',
          'lead_second': 'https://survey.zohopublic.com/zs/BcDAGm',
          'post_4x_m7': 'popup:month7-carousel',
          'engage_30': 'https://www.linkedin.com/company/t4leader/posts/?feedView=all',
          'record_podcast': '/podcast.html?action=record',
          'check_partners': '/Partner-Calls.html',
          'update_speaker': 'popup:month8-speaker',
          'speaking_pitch': 'email:speaking_pitch',
          'update_impact_8': '/impact-log.html',
          'quarterly_event_3': 'https://www.t4leader.com/ambassador-events',
          'follow_up_5': 'email:follow_up',
          'promote_podcast': 'popup:month1-carousel',
          'lead_third': '/leadership.html?action=lead',
          'article_2': '/article-amb.html',
          'submit_final': '/article-amb.html?type=final',
          'update_impact_10': '/impact-log.html',
          'post_impact': 'popup:month1-carousel',
          'apply_speaking': 'email:speaking_opportunity',
          'quarterly_event_4': 'https://www.t4leader.com/ambassador-events',
          'final_impact': '/impact-log.html?view=final',
          'transformation_story': 'popup:month11-year-end',
          'update_bio': '/profile.html?action=bio',
          'testimonial': 'https://www.linkedin.com/help/linkedin/answer/a552002',
          'review_year': '/journey.html?view=year-review',
          'update_materials': '/profile.html?action=materials',
          'celebration_post': 'popup:month1-carousel',
          'decide_renewal': 'https://survey.zohopublic.com/zs/BcDAGm',
          'schedule_call': 'https://calendar.google.com/calendar/u/0/appointments/schedules/AcZssZ1nAFZPpZCaSOPs_9iDVJ4OuA4OT8yAq9hJ63ZmILe63YRocCIrnqtTXZbBmER9FGlB8xPlTiA7',
          'portfolio_final': '/profile.html?action=portfolio'
        };
        return actions[taskId] || '#';
      };

      const handleTaskStart = () => {
        // Special handling: Month 2 "engage_15" community task should open the community popup
        if (task.id === 'engage_15') {
          if (typeof openCommunityPopup === 'function') {
            openCommunityPopup();
            return;
          }
        }

        const action = getTaskAction(task.id);

        if (action === 'popup:transformation') {
          openTransformationPopup();
        } else if (action === 'popup:month1-carousel') {
          openMonth1CarouselPopup();
        } else if (action === 'popup:month4-carousel') {
          openMonth4CarouselPopup();
        } else if (action === 'popup:month7-carousel') {
          openMonth7CarouselPopup();
        } else if (action === 'popup:month8-speaker') {
          openMonth8SpeakerPopup();
        } else if (action === 'popup:month11-year-end') {
          openMonth11YearEndPopup();
        } else if (action === 'popup:profile-audit') {
          openProfileAuditPopup();
        } else if (action === 'popup:audit-recommendations') {
          // Open the profile audit recommendations popup
          openProfileAuditRecommendationsPopup();
        } else if (action === 'email' || action.startsWith('email:')) {
          let subject, body;

          const emailType = action === 'email' ? 'default' : action.split(':')[1];

          if (emailType === 'speaking_pitch') {
            subject = 'Transformation Update & Personal Topic Inquiry';
            body = `TRANSFORMATION
Subject: [Flexible, hard] Status or [in fact future]
By David:

It is not a touch of the reflection for herself. Hard!
Your audience at Black's address about global & society don't work with. Help them (practice reviews per share).


Personal Topic: "Everything's Jessica, Tate"
What standard will I have?

[Flexible, stationary (*)]
[Flexible, stationary *)]
[Flexible, stationary *)]

Why are you the reasons to identify, resolve, undertake, or advance experience, for systems of personal? Is this applicable with your audience at Facebook?
Here's my question pages: [Best use of Advanced speakers over this].
Are you open to a 1 different online dataset to?
Note:
[First Name]
[Title]`;
          } else if (emailType === 'follow_up') {
            subject = 'Great connecting at [Event Name]!';
            body = `Hi [Name],

It was great meeting you at [Event Name/Q[X] Ambassador Gathering] on [day/date]. I really enjoyed our conversation about [specific topic you discussed—e.g., "how you're approaching digital adoption in your team" / "the challenges of leading change in traditional industries" / "your experience with stakeholder buy-in"].

[Choose one or customise:]
* Your perspective on [specific point they made] stuck with me, and I've been thinking about how I might apply that in my own context.
* I was inspired by what you shared about [specific project/challenge/success]. It's clear you're doing meaningful work.
* I appreciated your honesty about [challenge they mentioned]—it's reassuring to know others are navigating similar terrain.

I'd love to stay connected and continue learning from your journey.
[Choose one or customise:]
* Would you be open to a quick virtual coffee in the coming weeks?
* Let's keep in touch—I'll look out for you at the next quarterly event.
* If there's ever anything I can support you with, please don't hesitate to reach out.

In the meantime, here's [optional: a resource, article, or link related to your conversation] that reminded me of what we discussed.

Looking forward to staying connected.

Warm regards,
[Your name]
[Your role/organisation]
[LinkedIn profile link]
[Optional: T4L Ambassador badge/signature]

Shorter Alternative (for LinkedIn message follow-up):
Hi [Name], it was great connecting at [Event Name]! I enjoyed our chat about [topic]. Let's stay in touch—I'd love to hear how [specific thing they mentioned] progresses. Feel free to reach out anytime.`;
          } else if (emailType === 'speaking_opportunity') {
            subject = 'Apply for 2+ speaking opportunities';
            body = `Subject: [Topic] Workshop for [Company Name] Team

Hi [Name],

I work with [similar companies/industries] helping [target audience] achieve [specific outcome].
I'd love to bring this to [Company Name]'s [team/department].

Session: "[Title]"

Format: [x-minute] office workshop/presentation/interactive session]

What your team will walk away with:

[Professional takeaway #1]

[Professional takeaway #2]

[Professional takeaway #3]

Relevant experience: [One sentence about why you're credible for this audience].

I'm flexible on format and happy to customize to your team's needs.

Does [date/time] work for a quick call to discuss?

Best,
[Your Name]
[Title]
[Phone]`;
          } else {
            subject = 'LinkedIn Profile Audit Request';
            body = 'Hello,\n\nName: [Your Full Name]\nCompany: [Your Company Name]\n\nPlease review my LinkedIn profile and provide feedback to help me optimize it.\n\nLinkedIn Profile: [Paste your LinkedIn URL here]\n\nLinkedIn analytics screenshot (if possible): [Attach here]\n\nThank you for your time.\n\nBest regards,\n[Your Full Name]';

          }
          const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=ambassadors@t4leader.com&su=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
          window.open(gmailUrl, '_blank');
        } else if (action.startsWith('http')) {
          window.open(action, '_blank');
        } else {
          window.location.href = action;
        }
      };

      const requiresCertificate = ['linkedin_course', 'second_course', 'third_course', 'complete_courses'].includes(task.id);

      return (
        <div className={`border-2 rounded-xl p-4 transition-all bg-white hover:shadow-lg hover:scale-[1.01] ${isCompleted ? 'border-gray-200 bg-gray-50/30' : 'border-gray-200'
          }`}>
          <div className="flex items-start justify-between gap-3">
            <div className="flex items-start gap-3 flex-1">
              <input
                type="checkbox"
                id={`task-${monthIndex}-${task.id}`}
                checked={isCompleted}
                onChange={() => {
                  if (isLocked) return;
                  if (requiresCertificate && !hasCertificate) {
                    if (typeof onRequestCertificateUpload === 'function') {
                      onRequestCertificateUpload(task.id);
                    }
                    return;
                  }
                  onToggle(monthIndex, task.id);
                }}
                disabled={isLocked}
                className="w-5 h-5 text-[#4b0d7f] rounded border-gray-300 focus:ring-[#4b0d7f] mt-0.5 cursor-pointer disabled:opacity-50"
              />
              <div className="flex-1">
                <label
                  htmlFor={`task-${monthIndex}-${task.id}`}
                  className={`block font-medium cursor-pointer ${isCompleted ? 'text-gray-600 line-through opacity-75' : 'text-gray-900'
                    }`}
                >
                  {task.text}
                </label>
                {(task.time || task.deadline) && (
                  <div className="text-xs text-gray-500 mt-1">
                    {task.time && <span>⏱ {task.time}</span>}
                    {task.deadline && <span className={task.time ? ' ml-2' : ''}>📅 {task.deadline}</span>}
                  </div>
                )}
              </div>
            </div>

            <div className="flex items-center gap-2 flex-shrink-0">
              {task.critical && !isCompleted && (
                <span className="bg-red-100 text-red-700 text-xs px-2 py-1 rounded font-semibold whitespace-nowrap">
                  CRITICAL
                </span>
              )}

              {!isCompleted && !isLocked && (
                <button
                  onClick={handleTaskStart}
                  className="px-4 py-2 bg-[#4b0d7f] hover:bg-[#3a0a63] text-white text-sm font-semibold rounded-lg transition-colors whitespace-nowrap shadow-md hover:shadow-lg"
                >
                  Start Task →
                </button>
              )}

              {isCompleted && (
                <span className="text-gray-500 text-sm font-medium whitespace-nowrap flex items-center gap-1">
                  <i className="bx bx-check-circle"></i> Done
                </span>
              )}
            </div>
          </div>
        </div>
      );
    }

    // Month Card Component
    function MonthCard({ month, currentMonth, completedTasks, onToggleTask, onNextMonth, certificateMap, onRequestCertificateUpload }) {
      const monthIndex = month.month;
      const isCurrent = monthIndex === currentMonth;
      const isCompleted = monthIndex < currentMonth;
      const isLocked = monthIndex > currentMonth;

      const completedCount = month.tasks.filter(task => completedTasks[`${monthIndex}-${task.id}`]).length;
      const totalTasks = month.tasks.length;
      const progress = totalTasks > 0 ? (completedCount / totalTasks) * 100 : 0;
      const allCriticalDone = month.tasks.filter(task => task.critical).every(task => completedTasks[`${monthIndex}-${task.id}`]);
      const allDone = completedCount === totalTasks;

      const getStatusConfig = () => {
        if (isCompleted) {
          return {
            bg: 'bg-gray-50',
            border: 'border-gray-200',
            badge: 'bg-gray-200 text-gray-700',
            label: 'COMPLETED',
            icon: 'bx-check-circle',
            iconColor: 'text-gray-500',
            progressColor: 'bg-gray-400',
            metricColor: 'text-gray-600'
          };
        } else if (isCurrent) {
          return {
            bg: 'bg-[#f5f0ff]',
            border: 'border-[#4b0d7f]',
            badge: 'bg-[#4b0d7f] text-white',
            label: 'CURRENT',
            icon: 'bx-circle',
            iconColor: 'text-[#4b0d7f]',
            progressColor: 'bg-[#4b0d7f]',
            metricColor: 'text-[#4b0d7f]'
          };
        } else {
          return {
            bg: 'bg-slate-50',
            border: 'border-slate-300',
            badge: 'bg-slate-300 text-slate-700',
            label: 'UPCOMING',
            icon: 'bx-lock-alt',
            iconColor: 'text-slate-500',
            progressColor: 'bg-slate-400',
            metricColor: 'text-slate-600'
          };
        }
      };

      const config = getStatusConfig();

      return (
        <div className={`journey-card ${config.bg} border-2 ${config.border} rounded-2xl p-6 mb-6 shadow-lg hover:shadow-xl transition-all duration-300 ${isLocked ? 'opacity-60' : ''}`}>
          <div className="flex items-start justify-between mb-4">
            <div className="flex items-center gap-4">
              <div className={`${config.iconColor} text-3xl flex items-center justify-center w-12 h-12 rounded-xl bg-white shadow-sm`}>
                <i className={`bx ${config.icon}`}></i>
              </div>
              <div>
                <h3 className="text-xl font-bold text-gray-900">
                  Month {monthIndex}: {month.title}
                </h3>
                <p className="text-sm text-gray-600 mt-1">{month.milestone}</p>
              </div>
            </div>
            <span className={`px-4 py-2 ${config.badge} rounded-lg text-xs font-bold whitespace-nowrap shadow-sm`}>
              {config.label}
            </span>
          </div>

          <div className="mb-4">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm font-medium text-gray-700">
                Progress: {completedCount} / {totalTasks} tasks
              </span>
              <span className="text-sm font-semibold text-gray-700">{Math.round(progress)}%</span>
            </div>
            <div className="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
              <div
                className={`${config.progressColor} h-3 rounded-full transition-all duration-500 shadow-sm`}
                style={{ width: `${progress}%` }}
              ></div>
            </div>
          </div>

          <div className="space-y-3 mb-4">
            {month.tasks.map(task => {
              const courseTaskToType = {
                linkedin_course: 'linkedin_course',
                second_course: 'transformational_course',
                third_course: 'science_of_you',
                complete_courses: 'ai_stacking',
              };
              const courseType = courseTaskToType[task.id];
              const hasCertificate = courseType
                ? Boolean(certificateMap[courseType])
                : false;

              return (
                <TaskItem
                  key={task.id}
                  task={task}
                  monthIndex={monthIndex}
                  isCompleted={!!completedTasks[`${monthIndex}-${task.id}`]}
                  onToggle={onToggleTask}
                  isLocked={isLocked}
                  hasCertificate={hasCertificate}
                  onRequestCertificateUpload={onRequestCertificateUpload}
                />
              );
            })}
          </div>

          {/* Journey progression guidance and actions */}
          {isCurrent && !allCriticalDone && (
            <div className="mt-4 p-3 bg-gray-100 border border-gray-300 rounded-lg">
              <p className="text-sm text-gray-700">
                ⚠️ Complete all <span className="font-semibold">critical</span> tasks to unlock the next month.
              </p>
            </div>
          )}

          {isCurrent && allCriticalDone && monthIndex < 12 && (
            <div className="mt-4 flex justify-end">
              <button
                type="button"
                onClick={onNextMonth}
                className="inline-flex items-center px-4 py-2 bg-[#4b0d7f] hover:bg-[#3a0a63] text-white text-sm font-semibold rounded-lg shadow-md hover:shadow-lg transition-colors"
              >
                Move to Month {monthIndex + 1} →
              </button>
            </div>
          )}

          {isCurrent && allCriticalDone && monthIndex === 12 && (
            <div className="mt-4 flex justify-end">
              <button
                type="button"
                onClick={onNextMonth}
                className="inline-flex items-center px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-semibold rounded-lg shadow-md hover:shadow-lg transition-colors"
              >
                🎉 Finish My 12‑Month Journey
              </button>
            </div>
          )}
        </div>
      );
    }

    // Main App Component with localStorage persistence
    function App() {
      const [journeyData, setJourneyData] = useState({
        currentMonth: 1,
        completedTasks: {},
        months: [
          {
            month: 1,
            title: "Foundation Building",
            milestone: "Establish your digital presence and complete core training",
            tasks: [
              { id: 'linkedin_course', text: 'Complete LinkedIn Warrior Course', time: '2 hours', critical: true },
              { id: 'submit_profile', text: 'Submit LinkedIn profile for audit', time: '30 mins', critical: true },
              { id: 'second_course', text: 'Complete Transformational Leadership Course', time: '3 hours', critical: true },
              { id: 'connect_10', text: 'Connect with 10 new people in your industry', time: '1 hour' },
              { id: 'post_3x', text: 'Announce your T4L Ambassador enrollment on LinkedIn', time: '2 hours' }
            ],
            metrics: {
              COURSES: 2,
              CONNECTIONS: 10,
              POSTS: 3
            }
          },
          {
            month: 2,
            title: "Content Creation & Community Engagement",
            milestone: "Start creating valuable content and engage with the full T4L community",
            tasks: [
              { id: 'implement_audit', text: 'Implement profile audit recommendations', time: '1 hour', critical: true },
              { id: 'third_course', text: 'Complete Science of You: Personality & Strengths', time: '2 hours', critical: true },
              { id: 'submit_article_1', text: 'Submit your first article idea', time: '45 mins' },
              { id: 'engage_15', text: 'Engage with 15 posts across T4L community channels', time: '1 hour' },
            ],
            metrics: {
              ARTICLES: 1,
              ENGAGEMENT: 15,
              POSTS: 5
            }
          },
          {
            month: 3,
            title: "ENGAGE",
            milestone: "Engaged Member: Attended event, building relationships, consistent content, impact tracked",
            tasks: [
              { id: 'first_event', text: 'Attend your first quarterly networking event', time: '2 hours', critical: true },
              { id: 'transformation_post', text: 'Post transformation update on LinkedIn (90 days)', time: '2 hours' },
              { id: 'submit_article_2', text: 'Submit second article (if first is published)', time: '3 hours' },
              { id: 'update_impact_log', text: 'Update your impact log', time: '30 mins' }
            ],
            metrics: {
              IMPACT: 25,
              EVENTS: 1,
              POSTS: 3
            }
          },
          {
            month: 4,
            title: "LEAD",
            milestone: "Leadership Activated: Volunteered for opportunity, all courses complete, growing visibility",
            tasks: [
              { id: 'volunteer', text: 'Volunteer for a leadership opportunity', time: '2 hours', critical: true },
              { id: 'complete_courses', text: 'AI Stacking 101', time: '4 hours', critical: true },
              { id: 'request_recommendation', text: 'Request letter of recommendation (if needed)', time: '1 hour' },
              { id: 'post_4x', text: 'Post 4x on LinkedIn this month', time: '2 hours' }
            ],
            metrics: {
              COURSES: 4,
              POSTS: 4,
              LEADERSHIP: 1
            }
          },
          {
            month: 5,
            title: "AMPLIFY",
            milestone: "Amplified Impact: Led something, article progress, consistent support",
            tasks: [
              { id: 'lead_something', text: "Lead or co-lead (book club, session, event). If you haven't completed the form yet, please do so here", time: '3 hours', critical: true },
              { id: 'check_article', text: 'Check article status and take action', time: '30 mins', critical: true },
              { id: 'daily_engage', text: 'Engage with Ambassadors content daily (5 min/day)', time: '2 hours' },
              { id: 'update_impact_5', text: 'Update impact log', time: '45 mins' }
            ],
            metrics: {
              IMPACT: 45,
              LEADERSHIP: 2,
              ENGAGEMENT: 150
            }
          },
          {
            month: 6,
            title: "MIDPOINT",
            milestone: "Halfway Strong: Story shared, podcast scheduled, 50+ people impacted, momentum building",
            tasks: [
              { id: 'quarterly_event_2', text: 'Attend your second quarterly networking event', time: '2 hours', critical: true },
              { id: 'schedule_podcast', text: 'Schedule your podcast episode', time: '30 mins', critical: true },
              { id: 'halfway_story', text: 'Post your halfway transformation story', time: '2 hours' }
            ],
            metrics: {
              IMPACT: 50,
              EVENTS: 2,
              PODCAST: 1
            }
          },
          {
            month: 7,
            title: "VISIBILITY",
            milestone: "Visible Leader: Podcast prep underway, leading regularly, strong content cadence",
            tasks: [
              { id: 'submit_article_next', text: "Submit next article (if you haven't already)", time: '3 hours' },
              { id: 'lead_second', text: 'Host or lead an opportunity (if you haven\'t completed the form already)', time: '3 hours' },
              { id: 'post_4x_m7', text: 'Post consistently: 4x this month', time: '2 hours' }
            ],
            metrics: {
              POSTS: 4,
              LEADERSHIP: 3,
              ARTICLES: 2
            }
          },
          {
            month: 8,
            title: "EXPAND",
            milestone: "Expanded Reach: Podcast recorded/scheduled, applied for external opportunities, portfolio growing",
            tasks: [
              { id: 'check_partners', text: 'Check T4L Partners portal weekly', time: '1 hour' },
              { id: 'update_speaker', text: 'Update Speaker Materials', time: '2 hours', critical: true },
              { id: 'speaking_pitch', text: 'Submit speaking pitch (outside T4L)', time: '3 hours' },
              { id: 'update_impact_8', text: 'Update impact log', time: '45 mins' }
            ],
            metrics: {
              IMPACT: 70,
              OPPORTUNITIES: 2
            }
          },
          {
            month: 9,
            title: "CONNECT",
            milestone: "Connected Leader: Deep relationships built, podcast live, third leadership opportunity completed",
            tasks: [
              { id: 'quarterly_event_3', text: 'Attend your Third quarterly networking event', time: '2 hours', critical: true },
              { id: 'follow_up_5', text: 'Follow up with 5 people from event', time: '1.5 hours', critical: true },
            ],
            metrics: {
              EVENTS: 3,
              LEADERSHIP: 4,
              CONNECTIONS: 50
            }
          },
          {
            month: 10,
            title: "ACCELERATE",
            milestone: "Accelerating: Final articles submitted, 85+ impacted, speaking opportunities in pipeline",
            tasks: [
              { id: 'submit_final', text: 'Submit final articles', time: '3 hours', critical: true },
              { id: 'update_impact_10', text: 'Update impact log', time: '45 mins', critical: true },
              { id: 'apply_speaking', text: 'Apply for 2+ speaking opportunities', time: '3 hours' }
            ],
            metrics: {
              IMPACT: 85,
              ARTICLES: 4,
              OPPORTUNITIES: 4
            }
          },
          {
            month: 11,
            title: "CELEBRATE",
            milestone: "Celebrating: Year documented, story shared, impact quantified",
            tasks: [
              { id: 'quarterly_event_4', text: 'Attend your Final quarterly networking event', time: '2 hours', critical: true },
              { id: 'final_impact', text: 'Complete final impact log', time: '2 hours', critical: true },
              { id: 'transformation_story', text: 'Post full year transformation story', time: '3 hours' }
            ],
            metrics: {
              IMPACT: 100,
              EVENTS: 4
            }
          },
          {
            month: 12,
            title: "RENEW",
            milestone: "Transformation Complete: Full year tracked, portfolio built, thought leadership established, decision made",
            tasks: [
              { id: 'decide_renewal', text: 'Decide on renewal (Top Voices, free tier, or alumni)', time: '1 hour' },
              { id: 'schedule_call', text: 'Schedule renewal call with T4L', time: '30 mins' }
            ],
            metrics: {
              IMPACT: 100,
              ARTICLES: 4,
              LEADERSHIP: 4,
              COURSES: 4
            }
          }
        ]
      });
      const [certificateMap, setCertificateMap] = useState({});
      const [isUploadingCert, setIsUploadingCert] = useState(false);
      const [isUploadInProgress, setIsUploadInProgress] = useState(false);
      const [pendingCertTaskId, setPendingCertTaskId] = useState(null);
      const [uploadingCourseType, setUploadingCourseType] = useState(null);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);
      const [toast, setToast] = useState(null);
      const [user, setUser] = useState({ name: "John Doe" });

      const showToast = useCallback((message, type = 'info') => {
        setToast({ message, type, id: Date.now() });
      }, []);

      const closeToast = useCallback(() => {
        setToast(null);
      }, []);

      // localStorage helper functions
      const getStorageKey = useCallback((userId = 'default') => {
        return `journey_tasks_${userId}`;
      }, []);

      const saveTasksToLocalStorage = useCallback((tasks, userId = 'default') => {
        try {
          const storageKey = getStorageKey(userId);
          localStorage.setItem(storageKey, JSON.stringify(tasks));
          console.log('Tasks saved to localStorage');
        } catch (err) {
          console.error('Failed to save tasks to localStorage:', err);
        }
      }, [getStorageKey]);

      const loadTasksFromLocalStorage = useCallback((userId = 'default') => {
        try {
          const storageKey = getStorageKey(userId);
          const savedTasks = localStorage.getItem(storageKey);
          if (savedTasks) {
            console.log('Tasks loaded from localStorage');
            return JSON.parse(savedTasks);
          }
        } catch (err) {
          console.error('Failed to load tasks from localStorage:', err);
        }
        return {};
      }, [getStorageKey]);

      const saveCurrentMonthToLocalStorage = useCallback((month, userId = 'default') => {
        try {
          const storageKey = `journey_current_month_${userId}`;
          localStorage.setItem(storageKey, month.toString());
          console.log('Current month saved to localStorage:', month);
        } catch (err) {
          console.error('Failed to save current month to localStorage:', err);
        }
      }, []);

      const loadCurrentMonthFromLocalStorage = useCallback((userId = 'default') => {
        try {
          const storageKey = `journey_current_month_${userId}`;
          const savedMonth = localStorage.getItem(storageKey);
          if (savedMonth) {
            console.log('Current month loaded from localStorage:', savedMonth);
            return parseInt(savedMonth);
          }
        } catch (err) {
          console.error('Failed to load current month from localStorage:', err);
        }
        return null;
      }, []);

      // Load journey progress and tasks from database (migrated from localStorage)
      useEffect(() => {
        const loadJourneyData = async () => {
          try {
            setLoading(true);
            setError(null);
            console.log('📥 Loading journey data from database...');

            const response = await fetch('/api/journey/progress', {
              credentials: 'include'
            });

            if (!response.ok) {
              throw new Error('Failed to load journey data');
            }

            const data = await response.json();
            console.log('✅ Journey data loaded:', data);

            // Update current month
            if (data.currentMonth) {
              setJourneyData(prev => ({
                ...prev,
                currentMonth: data.currentMonth
              }));
            }

            // Convert task completions to completedTasks state format
            // Format: { "1-linkedin_course": true, "2-submit_article_1": true, ... }
            if (data.taskCompletions && data.taskCompletions.length > 0) {
              setJourneyData(prev => {
                const completedTasks = {};

                data.taskCompletions.forEach(completion => {
                  if (completion.status === 'completed' && completion.journey_tasks) {
                    const task = completion.journey_tasks;
                    // Find which month this task belongs to using the months from state
                    const monthData = prev.months.find(m => {
                      return m.tasks.some(t => t.id === task.task_identifier);
                    });
                    
                    if (monthData) {
                      const taskKey = `${monthData.month}-${task.task_identifier}`;
                      completedTasks[taskKey] = true;
                    }
                  }
                });

                if (Object.keys(completedTasks).length > 0) {
                  console.log('✅ Loaded completed tasks from database:', completedTasks);
                  return {
                    ...prev,
                    completedTasks
                  };
                }
                return prev;
              });
            }

            // Check for localStorage data and migrate if exists
            const localStorageTasks = loadTasksFromLocalStorage('default');
            const localStorageMonth = loadCurrentMonthFromLocalStorage('default');
            
            if (Object.keys(localStorageTasks).length > 0 || localStorageMonth) {
              console.log('📦 Found localStorage data, migrating to database...');
              
              try {
                // Migrate to database
                const migrateResponse = await fetch('/api/journey/tasks/bulk-update', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  credentials: 'include',
                  body: JSON.stringify({
                    tasks: localStorageTasks,
                    currentMonth: localStorageMonth || data.currentMonth || 1
                  })
                });

                if (migrateResponse.ok) {
                  const migrateData = await migrateResponse.json();
                  console.log('✅ Migration completed:', migrateData);
                  
                  // Remove from localStorage after successful migration
                  localStorage.removeItem(getStorageKey('default'));
                  localStorage.removeItem(`journey_current_month_default`);
                  console.log('✅ localStorage cleared after migration');

                  // Reload data from database to get migrated tasks
                  const reloadResponse = await fetch('/api/journey/progress', {
                    credentials: 'include'
                  });
                  
                  if (reloadResponse.ok) {
                    const reloadData = await reloadResponse.json();
                    
                    if (reloadData.currentMonth) {
                      setJourneyData(prev => ({
                        ...prev,
                        currentMonth: reloadData.currentMonth
                      }));
                    }

                    // Update completed tasks
                    if (reloadData.taskCompletions && reloadData.taskCompletions.length > 0) {
                      setJourneyData(prev => {
                        const completedTasks = {};
                        reloadData.taskCompletions.forEach(completion => {
                          if (completion.status === 'completed' && completion.journey_tasks) {
                            const task = completion.journey_tasks;
                            const monthData = prev.months.find(m => {
                              return m.tasks.some(t => t.id === task.task_identifier);
                            });
                            if (monthData) {
                              const taskKey = `${monthData.month}-${task.task_identifier}`;
                              completedTasks[taskKey] = true;
                            }
                          }
                        });
                        
                        if (Object.keys(completedTasks).length > 0) {
                          return {
                            ...prev,
                            completedTasks
                          };
                        }
                        return prev;
                      });
                    }
                  }
                } else {
                  console.warn('⚠️ Migration failed, keeping localStorage data');
                }
              } catch (migrateError) {
                console.error('❌ Error during migration:', migrateError);
                // Keep localStorage data if migration fails
              }
            }
          } catch (error) {
            console.error('❌ Error loading journey data:', error);
            setError(error.message || 'Failed to load journey progress');
            showToast('Failed to load journey progress', 'error');
            
            // Fallback to localStorage if API fails
            const savedTasks = loadTasksFromLocalStorage('default');
            const savedCurrentMonth = loadCurrentMonthFromLocalStorage('default');
            
            if (Object.keys(savedTasks).length > 0 || savedCurrentMonth) {
              setJourneyData(prev => ({
                ...prev,
                completedTasks: savedTasks,
                currentMonth: savedCurrentMonth ? savedCurrentMonth : prev.currentMonth
              }));
              console.log('⚠️ Fallback: Restored journey data from localStorage');
            }
          } finally {
            setLoading(false);
          }
        };

        loadJourneyData();

        // Load existing certificates for this ambassador
        const fetchCertificates = async () => {
          try {
            const resp = await fetch('/api/certificates', {
              method: 'GET',
              credentials: 'include',
            });
            if (!resp.ok) return;
            const data = await resp.json();
            if (data && Array.isArray(data.certificates)) {
              const map = {};
              data.certificates.forEach((cert) => {
                if (cert.course_type) {
                  map[cert.course_type] = cert;
                }
              });
              setCertificateMap(map);
            }
          } catch (e) {
            console.warn('Failed to load certificates', e);
          }
        };

        fetchCertificates();
        
        // Check and show daily reminder (with rate limiting)
        const checkAndShowDailyReminder = async () => {
          try {
            // Check if reminder was shown recently (within last 2 hours)
            const lastReminderTime = localStorage.getItem('dailyReminderLastShown');
            const now = Date.now();
            const twoHoursInMs = 2 * 60 * 60 * 1000; // 2 hours in milliseconds
            
            if (lastReminderTime && (now - parseInt(lastReminderTime)) < twoHoursInMs) {
              console.log('⏰ Daily reminder skipped - shown recently');
              return; // Skip showing reminder if it was shown within last 2 hours
            }
            
            const reminderResponse = await fetch('/api/journey/daily-reminder', {
              credentials: 'include'
            });
            if (reminderResponse.ok) {
              const reminderData = await reminderResponse.json();
              if (reminderData.hasReminder) {
                // Show the reminder popup
                showDailyReminder(reminderData.motivationalMessage, reminderData.taskName);
                // Store the time when reminder was shown
                localStorage.setItem('dailyReminderLastShown', now.toString());
              }
            }
          } catch (error) {
            console.warn('⚠️ Failed to check daily reminder:', error);
          }
        };
        
        // Show reminder after a short delay to let page load
        setTimeout(() => {
          checkAndShowDailyReminder();
        }, 1000);
      }, [loadTasksFromLocalStorage, loadCurrentMonthFromLocalStorage]);

      const handleToggleTask = useCallback(async (monthIndex, taskId) => {
        const taskKey = `${monthIndex}-${taskId}`;
        const currentTaskState = journeyData.completedTasks[taskKey];
        const newCompletedState = !currentTaskState;

        try {
          console.log('🔄 Toggling task:', { monthIndex, taskId, newState: newCompletedState });

          // Optimistic update (update UI immediately)
          setJourneyData(prev => ({
            ...prev,
            completedTasks: {
              ...prev.completedTasks,
              [taskKey]: newCompletedState ? true : undefined
            }
          }));

          // Save to database
          const response = await fetch('/api/journey/tasks/toggle', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({
              taskIdentifier: taskId,
              monthNumber: monthIndex,
              completed: newCompletedState
            })
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to save task status');
          }

          const data = await response.json();
          console.log('✅ Task saved to database:', data);

          // Update state with actual data from server
          if (newCompletedState) {
            setJourneyData(prev => ({
              ...prev,
              completedTasks: {
                ...prev.completedTasks,
                [taskKey]: true
              }
            }));
          } else {
            const newCompletedTasks = { ...journeyData.completedTasks };
            delete newCompletedTasks[taskKey];
            setJourneyData(prev => ({
              ...prev,
              completedTasks: newCompletedTasks
            }));
          }

          showToast(newCompletedState ? 'Task completed! ✅' : 'Task unchecked', 'success');

          // Check if Month 12 is now fully completed
          if (monthIndex === 12) {
            const month12Tasks = journeyData.months[11].tasks;
            const updatedCompletedTasks = newCompletedState 
              ? { ...journeyData.completedTasks, [taskKey]: true }
              : { ...journeyData.completedTasks };
            if (!newCompletedState) {
              delete updatedCompletedTasks[taskKey];
            }
            
            const allMonth12TasksCompleted = month12Tasks.every(task =>
              updatedCompletedTasks[`12-${task.id}`]
            );

            if (allMonth12TasksCompleted) {
              // Send completion notifications to user and admins
              fetch('/api/journey/complete', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                credentials: 'include'
              }).then(response => {
                if (response.ok) {
                  console.log('✅ Journey completion notifications sent');
                } else {
                  console.error('⚠️ Failed to send completion notifications');
                }
              }).catch(error => {
                console.error('⚠️ Error sending completion notifications:', error);
              });
              
              setTimeout(() => {
                openCompletionCelebration();
              }, 1500);
            }
          }
        } catch (error) {
          console.error('❌ Error toggling task:', error);
          
          // Rollback optimistic update on error
          setJourneyData(prev => ({
            ...prev,
            completedTasks: {
              ...prev.completedTasks,
              [taskKey]: currentTaskState ? true : undefined
            }
          }));

          showToast('Failed to save task status. Please try again.', 'error');
        }
      }, [journeyData.completedTasks, journeyData.months, showToast]);

      const handleNextMonth = useCallback(async () => {
        const { currentMonth, completedTasks, months } = journeyData;

        // Prevent going past Month 12 and enforce Month 12 completion rules
        if (currentMonth === 12) {
          const month12Tasks = months[11].tasks; // Month 12 is index 11
          const allMonth12TasksCompleted = month12Tasks.every(task =>
            completedTasks[`12-${task.id}`]
          );

          if (!allMonth12TasksCompleted) {
            showToast('Please complete all Month 12 tasks to finish your journey.', 'error');
            return;
          }

          // Send completion notifications to user and admins
          fetch('/api/journey/complete', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            credentials: 'include'
          }).then(response => {
            if (response.ok) {
              console.log('✅ Journey completion notifications sent');
            } else {
              console.error('⚠️ Failed to send completion notifications');
            }
          }).catch(error => {
            console.error('⚠️ Error sending completion notifications:', error);
          });
          
          // Show completion celebration
          setTimeout(() => {
            openCompletionCelebration();
          }, 1000);

          // Stay on Month 12 (no Month 13)
          return;
        }

        // Enforce rule: must complete all critical tasks for the current month
        const currentMonthDef = months[currentMonth - 1];
        const allCriticalDone = currentMonthDef.tasks
          .filter(task => task.critical)
          .every(task => completedTasks[`${currentMonth}-${task.id}`]);

        if (!allCriticalDone) {
          showToast('Please complete all critical tasks before moving to the next month.', 'error');
          return;
        }

        if (!confirm('Move to the next month? This action cannot be undone.')) return;

        try {
          const newMonth = journeyData.currentMonth + 1;
          
          // Optimistic update
          setJourneyData(prev => ({
            ...prev,
            currentMonth: newMonth
          }));

          // Save to database
          const response = await fetch('/api/journey/progress/month', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ monthNumber: newMonth })
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || 'Failed to save month progress');
          }

          const data = await response.json();
          console.log('✅ Month progress saved to database:', data);

          showToast(`Advanced to Month ${newMonth}! 🎉`, 'success');
        } catch (error) {
          console.error('❌ Error saving month progress:', error);
          
          // Rollback on error
          setJourneyData(prev => ({
            ...prev,
            currentMonth: journeyData.currentMonth
          }));
          
          showToast('Failed to advance month. Please try again.', 'error');
        }
      }, [journeyData.currentMonth, journeyData.completedTasks, journeyData.months, showToast]);

      const handleRequestCertificateUpload = useCallback((taskId) => {
        const taskToCourseType = {
          linkedin_course: 'linkedin_course',
          second_course: 'transformational_course',
          third_course: 'science_of_you',
          complete_courses: 'ai_stacking',
        };
        const courseType = taskToCourseType[taskId];
        if (!courseType) return;
        setPendingCertTaskId(taskId);
        setUploadingCourseType(courseType);
        setIsUploadingCert(true);
      }, []);

      // ✅ Retry helper function for frontend
      const retryFetch = async (url, options, maxRetries = 3, delay = 1000) => {
        let lastError;
        for (let attempt = 1; attempt <= maxRetries; attempt++) {
          try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 60000); // 60 second timeout
            
            const response = await fetch(url, {
              ...options,
              signal: controller.signal,
            });
            
            clearTimeout(timeoutId);
            return response;
          } catch (error) {
            lastError = error;
            if (error.name === 'AbortError') {
              throw new Error('Upload timed out. Please check your connection and try again.');
            }
            if (attempt < maxRetries) {
              const waitTime = delay * Math.pow(2, attempt - 1);
              console.log(`⚠️ Upload attempt ${attempt}/${maxRetries} failed, retrying in ${waitTime}ms...`);
              await new Promise(resolve => setTimeout(resolve, waitTime));
            }
          }
        }
        throw lastError;
      };

      const handleCertificateUploadSubmit = useCallback(async (event) => {
        event.preventDefault();
        const fileInput = event.target.elements.certificateFile;
        
        if (!fileInput || !fileInput.files || !fileInput.files[0]) {
          showToast('Please select a certificate file to upload.', 'error');
          return;
        }
        
        const maxFileSize = 10 * 1024 * 1024;
        const selectedFile = fileInput.files[0];
        if (selectedFile.size > maxFileSize) {
          showToast('File size exceeds the maximum limit of 10 MB.', 'error');
          return;
        }
        
        if (!uploadingCourseType) {
          showToast('Unknown course type for certificate.', 'error');
          return;
        }

        try {
          setIsUploadInProgress(true);
          showToast('Uploading certificate...', 'info');

          const formData = new FormData();
          formData.append('certificate', selectedFile);
          formData.append('courseType', uploadingCourseType);

          console.log('📤 Uploading certificate:', {
            courseType: uploadingCourseType,
            filename: selectedFile.name,
            size: selectedFile.size
          });

          const resp = await fetch('/api/certificates/upload', {
            method: 'POST',
            body: formData,
            credentials: 'include',
          });

          console.log('📥 Response status:', resp.status, resp.statusText);

          // Check if response is JSON
          const contentType = resp.headers.get('content-type');
          if (!contentType || !contentType.includes('application/json')) {
            const textResponse = await resp.text();
            console.error('❌ Non-JSON response received:', textResponse.substring(0, 500));
            throw new Error('Server returned HTML instead of JSON. Check server logs.');
          }

          const data = await resp.json();
          console.log('📥 Response data:', data);

          if (!resp.ok || !data.success) {
            throw new Error(data.error || data.details || 'Upload failed');
          }

          // Update certificate map
          setCertificateMap((prev) => ({
            ...prev,
            [uploadingCourseType]: {
              course_type: uploadingCourseType,
              filename: data.certificate.filename,
              upload_date: data.certificate.uploadDate,
              verified: data.certificate.verified,
            },
          }));

          showToast(
            'Certificate uploaded successfully! You can now mark this course as completed.',
            'success'
          );

          // Reset form
          fileInput.value = '';

          // Auto-toggle task after upload
          if (pendingCertTaskId) {
            const courseTaskToMonth = {
              linkedin_course: 1,
              second_course: 1,
              third_course: 2,
              complete_courses: 4,
            };
            const monthIndex = courseTaskToMonth[pendingCertTaskId] || journeyData.currentMonth;

            await new Promise((resolve) => setTimeout(resolve, 500));

            try {
              await handleToggleTask(monthIndex, pendingCertTaskId);
              console.log("✅ Task auto-toggled successfully");
            } catch (toggleError) {
              console.warn("⚠️ Auto-toggle failed:", toggleError.message);
              showToast(
                'Certificate uploaded! Please check the task box to mark it complete.',
                'info'
              );
            }
          }

          setPendingCertTaskId(null);
          setUploadingCourseType(null);
          setIsUploadingCert(false);
          
        } catch (err) {
          console.error('❌ Certificate upload failed:', err);
          showToast(err.message || 'Failed to upload certificate', 'error');
        } finally {
          setIsUploadInProgress(false);
        }
      }, [uploadingCourseType, pendingCertTaskId, handleToggleTask, journeyData.currentMonth, showToast]);

      // Add event listener for celebration popup
      useEffect(() => {
        const celebrationPopup = document.getElementById('completionCelebration');
        
        // Close celebration popup when clicking outside
        if (celebrationPopup) {
          celebrationPopup.addEventListener('click', (e) => {
            if (e.target === celebrationPopup) {
              closeCompletionCelebration();
            }
          });
        }
        
        // Ensure scroll is enabled on mount
        ensureScrollEnabled();
      }, []);

      if (loading) {
        return (
          <div className="flex min-h-screen">
            <Sidebar />
            <div className="flex-1 p-8">
              <div className="space-y-4">
                <div className="skeleton h-32 rounded-2xl"></div>
                <div className="skeleton h-32 rounded-2xl"></div>
                <div className="skeleton h-32 rounded-2xl"></div>
              </div>
            </div>
          </div>
        );
      }

      if (loading) {
        return (
          <div className="flex min-h-screen">
            <Sidebar />
            <div className="flex-1 p-8 flex items-center justify-center">
              <div className="flex flex-col items-center gap-3">
                <div className="w-10 h-10 border-4 border-[#4b0d7f] border-t-transparent rounded-full animate-spin"></div>
                <p className="text-sm text-gray-600 font-medium">
                  Loading your journey progress...
                </p>
              </div>
            </div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="flex min-h-screen">
            <Sidebar />
            <div className="flex-1 p-8">
              <div className="bg-red-50 border-2 border-red-200 rounded-2xl p-6">
                <p className="text-red-800">Error: {error}</p>
              </div>
            </div>
          </div>
        );
      }

      if (!journeyData) return null;

      const { currentMonth, completedTasks, months } = journeyData;
      const currentMonthData = months.find(m => m.month === currentMonth);
      const overallProgress = months.reduce((acc, m) => {
        const completed = m.tasks.filter(task => completedTasks[`${m.month}-${task.id}`]).length;
        return acc + (completed / m.tasks.length);
      }, 0) / months.length * 100;

      return (
        <div className="flex min-h-screen">
          <Sidebar />
          <div className="flex-1 p-8">
            <div className="bg-white rounded-2xl shadow-md p-6 mb-6">
              <div className="flex items-center justify-between flex-wrap gap-4">
                <div>
                  <h1 className="text-3xl font-bold text-gray-800">
                    Track your transformation progress
                  </h1>
                </div>
                <div className="flex items-center gap-4">
                  <button id="notificationBell" className="relative p-2 hover:bg-gray-100 rounded-full transition-colors" title="Notifications">
                    <i className="bx bx-bell text-2xl text-gray-700"></i>
                  </button>
                  <div className="text-right">
                    <div className="text-sm text-gray-600">Overall Progress</div>
                    <div className="text-2xl font-bold text-[#4b0d7f]">{Math.round(overallProgress)}%</div>
                  </div>
                  <div className="w-16 h-16">
                    <svg className="progress-ring w-16 h-16">
                      <circle
                        className="progress-ring-circle"
                        stroke="#e5e7eb"
                        strokeWidth="8"
                        fill="transparent"
                        r="28"
                        cx="32"
                        cy="32"
                      />
                      <circle
                        className="progress-ring-circle"
                        stroke="#4b0d7f"
                        strokeWidth="8"
                        fill="transparent"
                        r="28"
                        cx="32"
                        cy="32"
                        strokeDasharray={`${2 * Math.PI * 28}`}
                        strokeDashoffset={`${2 * Math.PI * 28 * (1 - overallProgress / 100)}`}
                      />
                    </svg>
                  </div>
                </div>
              </div>
            </div>

            {currentMonthData && (
              <div className="bg-gradient-to-r from-[#4b0d7f] to-[#6b1fa1] rounded-2xl p-6 mb-6 text-white shadow-lg">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="text-sm font-medium opacity-90 mb-1">Current Focus</div>
                    <h2 className="text-2xl font-bold">
                      Month {currentMonth}: {currentMonthData.title}
                    </h2>
                    <p className="text-sm opacity-90 mt-2">{currentMonthData.milestone}</p>
                  </div>
                  <div className="text-4xl">
                    <i className="bx bx-trophy"></i>
                  </div>
                </div>
              </div>
            )}

            <div className="space-y-6">
              {months.map(month => (
                <MonthCard
                  key={month.month}
                  month={month}
                  currentMonth={currentMonth}
                  completedTasks={completedTasks}
                  onToggleTask={handleToggleTask}
                  onNextMonth={handleNextMonth}
                  certificateMap={certificateMap}
                  onRequestCertificateUpload={handleRequestCertificateUpload}
                />
              ))}
            </div>
          </div>

          {toast && (
            <Toast
              message={toast.message}
              type={toast.type}
              onClose={closeToast}
            />
          )}

          {isUploadingCert && (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
              <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                <h2 className="text-xl font-bold text-gray-900 mb-2">
                  Upload Course Certificate
                </h2>
                <p className="text-sm text-gray-600 mb-4">
                  Please upload a screenshot or PDF of your completion certificate
                  for this course before marking the task as done.
                </p>
                <form onSubmit={handleCertificateUploadSubmit} className="space-y-4">
                  <div>
                    <input
                      type="file"
                      name="certificateFile"
                      accept=".jpg,.jpeg,.png,.pdf"
                      disabled={isUploadInProgress}
                      className="block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[#4b0d7f] disabled:opacity-50 disabled:cursor-not-allowed"
                      required
                    />
                    <p className="text-xs text-gray-500 mt-2">
                      Maximum file size: <strong>10 MB</strong>. Accepted formats: JPG, JPEG, PNG, PDF
                    </p>
                  </div>
                  <div className="flex justify-end gap-3 pt-2">
                    <button
                      type="button"
                      className="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200"
                      onClick={() => {
                        setIsUploadingCert(false);
                        setPendingCertTaskId(null);
                        setUploadingCourseType(null);
                      }}
                    >
                      Cancel
                    </button>
                    <button
                      type="submit"
                      disabled={isUploadInProgress}
                      className="px-4 py-2 text-sm font-semibold text-white bg-[#4b0d7f] rounded-lg hover:bg-[#3a0a63] disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                    >
                      {isUploadInProgress ? (
                        <>
                          <svg className="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                          </svg>
                          Uploading...
                        </>
                      ) : (
                        'Upload & Continue'
                      )}
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    }

    // Sidebar Component
    function Sidebar() {
      return (
        <aside className="sidebar w-20 lg:w-20 md:w-20 bg-white shadow-md flex flex-col items-center py-6 space-y-6 z-40">
          <div className="mb-4">
            <div className="bg-[#4b0d7f] text-white px-3 py-2 rounded-xl font-semibold text-sm">T4L</div>
          </div>
          <nav className="flex flex-col space-y-4 text-gray-700 w-full">
            <a href="/ambassador-dashboard.html" className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-[#f5f0ff]">
              <i className="bx bxs-home text-2xl text-[#4b0d7f] group-hover:scale-110 transition-transform duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d7f] transition-colors duration-200">Home</span>
            </a>
            <a href="/article-amb.html" className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-[#f5f0ff]">
              <i className="bx bx-edit-alt text-2xl group-hover:text-[#4b0d7f] group-hover:scale-110 transition-all duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d7f] transition-colors duration-200">Publishing</span>
            </a>
            {/* Task (current page) */}
            <a href="/journey.html" className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-[#f5f0ff] bg-[#f5f0ff]">
              <i className="bx bx-check-square text-2xl text-[#4b0d7f] group-hover:scale-110 transition-all duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-[#4b0d7f] transition-colors duration-200">Task</span>
            </a>
            {/* Impact Log (separate page) */}
            <a href="/impactlog-ambassador.html" className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-[#f5f0ff]">
              <i className="bx bx-line-chart text-2xl text-[#4b0d7f] group-hover:scale-110 transition-all duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d7f] transition-colors duration-200">Impact Log</span>
            </a>
            <a href="/Partner-Calls.html" className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-[#f5f0ff]">
              <i className="bx bx-briefcase text-2xl group-hover:text-[#4b0d7f] group-hover:scale-110 transition-all duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d7f] transition-colors duration-200">Partners</span>
            </a>
            <a href="https://www.t4leader.com/ambassador-events" className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-[#f5f0ff]">
              <i className="bx bx-calendar-event text-2xl group-hover:text-[#4b0d7f] group-hover:scale-110 transition-all duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d7f] transition-colors duration-200">Events</span>
            </a>
            <a href="/profile.html" className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-[#f5f0ff]">
              <i className="bx bx-user text-2xl group-hover:text-[#4b0d7f] group-hover:scale-110 transition-all duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d7f] transition-colors duration-200">Profile</span>
            </a>
            <div className="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-red-50">
              <i className="bx bx-log-out text-2xl group-hover:text-red-600 group-hover:scale-110 transition-all duration-200"></i>
              <span className="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-red-600 transition-colors duration-200">Logout</span>
            </div>
          </nav>
        </aside>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
    
    // Ensure scroll is enabled on page load and after any delay
    window.addEventListener('load', () => {
      ensureScrollEnabled();
      // Also check periodically to ensure scroll stays enabled when no popups are open
      setInterval(ensureScrollEnabled, 1000);
    });
    
    // Ensure scroll is enabled immediately
    ensureScrollEnabled();
  </script>
  
  <!-- ✅ Subscription Manager -->
  <script src="/js/subscription-manager.js"></script>
  <!-- Frontend auth guard: redirect if no valid session -->
  <script src="/signin.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      requireAuth('/signin');
    });
  </script>
</body>
</html>