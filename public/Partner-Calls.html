<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>T4L Ambassador Dashboard</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  <style>
    /* Keep all your existing styles */
    * { box-sizing: border-box; }
    html, body { overflow-x: hidden; max-width: 100vw; }
    .sidebar-toggle { display: none; }
    
    @media (max-width: 768px) {
      .sidebar-toggle {
        display: flex;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 50;
        background: #4b0d7f;
        color: white;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        position: fixed;
        height: 100vh;
        z-index: 40;
      }
      .sidebar.active { transform: translateX(0); }
      .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 30;
      }
      .overlay.active { display: block; }
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(4px);
      z-index: 100;
      overflow-y: auto;
      padding: 1rem;
    }
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      border-radius: 1.5rem;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      animation: modalSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    @keyframes fadeOut {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-10px);
      }
    }
    .modal-content::-webkit-scrollbar { width: 10px; }
    .modal-content::-webkit-scrollbar-track {
      background: #f8f9fa;
      border-radius: 10px;
    }
    .modal-content::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #4b0d7f, #6b1fa1);
      border-radius: 10px;
      border: 2px solid #f8f9fa;
    }
    .modal-content::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #3a0a65, #5a1881);
    }

    .input-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #6b7280;
      font-size: 1.25rem;
    }
    .input-with-icon { padding-left: 3.5rem; }
    .required-indicator {
      color: #dc2626;
      margin-left: 0.25rem;
    }
    .form-label {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      font-size: 0.875rem;
      letter-spacing: 0.025em;
    }

    /* Notification styles */
    .notification-item {
      padding: 16px 20px;
      border-bottom: 1px solid #f1f1f1;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }
    .notification-item:hover {
      background-color: #f8f9fa;
      transform: translateX(2px);
    }
    .notification-item.unread {
      background-color: #f0f7ff;
      border-left: 3px solid #4b0d7f;
    }
    .notification-item.read {
      opacity: 0.8;
      border-left: 3px solid transparent;
    }
    .notification-item:last-child { border-bottom: none; }
    .notification-dot {
      width: 8px;
      height: 8px;
      background: #4b0d7f;
      border-radius: 50%;
      flex-shrink: 0;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    #notificationDropdown {
      position: absolute;
      right: 0;
      top: 100%;
      margin-top: 8px;
      width: 380px;
      max-width: 90vw;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      overflow: hidden;
      display: none;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      border: 1px solid #e5e7eb;
    }
    #notificationDropdown.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .notification-header {
      background: linear-gradient(135deg, #4b0d7f, #6b1fa1);
      color: white;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    .notification-list {
      max-height: 400px;
      overflow-y: auto;
    }
    .notification-list::-webkit-scrollbar { width: 6px; }
    .notification-list::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    .notification-list::-webkit-scrollbar-thumb {
      background: #c5c5c5;
      border-radius: 10px;
    }
    .notification-list::-webkit-scrollbar-thumb:hover {
      background: #a5a5a5;
    }

    @keyframes pulse-notification {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    .notification-badge {
      animation: pulse-notification 2s infinite;
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    .animate-slideIn {
      animation: slideIn 0.3s ease-out;
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    #opportunitiesContainer {
      width: 100%;
      max-width: 100%;
      overflow-x: hidden;
    }
    #opportunitiesContainer article {
      width: 100%;
      max-width: 100%;
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
    }
    #opportunitiesContainer h3,
    #opportunitiesContainer h4,
    #opportunitiesContainer p,
    #opportunitiesContainer span {
      overflow-wrap: break-word;
      word-wrap: break-word;
      word-break: break-word;
      max-width: 100%;
    }
    #opportunitiesContainer .flex {
      flex-wrap: wrap;
      max-width: 100%;
    }
  </style>
</head>

<body class="bg-gray-50 font-sans">
  <!-- Global Notification Script -->
  <script src="/js/notifications.js"></script>
  <!-- Global Ambassador Sidebar -->
  <script src="/js/ambassador-sidebar.js"></script>
  <!-- Mobile Sidebar Toggle -->
  <button class="sidebar-toggle" id="sidebarToggle">
    <i class="bx bx-menu text-xl"></i>
  </button>

  <!-- Overlay for mobile sidebar -->
  <div class="overlay" id="overlay"></div>

  <div class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="sidebar w-20 lg:w-20 md:w-20 bg-white shadow-md flex flex-col items-center py-6 space-y-6 z-40">
      <div class="mb-4">
        <div class="bg-[#4b0d7f] text-white px-3 py-2 rounded-xl font-semibold text-sm">T4L</div>
      </div>

      <nav class="flex flex-col space-y-4 text-gray-700 w-full">
        <a id="homeLink" href="/ambassador-dashboard.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bxs-home text-2xl text-[#4b0d9f] group-hover:scale-110 transition-transform duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Home</span>
        </a>

        <a href="/article-amb.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-edit-alt text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Publishing</span>
        </a>

        <a href="/journey.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-line-chart text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Impact Log</span>
        </a>
        <a href="/services.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-briefcase-alt-2 text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Services</span>
        </a>

        <a href="/Partner-Calls.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50 bg-purple-50">
          <i class="bx bx-briefcase text-2xl text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-[#4b0d9f] transition-colors duration-200">Partners</span>
        </a>

        <a href="https://www.t4leader.com/event" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-calendar-event text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Events</span>
        </a>

        <a href="/chat-pillar.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-chat text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Chat</span>
        </a>

        <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-user text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Profile</span>
        </a>

        <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-cog text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Settings</span>
        </a>

        <div id="logoutBtn" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-red-50">
          <i class="bx bx-log-out text-2xl group-hover:text-red-600 group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-red-600 transition-colors duration-200">Logout</span>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-4 md:p-6 lg:p-6 min-w-0">
      <!-- Notification Bell -->
      <div class="absolute top-4 right-4 z-50">
        <div class="relative">
          <button id="notificationBell" class="bg-white p-3 rounded-full shadow-lg hover:shadow-xl transition-all">
            <i class="bx bx-bell text-2xl text-gray-700"></i>
            <span id="notificationBadge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center notification-badge font-bold">0</span>
          </button>
          
          <!-- Notification Dropdown -->
          <div id="notificationDropdown" class="hidden">
            <div class="notification-header">
              <h3 class="font-bold text-lg">Notifications</h3>
              <button id="markAllRead" class="text-sm hover:underline opacity-90 hover:opacity-100">Mark all read</button>
            </div>
            <div id="notificationList" class="notification-list">
              <!-- Notifications loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Top Navbar -->
      <header class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
        <h1 class="text-xl font-semibold text-gray-900">T4L Ambassador</h1>
        <div class="flex items-center space-x-4 w-full md:w-auto">
          <div class="relative flex-1 md:flex-none">
            <input type="text" placeholder="Search articles, events, partners..." class="border border-gray-400 rounded-full pl-10 pr-4 py-2 text-sm w-full md:w-80 focus:outline-none focus:ring-2 focus:ring-purple-500" />
            <i class="bx bx-search absolute left-3 top-2.5 text-gray-900"></i>
          </div>
          <div class="flex items-center space-x-2">
            <div id="userAvatar" class="w-10 h-10 bg-[#4b0d7f] flex items-center justify-center rounded-full font-bold text-white">AM</div>
          </div>
        </div>
      </header>

      <!-- Hero Section -->
      <section class="bg-gradient-to-r from-[#4b0d7f] to-[#a36737] text-white p-4 md:p-6 rounded-2xl mb-6 shadow-md">
        <h2 id="heroWelcome" class="text-xl md:text-2xl font-semibold mb-2">Welcome back, Ambassador!</h2>
        <p class="text-sm mb-6">
          You're in Month 3 <span class="font-semibold">Visibility Stage</span><br />
          There's an opportunity for you to be featured on our next podcast!
        </p>
      </section>

      <!-- LIFT Pillar Section -->
      <section class="bg-white p-6 md:p-8 rounded-2xl mb-6 shadow-md">
        <h2 class="text-xl font-bold mb-5">LIFT Pillar</h2>

        <div class="relative mb-6">
          <select class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 text-base appearance-none cursor-pointer focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white">
            <option>Leading Self</option>
            <option>Inspiring Others</option>
            <option>Fostering Teams</option>
            <option>Transforming Orgs</option>
          </select>
          <svg class="absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-700 pointer-events-none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </div>

        <h3 class="text-lg font-bold mb-4">Visibility Opportunities</h3>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
          <button onclick="setActive(this)" class="opportunity-btn active bg-[#4b0d7f] text-white px-5 py-4 rounded-xl shadow-md hover:shadow-lg transition-all font-semibold text-base">Speaking</button>
          <button onclick="setActive(this)" class="opportunity-btn bg-gray-300 text-black px-5 py-4 rounded-xl shadow-md hover:shadow-lg transition-all font-semibold text-base">Podcast</button>
          <button onclick="setActive(this)" class="opportunity-btn bg-gray-300 text-black px-5 py-4 rounded-xl shadow-md hover:shadow-lg transition-all font-semibold text-base">Webinar</button>
          <button onclick="setActive(this)" class="opportunity-btn bg-gray-300 text-black px-5 py-4 rounded-xl shadow-md hover:shadow-lg transition-all font-semibold text-base">Volunteering</button>
        </div>
      </section>

      <!-- Opportunity Cards Section - DYNAMIC CONTENT -->
      <section class="space-y-6 mb-6 w-full max-w-full" id="opportunitiesContainer">
        <!-- Dynamic posts will be loaded here -->
      </section>
    </main>
  </div>

  <!-- Application Modal - SIMPLIFIED CV UPLOAD ONLY -->
  <div class="modal" id="applicationModal">
    <div class="modal-content">
      <!-- Enhanced Header -->
      <div class="bg-gradient-to-br from-[#4b0d7f] via-[#6b1fa1] to-[#8b2fb1] text-white p-8 rounded-t-2xl relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-white/5 rounded-full -mr-32 -mt-32"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-white/5 rounded-full -ml-24 -mb-24"></div>
        
        <button onclick="closeModal()" class="absolute top-6 right-6 text-white/80 hover:text-white hover:bg-white/10 w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300">
          <i class="bx bx-x text-3xl"></i>
        </button>
        
        <div class="relative flex items-start gap-5">
          <div class="w-20 h-20 rounded-2xl bg-white/15 backdrop-blur-sm flex items-center justify-center flex-shrink-0 shadow-xl">
            <i class="bx bx-file text-white text-4xl"></i>
          </div>
          <div class="flex-1 min-w-0">
            <h2 class="text-3xl font-bold mb-2 leading-tight">Apply Now</h2>
            <p class="text-white/90 text-base mb-1 font-medium" id="modalOpportunityTitle">Partner Opportunity</p>
            <p class="text-white/70 text-sm">Upload your CV to apply</p>
          </div>
        </div>
      </div>

      <form id="applicationForm" class="p-8 md:p-10 space-y-8 bg-gradient-to-b from-gray-50 to-white">
        
        <!-- Section: CV Upload Only -->
        <div class="form-section">
          <h3 class="text-xl font-bold text-gray-900 mb-6 flex items-center gap-2">
            <i class="bx bx-file text-[#4b0d7f] text-2xl"></i>
            Upload Your CV
          </h3>
          
          <div class="space-y-5">
            <!-- CV Upload Area -->
            <div>
              <label class="form-label">
                Upload Your CV (PDF, DOC, DOCX)<span class="required-indicator">*</span>
              </label>
              
              <!-- Upload Box -->
              <div id="uploadArea" class="border-2 border-dashed border-gray-300 rounded-2xl p-8 text-center cursor-pointer hover:border-purple-400 hover:bg-purple-50 transition-all duration-300">
                <div class="flex flex-col items-center justify-center">
                  <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mb-4">
                    <i class="bx bx-cloud-upload text-3xl text-purple-600"></i>
                  </div>
                  <p class="font-semibold text-gray-900 mb-1">Click to upload CV</p>
                  <p class="text-sm text-gray-500 mb-4">or drag and drop</p>
                  <p class="text-xs text-gray-400">PDF, DOC, DOCX up to 10MB</p>
                </div>
                <input type="file" id="cvFile" accept=".pdf,.doc,.docx,.txt" class="hidden" required>
              </div>
              
              <!-- File Preview -->
              <div id="filePreview" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-xl">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                      <i class="bx bx-file text-green-600"></i>
                    </div>
                    <div>
                      <p id="fileName" class="font-medium text-gray-900 text-sm"></p>
                      <p id="fileSize" class="text-xs text-gray-500"></p>
                    </div>
                  </div>
                  <button type="button" onclick="removeFile()" class="text-red-500 hover:text-red-700">
                    <i class="bx bx-trash text-xl"></i>
                  </button>
                </div>
              </div>
              
              <!-- Upload Progress -->
              <div id="uploadProgress" class="hidden mt-4">
                <div class="flex items-center justify-between mb-1">
                  <span class="text-sm font-medium text-gray-700">Uploading...</span>
                  <span id="uploadPercent" class="text-sm font-medium text-gray-700">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div id="progressBar" class="bg-purple-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
              </div>
            </div>

            <!-- Auto-fill Notice -->
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mt-6">
              <div class="flex items-start gap-3">
                <i class="bx bx-info-circle text-blue-500 text-xl mt-0.5"></i>
                <div>
                  <p class="font-medium text-blue-800 text-sm">Your profile information will be automatically included</p>
                  <p class="text-blue-600 text-xs mt-1">
                    We'll use your ambassador profile details (name, email, LinkedIn, experience) along with your CV.
                    No need to fill out forms!
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Terms and Submit Section -->
        <div class="pt-4 space-y-6">
          <div class="bg-purple-50 border border-purple-100 rounded-xl p-5 space-y-3">
            <label class="flex items-start gap-3 cursor-pointer group">
              <input type="checkbox" id="termsCheckbox" required class="mt-0.5 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 flex-shrink-0">
              <span class="text-sm text-gray-700">
                I agree to the <a href="#" class="text-purple-700 hover:text-purple-900 font-semibold underline">terms and conditions</a> and understand that my profile and CV will be shared with the partner.<span class="required-indicator">*</span>
              </span>
            </label>
            <label class="flex items-center gap-3 cursor-pointer group">
              <input type="checkbox" id="newsletterCheckbox" class="mt-0.5 w-5 h-5 text-purple-600 border-gray-300 rounded focus:ring-purple-500 flex-shrink-0">
              <span class="text-sm text-gray-700">
                I would like to receive updates about similar opportunities and T4L program news.
              </span>
            </label>
          </div>

          <!-- Submit Buttons - Initially hidden -->
          <div id="submitSection" class="hidden flex flex-col sm:flex-row gap-4 pt-2">
            <button type="button" onclick="closeModal()" class="flex-1 px-6 py-4 border-2 border-gray-300 text-gray-700 rounded-xl font-bold hover:bg-gray-50 hover:border-gray-400 transition-all duration-300 flex items-center justify-center gap-2">
              <i class="bx bx-x text-xl"></i>
              Cancel
            </button>
            <button type="submit" id="submitButton" class="flex-1 px-6 py-4 bg-gradient-to-r from-[#4b0d7f] to-[#6b1fa1] text-white rounded-xl font-bold hover:from-[#3a0a65] hover:to-[#5a1881] shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center gap-2">
              <i class="bx bx-send text-xl"></i>
              Submit Application
            </button>
          </div>
          
          <!-- Upload First Notice -->
          <div id="uploadFirstNotice" class="text-center py-4">
            <p class="text-gray-500 text-sm">
              <i class="bx bx-info-circle text-gray-400 mr-1"></i>
              Please upload your CV first to enable the submit button
            </p>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Global variables
    let selectedFile = null;
    let currentPostTitle = "";
    const modal = document.getElementById("applicationModal");

    // ============================================
    // NOTIFICATION SYSTEM
    // ============================================
    function setupNotificationBell() {
      const bell = document.getElementById('notificationBell');
      const dropdown = document.getElementById('notificationDropdown');
      
      if (!bell || !dropdown) {
        console.error('‚ùå Notification bell or dropdown not found!');
        return;
      }
      
      console.log('üîî Setting up notification bell...');
      
      bell.addEventListener('click', function(e) {
        e.stopPropagation();
        console.log('üîî Bell clicked, toggling dropdown');
        dropdown.classList.toggle('active');
        
        if (dropdown.classList.contains('active')) {
          console.log('üì• Opening dropdown, loading notifications...');
          loadNotifications();
        }
      });
      
      const markAllBtn = document.getElementById('markAllRead');
      if (markAllBtn) {
        markAllBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          markAllNotificationsRead();
        });
      }
      
      document.addEventListener('click', function(e) {
        if (!bell.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.classList.remove('active');
        }
      });
      
      dropdown.addEventListener('click', function(e) {
        e.stopPropagation();
      });
    }

    async function loadNotifications() {
      try {
        console.log('üîî Loading notifications...');
        
        const response = await fetch('/api/notifications?limit=10');
        
        if (!response.ok) {
          console.error('‚ùå Failed to load notifications:', response.status, response.statusText);
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('üì¨ Notifications data:', data);
        
        const notifications = data.notifications || [];
        const unreadCount = data.unreadCount || 0;
        
        console.log(`üìä Found ${notifications.length} notifications, ${unreadCount} unread`);
        
        const badge = document.getElementById('notificationBadge');
        if (unreadCount > 0) {
          badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
        
        displayNotifications(notifications);
      } catch (error) {
        console.error('‚ùå Error loading notifications:', error);
        const list = document.getElementById('notificationList');
        if (list) {
          list.innerHTML = `
            <div class="p-6 text-center">
              <i class="bx bx-error text-3xl text-red-400 mb-2"></i>
              <p class="text-red-500 text-sm">Failed to load notifications</p>
              <button onclick="loadNotifications()" class="mt-2 text-purple-600 hover:text-purple-800 text-sm font-medium">Retry</button>
            </div>
          `;
        }
      }
    }

    function displayNotifications(notifications) {
      const list = document.getElementById('notificationList');
      
      if (!list) {
        console.error('‚ùå Notification list element not found!');
        return;
      }
      
      if (notifications.length === 0) {
        list.innerHTML = `
          <div class="p-8 text-center text-gray-500">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3">
              <i class="bx bx-bell-off text-3xl text-gray-400"></i>
            </div>
            <h4 class="font-medium text-gray-600 mb-1">No notifications</h4>
            <p class="text-sm text-gray-400">You're all caught up!</p>
          </div>
        `;
        return;
      }
      
      list.innerHTML = notifications.map(notif => {
        const message = escapeHtml(notif.message || '');
        
        return `
          <div class="notification-item ${notif.read ? 'read' : 'unread'}" 
               onclick="markNotificationRead('${notif.notification_id}', '${escapeHtml(notif.link || '')}')">
            <div class="flex items-start gap-3">
              <div class="flex-1 min-w-0">
                <div class="flex items-start justify-between mb-1">
                  <h4 class="font-semibold text-gray-900 text-sm truncate">${escapeHtml(notif.title || 'Notification')}</h4>
                  ${!notif.read ? '<div class="notification-dot ml-2"></div>' : ''}
                </div>
                <p class="text-xs text-gray-600 mb-2 line-clamp-2">${message}</p>
                <p class="text-xs text-gray-400">${timeAgo(notif.created_at)}</p>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function markNotificationRead(notificationId, link = '') {
      try {
        const response = await fetch(`/api/notifications/${notificationId}/read`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error('Failed to mark notification as read');
        }
        
        await loadNotifications();
        
        if (link && link.trim() !== '') {
          setTimeout(() => {
            window.location.href = link;
          }, 300);
        }
      } catch (error) {
        console.error('‚ùå Error marking notification as read:', error);
      }
    }

    async function markAllNotificationsRead() {
      try {
        const response = await fetch('/api/notifications/mark-all-read', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (!response.ok) {
          throw new Error('Failed to mark all notifications as read');
        }
        
        await loadNotifications();
        showToast('All notifications marked as read', 'success');
      } catch (error) {
        console.error('‚ùå Error marking all as read:', error);
        showToast('Failed to mark all as read', 'error');
      }
    }

    function timeAgo(timestamp) {
      if (!timestamp) return 'Just now';
      
      try {
        const now = Date.now();
        const then = new Date(timestamp).getTime();
        const diff = now - then;
        
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;
        if (hours < 24) return `${hours}h ago`;
        return `${days}d ago`;
      } catch (error) {
        return 'Just now';
      }
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `fixed top-4 right-4 px-4 py-3 rounded-lg shadow-lg z-[9999] animate-slideIn ${
        type === 'success' ? 'bg-green-500 text-white' :
        type === 'error' ? 'bg-red-500 text-white' :
        'bg-blue-500 text-white'
      }`;
      toast.innerHTML = `
        <div class="flex items-center gap-2">
          <i class="bx ${
            type === 'success' ? 'bx-check-circle' :
            type === 'error' ? 'bx-error-circle' :
            'bx-info-circle'
          }"></i>
          <span class="text-sm font-medium">${escapeHtml(message)}</span>
        </div>
      `;
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    function setupNotificationPolling() {
      console.log('üîÑ Setting up notification polling every 30 seconds');
      setInterval(loadNotifications, 30000);
    }

    // ============================================
    // UI HELPER FUNCTIONS
    // ============================================
    function updateHeroSection(userData) {
      const heroHeading = document.getElementById('heroWelcome');
      if (heroHeading && userData.name) {
        const firstName = userData.name.split(' ')[0];
        heroHeading.textContent = `Welcome back, ${firstName}!`;
      }
    }

    function updateUserAvatar(userData) {
      const avatar = document.getElementById('userAvatar');
      if (avatar && userData.name) {
        const nameParts = userData.name.trim().split(' ');
        let initials = '';
        
        if (nameParts.length >= 2) {
          initials = nameParts[0][0] + nameParts[nameParts.length - 1][0];
        } else if (nameParts.length === 1 && nameParts[0].length > 0) {
          initials = nameParts[0][0];
          if (nameParts[0].length > 1) {
            initials += nameParts[0][1];
          }
        }
        
        avatar.textContent = initials.toUpperCase();
      }
    }

    function setActive(button) {
      document.querySelectorAll(".opportunity-btn").forEach((btn) => {
        btn.classList.remove("active", "bg-[#4b0d7f]", "text-white");
        btn.classList.add("bg-gray-300", "text-black");
      });

      button.classList.add("active", "bg-[#4b0d7f]", "text-white");
      button.classList.remove("bg-gray-300", "text-black");
    }

    // ============================================
    // SIDEBAR TOGGLE
    // ============================================
    const sidebarToggle = document.getElementById("sidebarToggle");
    const sidebar = document.querySelector(".sidebar");
    const overlay = document.getElementById("overlay");

    sidebarToggle.addEventListener("click", () => {
      sidebar.classList.toggle("active");
      overlay.classList.toggle("active");
    });

    overlay.addEventListener("click", () => {
      sidebar.classList.remove("active");
      overlay.classList.remove("active");
    });

    // ============================================
    // MODAL FUNCTIONS
    // ============================================
    function openModal(postId = null, postTitle = "") {
      console.log('üéØ Opening modal for post:', postId, postTitle);
      
      modal.classList.add("active");
      document.body.style.overflow = "hidden";
      
      resetForm();
      
      if (postId) {
        modal.dataset.postId = postId;
        currentPostTitle = postTitle;
        
        const titleElement = document.getElementById('modalOpportunityTitle');
        if (titleElement && postTitle) {
          titleElement.textContent = postTitle;
        }
        
        console.log('‚úÖ Modal opened with post ID:', postId);
      }
    }

    function closeModal() {
      console.log('üö™ Closing modal');
      modal.classList.remove("active");
      document.body.style.overflow = "auto";
      delete modal.dataset.postId;
      currentPostTitle = "";
      resetForm();
    }

    function resetForm() {
      selectedFile = null;
      document.getElementById('applicationForm').reset();
      document.getElementById('filePreview').classList.add('hidden');
      document.getElementById('uploadProgress').classList.add('hidden');
      document.getElementById('submitSection').classList.add('hidden');
      document.getElementById('uploadFirstNotice').classList.remove('hidden');
      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('uploadPercent').textContent = '0%';
    }

    function removeFile() {
      selectedFile = null;
      document.getElementById('cvFile').value = '';
      document.getElementById('filePreview').classList.add('hidden');
      document.getElementById('submitSection').classList.add('hidden');
      document.getElementById('uploadFirstNotice').classList.remove('hidden');
    }

    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("active")) {
        closeModal();
      }
    });

    // ============================================
    // FILE UPLOAD HANDLING
    // ============================================
    function setupFileUpload() {
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('cvFile');
      const filePreview = document.getElementById('filePreview');
      const fileName = document.getElementById('fileName');
      const fileSize = document.getElementById('fileSize');
      const submitSection = document.getElementById('submitSection');
      const uploadFirstNotice = document.getElementById('uploadFirstNotice');
      
      console.log('üîß Setting up file upload...');
      console.log('üìã Elements found:', {
        uploadArea: !!uploadArea,
        fileInput: !!fileInput,
        filePreview: !!filePreview,
        submitSection: !!submitSection
      });
      
      if (!uploadArea || !fileInput) {
        console.error('‚ùå Upload elements not found!');
        return;
      }
      
      uploadArea.addEventListener('click', () => {
        console.log('üìÅ Upload area clicked');
        fileInput.click();
      });
      
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('border-purple-500', 'bg-purple-50');
      });
      
      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('border-purple-500', 'bg-purple-50');
      });
      
      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('border-purple-500', 'bg-purple-50');
        
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          handleFileSelect();
        }
      });
      
      fileInput.addEventListener('change', handleFileSelect);
      
      function handleFileSelect() {
        const file = fileInput.files[0];
        console.log('üìÑ File selected:', file);
        
        if (!file) {
          console.error('‚ùå No file selected');
          return;
        }
        
        console.log('üìä File details:', {
          name: file.name,
          size: file.size,
          type: file.type
        });
        
        const validTypes = ['application/pdf', 'application/msword', 
                          'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                          'text/plain'];
        if (!validTypes.includes(file.type) && !file.name.match(/\.(pdf|doc|docx|txt)$/i)) {
          console.error('‚ùå Invalid file type:', file.type);
          alert('Please upload a PDF, DOC, DOCX, or TXT file');
          fileInput.value = '';
          return;
        }
        
        if (file.size > 10 * 1024 * 1024) {
          console.error('‚ùå File too large:', file.size);
          alert('File size must be less than 10MB');
          fileInput.value = '';
          return;
        }
        
        selectedFile = file;
        console.log('‚úÖ File validated and stored');
        
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);
        filePreview.classList.remove('hidden');
        
        submitSection.classList.remove('hidden');
        uploadFirstNotice.classList.add('hidden');
        
        console.log('‚úÖ Submit button shown');
      }
      
      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }
    }

    // ============================================
    // FORM SUBMISSION HANDLER
    // ============================================
    async function handleApplicationSubmit(e) {
      e.preventDefault();
      
      console.log('üöÄ Form submitted!');
      console.log('üìã Modal dataset:', modal?.dataset);
      
      const postId = modal?.dataset?.postId;
      console.log('üìã Post ID:', postId);
      
      if (!postId) {
        console.error('‚ùå No post ID found!');
        alert('No opportunity selected. Please try again.');
        return;
      }
      
      if (!selectedFile) {
        console.error('‚ùå No file selected!');
        alert('Please upload your CV first');
        return;
      }
      
      console.log('üìÑ Selected file:', selectedFile.name, selectedFile.size);
      
      const termsCheckbox = document.getElementById('termsCheckbox');
      if (!termsCheckbox?.checked) {
        alert('Please agree to the terms and conditions');
        return;
      }
      
      console.log('‚úÖ Validation passed, preparing submission...');
      
      const submitButton = document.getElementById('submitButton');
      const originalButtonText = submitButton.innerHTML;
      submitButton.disabled = true;
      submitButton.innerHTML = '<i class="bx bx-loader-alt animate-spin text-xl"></i> Submitting...';
      
      const uploadProgress = document.getElementById('uploadProgress');
      if (uploadProgress) {
        uploadProgress.classList.remove('hidden');
      }
      
      const formData = new FormData();
      formData.append('cv', selectedFile);
      formData.append('postId', postId);
      formData.append('postTitle', currentPostTitle);
      formData.append('subscribeToNewsletter', document.getElementById('newsletterCheckbox')?.checked || false);
      formData.append('termsAccepted', true);
      
      console.log('üì¶ FormData prepared:', {
        fileName: selectedFile.name,
        fileSize: selectedFile.size,
        postId: postId,
        postTitle: currentPostTitle
      });
      
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += 10;
        if (progress > 90) {
          clearInterval(progressInterval);
          return;
        }
        const progressBar = document.getElementById('progressBar');
        const uploadPercent = document.getElementById('uploadPercent');
        if (progressBar) progressBar.style.width = progress + '%';
        if (uploadPercent) uploadPercent.textContent = progress + '%';
      }, 200);
      
      try {
        console.log('üåê Sending request to /api/applications/submit...');
        
        const response = await fetch('/api/applications/submit', {
          method: 'POST',
          body: formData
        });
        
        console.log('üì¨ Response received:', response.status, response.statusText);
        
        clearInterval(progressInterval);
        const progressBar = document.getElementById('progressBar');
        const uploadPercent = document.getElementById('uploadPercent');
        if (progressBar) progressBar.style.width = '100%';
        if (uploadPercent) uploadPercent.textContent = '100%';
        
        const result = await response.json();
        console.log('üìä Response data:', result);
        
        if (response.ok) {
          console.log('‚úÖ Application submitted successfully!');
          
          showApplicationSuccess();
          
          setTimeout(() => {
            loadOpportunities();
          }, 1000);
          
          setTimeout(() => {
            closeModal();
            resetForm();
          }, 2000);
        } else {
          console.error('‚ùå Application failed:', result);
          
          const errorMessage = result.error || 'Application failed';
          const errorDetails = result.details || '';
          
          showError(
            'Application Failed',
            errorMessage,
            errorDetails
          );
          
          submitButton.disabled = false;
          submitButton.innerHTML = originalButtonText;
          if (uploadProgress) {
            uploadProgress.classList.add('hidden');
          }
        }
      } catch (error) {
        console.error('‚ùå Application error:', error);
        console.error('Error stack:', error.stack);
        clearInterval(progressInterval);
        
        showError(
          'Network Error',
          'Failed to submit application: ' + error.message,
          'Please check your internet connection and try again.'
        );
        
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
        if (uploadProgress) {
          uploadProgress.classList.add('hidden');
        }
      }
    }

    function showError(title, message, details) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'fixed top-4 right-4 bg-red-50 border-2 border-red-500 rounded-xl shadow-2xl p-6 max-w-md z-[200] animate-slideIn';
      errorDiv.innerHTML = `
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center flex-shrink-0">
            <i class="bx bx-error text-red-600 text-2xl"></i>
          </div>
          <div class="flex-1">
            <h4 class="font-bold text-gray-900 text-lg mb-1">${title}</h4>
            <p class="text-gray-700 text-sm mb-2">${message}</p>
            ${details ? `<p class="text-gray-500 text-xs font-mono bg-gray-100 p-2 rounded">${details}</p>` : ''}
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <i class="bx bx-x text-2xl"></i>
          </button>
        </div>
      `;
      
      document.body.appendChild(errorDiv);
      
      setTimeout(() => {
        errorDiv.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => errorDiv.remove(), 300);
      }, 10000);
    }

    function showApplicationSuccess() {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-white rounded-xl shadow-2xl p-6 max-w-md z-[200] animate-slideIn';
      notification.style.animation = 'modalSlideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1)';
      notification.innerHTML = `
        <div class="flex items-start gap-4">
          <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
            <i class="bx bx-check text-green-600 text-2xl"></i>
          </div>
          <div class="flex-1">
            <h4 class="font-bold text-gray-900 text-lg mb-1">Application Submitted!</h4>
            <p class="text-gray-600 text-sm leading-relaxed">
              Your CV and profile have been sent to the partner. 
              They will review your application and contact you soon.
            </p>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
            <i class="bx bx-x text-2xl"></i>
          </button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'fadeOut 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 5000);
    }

    // ============================================
    // LOAD OPPORTUNITIES
    // ============================================
    function loadOpportunities() {
      const container = document.getElementById('opportunitiesContainer');
      
      if (!container) {
        console.error('Opportunities container not found');
        return;
      }

      container.innerHTML = `
        <div class="bg-white rounded-2xl p-12 flex flex-col items-center justify-center text-center">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-[#4b0d7f] mb-4"></div>
          <p class="text-gray-600">Loading opportunities...</p>
        </div>
      `;

      fetch('/api/posts')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          console.log('Posts data received:', data);
          
          container.innerHTML = '';

          const posts = data.posts || [];
          console.log(`Found ${posts.length} posts`);

          if (posts.length > 0) {
            posts.forEach(post => {
              const opportunityCard = createOpportunityCard(post);
              container.appendChild(opportunityCard);
            });
          } else {
            container.innerHTML = `
              <div class="bg-white rounded-2xl p-12 flex flex-col items-center justify-center text-center">
                <i class="bx bx-briefcase text-6xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-bold text-gray-900 mb-2">No opportunities available</h3>
                <p class="text-gray-600 mb-4">Check back later for new speaking, podcast, and webinar opportunities.</p>
              </div>
            `;
          }
        })
        .catch(error => {
          console.error('Error loading opportunities:', error);
          container.innerHTML = `
            <div class="bg-white rounded-2xl p-12 flex flex-col items-center justify-center text-center">
              <i class="bx bx-error text-6xl text-red-400 mb-4"></i>
              <h3 class="text-xl font-bold text-gray-900 mb-2">Error loading opportunities</h3>
              <p class="text-gray-600 mb-4">${error.message}</p>
              <button onclick="loadOpportunities()" class="bg-[#4b0d7f] text-white px-6 py-3 rounded-xl font-semibold hover:bg-purple-800 transition-all">
                Try Again
              </button>
            </div>
          `;
        });
    }

    function getPostTypeIcon(postType) {
      const icons = {
        'speaking': 'bx-microphone',
        'podcast': 'bx-podcast',
        'webinar': 'bx-video',
        'volunteering': 'bx-heart'
      };
      return icons[postType.toLowerCase()] || 'bx-briefcase';
    }

    function getPostTypeColor(postType) {
      const colors = {
        'speaking': { bg: 'bg-purple-200', text: 'text-purple-800' },
        'podcast': { bg: 'bg-amber-200', text: 'text-amber-800' },
        'webinar': { bg: 'bg-sky-200', text: 'text-sky-800' },
        'volunteering': { bg: 'bg-pink-200', text: 'text-pink-800' }
      };
      return colors[postType.toLowerCase()] || colors['speaking'];
    }

function createOpportunityCard(post) {
  const card = document.createElement('article');
  card.className = 'bg-white rounded-2xl p-6 md:p-8 shadow-md hover:shadow-lg transition-all w-full max-w-full overflow-hidden';
  
  const color = getPostTypeColor(post.category || 'general');
  const icon = getPostTypeIcon(post.category || 'general');
  
  const createdDate = new Date(post.created_at).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
  
  const applicationStatus = post.applicationStatus || null;
  const hasApplied = post.hasApplied || false;
  
  let statusBadgeHtml = '';
  if (hasApplied && applicationStatus) {
    const statusConfig = {
      'pending': { bg: 'bg-yellow-100', text: 'text-yellow-800', icon: 'bx-time', label: 'Under Review' },
      'accepted': { bg: 'bg-green-100', text: 'text-green-800', icon: 'bx-check-circle', label: 'Accepted' },
      'rejected': { bg: 'bg-red-100', text: 'text-red-800', icon: 'bx-x-circle', label: 'Rejected' }
    };
    
    const config = statusConfig[applicationStatus] || statusConfig['pending'];
    statusBadgeHtml = `<span class="${config.bg} ${config.text} px-4 py-1.5 rounded-full text-sm font-semibold whitespace-nowrap flex items-center gap-1">
      <i class="bx ${config.icon}"></i> ${config.label}
    </span>`;
  }
  
  let applyButtonHtml;
  if (hasApplied) {
    if (applicationStatus === 'accepted') {
      applyButtonHtml = `<button disabled class="bg-green-400 text-white px-6 md:px-8 py-3 rounded-xl font-bold cursor-not-allowed opacity-75">‚úÖ Accepted</button>`;
    } else if (applicationStatus === 'rejected') {
      applyButtonHtml = `<button disabled class="bg-red-400 text-white px-6 md:px-8 py-3 rounded-xl font-bold cursor-not-allowed opacity-75">‚ùå Rejected</button>`;
    } else {
      applyButtonHtml = `<button disabled class="bg-yellow-400 text-white px-6 md:px-8 py-3 rounded-xl font-bold cursor-not-allowed opacity-75">‚è≥ Under Review</button>`;
    }
  } else {
    applyButtonHtml = `<button class="apply-now-button bg-[#4b0d7f] text-white px-6 md:px-8 py-3 rounded-xl font-bold hover:bg-purple-800 shadow-lg transition-all">Apply Now</button>`;
  }
  
  card.innerHTML = `
    <div class="flex items-start justify-between mb-4 flex-wrap gap-4 w-full">
      <div class="flex items-center gap-4 min-w-0 flex-1">
        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-purple-400 to-[#4b0d7f] flex items-center justify-center flex-shrink-0">
          <i class="bx ${icon} text-white text-2xl"></i>
        </div>
        <div class="min-w-0 flex-1">
          <h3 class="text-lg font-bold text-gray-900 truncate">Partner Opportunity</h3>
          <p class="text-sm text-gray-500">${createdDate}</p>
        </div>
      </div>
      <div class="flex gap-2 flex-wrap flex-shrink-0">
        <span class="${color.bg} ${color.text} px-4 py-1.5 rounded-full text-sm font-semibold capitalize whitespace-nowrap">${post.category || 'General'}</span>
        ${statusBadgeHtml}
      </div>
    </div>

    <h4 class="text-xl md:text-2xl font-bold text-gray-900 mb-3 break-words">${escapeHtml(post.title)}</h4>
    <p class="text-gray-700 text-base mb-6 leading-relaxed line-clamp-3 break-words">${escapeHtml(post.content)}</p>

    <div class="bg-[#4b0d7f] text-white px-6 py-4 rounded-xl mb-6 flex items-center justify-between flex-wrap gap-4">
      <span class="font-bold text-base md:text-lg whitespace-nowrap">Posted: ${createdDate}</span>
      <span class="font-semibold whitespace-nowrap">${hasApplied ? 'Applied' : 'Apply Now'}</span>
    </div>

    <div class="flex items-center justify-between flex-wrap gap-4">
      <div class="flex items-center gap-4 md:gap-6 flex-wrap">
        <button class="flex items-center gap-2 text-gray-600 hover:text-purple-700 transition-all">
          <i class="bx bx-heart text-2xl"></i>
          <span class="font-medium">0</span>
        </button>
        <button class="flex items-center gap-2 text-gray-600 hover:text-purple-700 transition-all">
          <i class="bx bx-comment text-2xl"></i>
          <span class="font-medium">0</span>
        </button>
        <div class="flex items-center gap-2 text-gray-600">
          <i class="bx bx-show text-2xl"></i>
          <span class="font-medium">0</span>
        </div>
      </div>
      <div class="flex items-center gap-3 flex-wrap">
        <button class="text-gray-600 hover:text-purple-700 p-2 hover:bg-gray-100 rounded-lg transition-all">
          <i class="bx bx-bookmark text-2xl"></i>
        </button>
        <button class="text-gray-600 hover:text-purple-700 p-2 hover:bg-gray-100 rounded-lg transition-all">
          <i class="bx bx-share-alt text-2xl"></i>
        </button>
        ${applyButtonHtml}
      </div>
    </div>
  `;
  
  // ATTACH EVENT LISTENER AFTER HTML IS CREATED
  if (!hasApplied) {
    const applyBtn = card.querySelector('.apply-now-button');
    if (applyBtn) {
      applyBtn.addEventListener('click', function() {
        console.log('üî• APPLY BUTTON CLICKED!');
        console.log('Post ID:', post.post_id);
        console.log('Post Title:', post.title);
        openModal(post.post_id, post.title);
      });
      console.log('‚úÖ Event listener attached successfully');
    } else {
      console.error('‚ùå ERROR: Apply button not found!');
    }
  }
  
  return card;
}
    // ============================================
    // INITIALIZE ON PAGE LOAD
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ Page loaded, initializing...');
      
      // Setup notifications
      setupNotificationBell();
      loadNotifications();
      setupNotificationPolling();
      
      // Setup file upload
      setupFileUpload();
      
      // Load opportunities
      loadOpportunities();
      
      // Attach form handler
      const applicationForm = document.getElementById('applicationForm');
      if (applicationForm) {
        console.log('‚úÖ Application form found, attaching handler');
        applicationForm.addEventListener('submit', handleApplicationSubmit);
      } else {
        console.error('‚ùå Application form NOT found!');
      }
      
      // Fetch user data and update UI
      fetch('/api/me')
        .then(response => {
          if (!response.ok) throw new Error('Not authenticated');
          return response.json();
        })
        .then(data => {
          console.log('User data:', data);
          
          const homeLink = document.getElementById('homeLink');
          if (homeLink && data.role) {
            if (data.role === 'partner') {
              homeLink.href = '/partner-dashboard.html';
            } else if (data.role === 'ambassador') {
              homeLink.href = '/ambassador-dashboard.html';
            } else if (data.role === 'admin') {
              homeLink.href = '/admin-dashboard.html';
            }
          }
          
          updateHeroSection(data);
          updateUserAvatar(data);
        })
        .catch(error => {
          console.error('Error fetching user data:', error);
          window.location.href = '/signin';
        });

      // Logout functionality
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          fetch('/logout', { method: 'POST' })
            .then(() => {
              window.location.href = '/signin';
            })
            .catch(error => {
              console.error('Logout error:', error);
              window.location.href = '/signin';
            });
        });
      }
    });

    // Make functions available globally
    window.setActive = setActive;
    window.openModal = openModal;
    window.closeModal = closeModal;
    window.loadOpportunities = loadOpportunities;
    window.removeFile = removeFile;
    window.showApplicationSuccess = showApplicationSuccess;
    window.loadNotifications = loadNotifications;
    window.markNotificationRead = markNotificationRead;
    window.markAllNotificationsRead = markAllNotificationsRead;
    window.setupNotificationBell = setupNotificationBell;
    window.timeAgo = timeAgo;
    window.escapeHtml = escapeHtml;
    window.showToast = showToast;
  </script>
</body>
</html>