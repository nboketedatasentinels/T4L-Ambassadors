<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T4L Ambassador - Submit Article</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background: #f5f7fa;
        }

        .step-indicator {
            transition: all 0.3s ease;
        }

        .step-indicator.inactive {
            background: #e5e7eb;
            color: #6b7280;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .sidebar-link {
            transition: all 0.2s ease;
        }

        .input-field {
            transition: all 0.3s ease;
        }

        .input-field:focus {
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
            border-color: #7c3aed;
        }

        .guideline-item {
            transition: all 0.2s ease;
        }

        .guideline-item:hover {
            transform: translateX(4px);
            background: #fefce8;
        }

        .card-shadow {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .avatar-circle {
            background: #7c3aed;
            box-shadow: 0 4px 6px -1px rgba(124, 58, 237, 0.2), 0 2px 4px -1px rgba(124, 58, 237, 0.1);
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                height: 100vh;
                z-index: 50;
            }

            .sidebar.active {
                transform: translateX(0);
            }
        }

        /* Rich Text Editor Styles */
        #editor:empty:before {
            content: 'Start writing your article...';
            color: #9ca3af;
        }

        #editor:focus:before {
            content: '';
        }

        #editor {
            outline: none;
            line-height: 1.8;
            color: #1f2937; /* matches text-gray-800 */
        }

        #editor h1, #editor h2, #editor h3 {
            font-weight: bold;
            margin-top: 1.5em;
            margin-bottom: 0.75em;
        }

        #editor h1 {
            font-size: 2em;
        }

        #editor h2 {
            font-size: 1.5em;
        }

        #editor h3 {
            font-size: 1.25em;
        }

        #editor p {
            margin-bottom: 1em;
        }

        #editor ul, #editor ol {
            margin: 1em 0;
            padding-left: 2em;
        }

        #editor li {
            margin-bottom: 0.5em;
        }

        #editor a {
            color: #7c3aed;
            text-decoration: underline;
        }

        #editor img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            margin: 1em 0;
        }

        /* Loading Animations */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .animate-slideIn {
            animation: slideIn 0.3s ease-out;
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Global Notification Script -->
    <script src="/js/notifications.js"></script>
    <!-- Global Ambassador Sidebar -->
    <script src="/js/ambassador-sidebar.js"></script>
    <!-- Mobile Menu Toggle -->
    <button id="mobileMenuBtn" class="md:hidden fixed top-4 left-4 z-50 bg-purple-600 text-white p-3 rounded-xl shadow-lg">
        <i class="bx bx-menu text-2xl"></i>
    </button>

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar w-20 lg:w-20 md:w-20 bg-white shadow-md flex flex-col items-center py-6 space-y-6 z-40">
            <div class="mb-4">
                <div class="bg-[#4b0d7f] text-white px-3 py-2 rounded-xl font-semibold text-sm">T4L</div>
            </div>
            <nav class="flex flex-col space-y-4 text-gray-700 w-full">
                <a href="/ambassador-dashboard.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
                    <i class="bx bxs-home text-2xl text-[#4b0d9f] group-hover:scale-110 transition-transform duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Home</span>
                </a>
                <a href="/article-amb.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50 bg-purple-50">
                    <i class="bx bx-edit-alt text-2xl text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-[#4b0d9f] transition-colors duration-200">Publishing</span>
                </a>
                <a href="/journey.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
                    <i class="bx bx-line-chart text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Impact Log</span>
                </a>
                <a href="/Partner-Calls.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
                    <i class="bx bx-briefcase text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Partners</span>
                </a>
                <a href="https://www.t4leader.com/event" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
                    <i class="bx bx-calendar-event text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Events</span>
                </a>
        <a href="/services.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
          <i class="bx bx-briefcase-alt-2 text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
          <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Services</span>
        </a>
                <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
                    <i class="bx bx-user text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Profile</span>
                </a>
                <a href="/profile.html" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-purple-50">
                    <i class="bx bx-cog text-2xl group-hover:text-[#4b0d9f] group-hover:scale-110 transition-all duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-[#4b0d9f] transition-colors duration-200">Settings</span>
                </a>
                <div id="logoutBtn" class="flex flex-col items-center cursor-pointer group transition-all duration-200 py-2 px-3 rounded-lg hover:bg-red-50">
                    <i class="bx bx-log-out text-2xl group-hover:text-red-600 group-hover:scale-110 transition-all duration-200"></i>
                    <span class="text-[10px] mt-1.5 font-medium text-gray-600 group-hover:text-red-600 transition-colors duration-200">Logout</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
      <main class="flex-1">
        <!-- Top Navbar -->
        <header class="bg-white sticky top-0 z-30 border-b border-gray-200 shadow-sm">
          <div class="flex flex-col md:flex-row md:items-center justify-between p-4 md:p-6 gap-4">
            <h1 class="text-2xl font-bold text-gray-900">T4L Ambassador</h1>
            <div class="flex items-center space-x-4 w-full md:w-auto">
              <div class="relative flex-1 md:flex-none">
                <input
                  type="text"
                  placeholder="Search articles, events, partners..."
                  class="border border-gray-300 rounded-full pl-10 pr-4 py-2.5 text-sm w-full md:w-80 focus:outline-none focus:ring-2 focus:ring-purple-500 bg-gray-50"
                />
                <i class="bx bx-search absolute left-3 top-2.5 text-gray-500"></i>
              </div>
              <button class="relative p-2 hover:bg-gray-100 rounded-full transition-colors">
                <i class="bx bx-bell text-2xl text-gray-700"></i>
                <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
              </button>
              <div class="w-10 h-10 bg-gradient-to-br from-purple-600 to-purple-800 flex items-center justify-center rounded-full font-bold text-white shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                SM
              </div>
            </div>
          </div>
        </header>

        <!-- Main Content Area -->
        <div class="p-4 md:p-6 lg:p-8">

          <!-- Page Content -->
          <div class="max-w-7xl mx-auto">
                <!-- Submit Button & Steps -->
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-8 gap-4">
                    <button id="submitTop" class="bg-[#4b0d9f] text-white px-10 py-3 rounded-xl font-bold shadow-lg">
                        Submit
                    </button>

 
                <!-- Progress Steps with Stylish Borders -->
                <div class="flex items-center gap-2 md:gap-4 overflow-x-auto">
                <!-- Active Step -->
                <a href="https://gamma.app/docs/COMMUNITY-ARTICLE-GUIDELINES-OVERVIEW-obkq8cd4z49qfvq?mode=doc" class="active flex items-center gap-2 px-4 md:px-6 py-2 rounded-lg bg-[#4b0d9f] text-white font-semibold shadow-md border-2 border-[#4b0d7f] hover:border-[#4b0d7f] hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] whitespace-nowrap cursor-pointer">
                    <span class="w-7 h-7 bg-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm">1</span>
                    <span class="text-sm md:text-base">Article Writing Guidelines</span>
                </a>

                <!-- Inactive Step -->
                <a href="/ambassador-review.html" class="step-indicator inactive flex items-center gap-2 px-4 md:px-6 py-2 rounded-lg bg-blue-100 text-gray-700 font-medium shadow-sm border-2 border-gray-300 hover:border-gray-400 hover:shadow-md transition-all duration-200 transform hover:scale-[1.02] whitespace-nowrap cursor-pointer">
                    <span class="w-7 h-7 bg-gray-300 text-gray-700 rounded-full flex items-center justify-center font-bold text-sm">2</span>
                    <span class="text-sm md:text-base">Review</span>
                </a>

                <!-- Inactive Step -->
                <div class="step-indicator inactive flex items-center gap-2 px-4 md:px-6 py-2 rounded-lg bg-gray-100 text-gray-700 font-medium shadow-sm border-2 border-gray-300 hover:border-gray-400 hover:shadow-md transition-all duration-200 transform hover:scale-[1.02] whitespace-nowrap cursor-pointer">
                    <span class="w-7 h-7 bg-gray-300 text-gray-700 rounded-full flex items-center justify-center font-bold text-sm">3</span>
                    <span class="text-sm md:text-base">Publish</span>
                </div>

                <!-- Track Progress Button -->
                <a href="/article-progress.html" class="step-indicator flex items-center gap-2 px-4 md:px-6 py-2 rounded-lg bg-purple-600 text-white font-semibold shadow-md hover:bg-purple-700 hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] whitespace-nowrap cursor-pointer">
                    <i class="bx bx-line-chart text-xl"></i>
                    <span class="text-sm md:text-base">Track Progress</span>
                </a>
                </div>


                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Column - Form -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Article Title -->
                        <div class="bg-white rounded-2xl p-6 card-shadow">
                            <label class="block text-gray-900 font-bold mb-3">
                                Article Title <span class="text-red-500">*</span>
                            </label>
                            <input 
                                id="articleTitle"
                                type="text" 
                                placeholder="Article Title" 
                                class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none bg-gray-50"
                            >
                        </div>

                        <!-- Article Content -->
                        <div class="bg-white rounded-2xl p-6 card-shadow">
                            <label class="block text-gray-900 font-bold mb-3">
                                Article Content <span class="text-red-500">*</span>
                            </label>
                            
                            <!-- Toolbar -->
                            <div class="flex flex-wrap items-center gap-2 p-3 bg-gray-100 rounded-t-xl border-2 border-gray-200 border-b-0">
                                <!-- Text Formatting -->
                                <button type="button" onclick="formatText('bold')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Bold">
                                    <i class="bx bx-bold text-xl"></i>
                                </button>
                                <button type="button" onclick="formatText('italic')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Italic">
                                    <i class="bx bx-italic text-xl"></i>
                                </button>
                                <button type="button" onclick="formatText('underline')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Underline">
                                    <i class="bx bx-underline text-xl"></i>
                                </button>
                                <button type="button" onclick="formatText('strikeThrough')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Strikethrough">
                                    <i class="bx bx-strikethrough text-xl"></i>
                                </button>
                                
                                <div class="w-px h-6 bg-gray-300"></div>
                                
                                <!-- Alignment -->
                                <button type="button" onclick="formatText('justifyLeft')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Align Left">
                                    <i class="bx bx-align-left text-xl"></i>
                                </button>
                                <button type="button" onclick="formatText('justifyCenter')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Align Center">
                                    <i class="bx bx-align-middle text-xl"></i>
                                </button>
                                <button type="button" onclick="formatText('justifyRight')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Align Right">
                                    <i class="bx bx-align-right text-xl"></i>
                                </button>
                                <button type="button" onclick="formatText('justifyFull')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Justify">
                                    <i class="bx bx-align-justify text-xl"></i>
                                </button>
                                
                                <div class="w-px h-6 bg-gray-300"></div>
                                
                                <!-- Lists -->
                                <button type="button" onclick="formatText('insertUnorderedList')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Bullet List">
                                    <i class="bx bx-list-ul text-xl"></i>
                                </button>
                                <button type="button" onclick="formatText('insertOrderedList')" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Numbered List">
                                    <i class="bx bx-list-ol text-xl"></i>
                                </button>
                                
                                <div class="w-px h-6 bg-gray-300"></div>
                                
                                <!-- Headings -->
                                <select onchange="formatText('formatBlock', this.value); this.selectedIndex=0;" class="px-3 py-1 bg-white border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <option value="" selected disabled>Heading</option>
                                    <option value="h1">Heading 1</option>
                                    <option value="h2">Heading 2</option>
                                    <option value="h3">Heading 3</option>
                                    <option value="p">Paragraph</option>
                                </select>
                                
                                <div class="w-px h-6 bg-gray-300"></div>
                                
                                <!-- Link -->
                                <button type="button" onclick="addLink()" class="p-2 hover:bg-gray-200 rounded-lg transition-colors" title="Insert Link">
                                    <i class="bx bx-link text-xl"></i>
                                </button>
                            </div>
                            
                            <!-- Editable Content Area -->
                            <div 
                                id="editor"
                                contenteditable="true"
                                class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-b-xl focus:outline-none bg-gray-50 min-h-[300px] max-h-[500px] overflow-y-auto"
                                placeholder="Start writing your article..."
                            ></div>
                        </div>

                        <!-- Byline Section -->
                        <div class="bg-white rounded-2xl p-6 card-shadow">
                            <div class="flex items-center gap-3 mb-6">
                                <i class='bx bx-user-circle text-3xl text-purple-600'></i>
                                <h3 class="text-lg font-bold text-gray-900">Author Byline</h3>
                            </div>

                            <div>
                                <label class="block text-gray-900 font-bold mb-2">
                                    Byline <span class="text-red-500">*</span>
                                </label>
                                <input 
                                    id="byline"
                                    type="text"
                                    placeholder="e.g: John Smith, Senior Product Manager at Tech Corp" 
                                    class="input-field w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none bg-gray-50"
                                />
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="flex justify-center pt-4">
                            <button 
                            id="submitBottom" 
                            class="bg-[#4b0d9f] text-white px-16 py-4 rounded-xl font-bold text-lg shadow-lg"
                            

                            >
                                Submit
                            </button>
                        </div>
                    </div>

                    <!-- Right Column - Guidelines & Help -->
                    <div class="space-y-6">
                        <!-- Guidelines Card -->
                        <div class="bg-white rounded-2xl p-6 card-shadow">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Guidelines</h3>
                            <div class="space-y-3">
                                <div class="guideline-item flex items-start gap-3 p-3 rounded-lg bg-gray-50">
                                    <span class="text-sm font-bold text-gray-700 flex-shrink-0">1.</span>
                                    <p class="text-sm text-gray-700 font-medium">Write in your authentic voice</p>
                                </div>
                                <div class="guideline-item flex items-start gap-3 p-3 rounded-lg bg-blue-50">
                                    <span class="text-sm font-bold text-gray-700 flex-shrink-0">2.</span>
                                    <p class="text-sm text-gray-700 font-medium">Share real experience and insight</p>
                                </div>
                                <div class="guideline-item flex items-start gap-3 p-3 rounded-lg bg-yellow-50">
                                    <span class="text-sm font-bold text-gray-700 flex-shrink-0">3.</span>
                                    <p class="text-sm text-gray-700 font-medium">Include specific examples</p>
                                </div>
                                <div class="guideline-item flex items-start gap-3 p-3 rounded-lg bg-gray-50">
                                    <span class="text-sm font-bold text-gray-700 flex-shrink-0">4.</span>
                                    <p class="text-sm text-gray-700 font-medium">Engage & Inspire readers</p>
                                </div>
                                <div class="guideline-item flex items-start gap-3 p-3 rounded-lg bg-gray-50">
                                    <span class="text-sm font-bold text-gray-700 flex-shrink-0">5.</span>
                                    <p class="text-sm text-gray-700 font-medium">Citation</p>
                                </div>
                            </div>
                        </div>

                        <!-- Help Card -->
                        <div class="bg-white rounded-2xl p-6 card-shadow text-center">
                            <div class="w-14 h-14 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="bx bx-message-dots text-3xl text-gray-700"></i>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900 mb-2">Need Help?</h3>
                            <p class="text-sm text-gray-600 mb-4">Our team is here to support you</p>
                            <button class="bg-[#4b0d9f] text-white px-8 py-3 rounded-xl font-bold w-full shadow-lg">
                                Contact Support
                            </button>
                        </div>
                    </div>
                </div>
          </div>
        </div>
      </main>
    </div>

    <script>
        // ‚úÖ ENHANCED TOAST WITH ICONS
        function showToast(msg, isError = false) {
            const div = document.createElement('div');
            
            const icon = isError 
                ? '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/></svg>'
                : '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/></svg>';
            
            div.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl text-white flex items-center gap-3 animate-slideIn ${
                isError ? 'bg-red-600' : 'bg-green-600'
            }`;
            
            div.innerHTML = `
                ${icon}
                <span class="font-semibold">${msg}</span>
            `;
            
            document.body.appendChild(div);
            
            setTimeout(() => {
                div.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => div.remove(), 300);
            }, 3000);
        }

        // ‚úÖ ADD NEW LOADING TOAST FUNCTIONS
        let loadingToastElement = null;

        function showLoadingToast(message) {
            // Remove any existing loading toast
            hideLoadingToast();
            
            const div = document.createElement('div');
            div.id = 'loadingToast';
            div.className = 'fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-2xl bg-white border-2 border-purple-500';
            div.innerHTML = `
                <div class="flex items-center gap-3">
                    <svg class="animate-spin h-6 w-6 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <div>
                        <p class="font-bold text-gray-900">${message}</p>
                        <p class="text-sm text-gray-600">Please wait...</p>
                    </div>
                </div>
            `;
            document.body.appendChild(div);
            loadingToastElement = div;
        }

        function hideLoadingToast() {
            if (loadingToastElement) {
                loadingToastElement.remove();
                loadingToastElement = null;
            }
            
            // Also remove by ID in case reference was lost
            const existingToast = document.getElementById('loadingToast');
            if (existingToast) {
                existingToast.remove();
            }
        }

        // Mobile sidebar toggle
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        mobileMenuBtn.addEventListener('click', () => { sidebar.classList.toggle('active'); });
        document.addEventListener('click', (e) => {
            if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        });

        // Auth check
        function checkAuth() {
            return fetch('/api/me', { credentials: 'include' })
                .then(r => { if (!r.ok) throw new Error(String(r.status)); return r.json(); })
                .then(me => {
                    if (!me || me.role !== 'ambassador') {
                        throw new Error('forbidden');
                    }
                    return me;
                })
                .catch(err => {
                    const redirectParam = encodeURIComponent(window.location.pathname);
                    if (err.message === '401') {
                        // Not logged in
                        window.location.href = `/signin?redirect=${redirectParam}`;
                        throw err;
                    }
                    if (err.message === 'forbidden' || err.message === '403') {
                        showToast('You do not have permission to submit articles.', true);
                        window.location.href = '/signin';
                        throw err;
                    }
                    // Unknown error -> force signin
                    window.location.href = `/signin?redirect=${redirectParam}`;
                    throw err;
                });
        }

        // Rich Text Editor Functions
        function formatText(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('editor').focus();
        }

        function addLink() {
            const url = prompt('Enter the URL:');
            if (url) {
                formatText('createLink', url);
            }
        }

        // Placeholder functionality
        function setupEditorPlaceholder() {
            const editor = document.getElementById('editor');
            if (!editor) return;
            
            editor.addEventListener('focus', function() {
                if (this.innerHTML === '') {
                    this.setAttribute('data-placeholder', '');
                }
            });
            editor.addEventListener('blur', function() {
                if (this.innerHTML === '') {
                    this.setAttribute('data-placeholder', 'Start writing your article...');
                }
            });
        }

        // ‚úÖ ENHANCED: Check if we're in edit mode and load article
        function checkEditModeAndLoadArticle() {
            const urlParams = new URLSearchParams(window.location.search);
            const editArticleId = urlParams.get('edit');
            
            if (editArticleId) {
                console.log('‚úÖ Edit mode detected for article:', editArticleId);
                showToast('Loading article for editing...');
                
                // Try multiple methods to get the article data
                let articleData = null;
                
                // Method 1: Try localStorage with the article ID
                const savedArticle = localStorage.getItem(`article_${editArticleId}`);
                if (savedArticle) {
                    try {
                        articleData = JSON.parse(savedArticle);
                        console.log('‚úÖ Article loaded from localStorage with ID method');
                    } catch (error) {
                        console.error('‚ùå Error loading article from localStorage:', error);
                    }
                }
                
                // Method 2: If still no data, try the editArticleId flag
                if (!articleData) {
                    const editFlagId = localStorage.getItem('editArticleId');
                    if (editFlagId === editArticleId) {
                        const flaggedArticle = localStorage.getItem(`article_${editFlagId}`);
                        if (flaggedArticle) {
                            try {
                                articleData = JSON.parse(flaggedArticle);
                                console.log('‚úÖ Article loaded from localStorage with flag method');
                            } catch (error) {
                                console.error('‚ùå Error loading flagged article:', error);
                            }
                        }
                    }
                }
                
                // Method 3: If still no data, fetch from server
                if (!articleData) {
                    console.log('üîÑ Article not in localStorage, fetching from server...');
                    fetchArticleForEditing(editArticleId);
                    return; // fetchArticleForEditing will handle population
                }
                
                // Populate the form with the found data
                populateFormWithArticle(articleData);
                showToast('Article loaded for editing');
                
            } else {
                console.log('üìù New article mode - no edit parameter detected');
            }
        }

        // ‚úÖ ENHANCED: Populate form with article data
        function populateFormWithArticle(articleData) {
            if (!articleData) {
                console.error('‚ùå No article data provided to populate form');
                showToast('Could not load article data', true);
                return;
            }

            console.log('üîÑ Populating form with article data:', {
                title: articleData.title,
                hasContent: !!articleData.contentHtml,
                byline: articleData.byline,
                fullData: articleData
            });

            // Populate title
            if (articleData.title) {
                document.getElementById('articleTitle').value = articleData.title;
            }

            // Populate content - handle both contentHtml and content fields
            let content = '';
            if (articleData.contentHtml) {
                content = articleData.contentHtml;
            } else if (articleData.content) {
                content = articleData.content;
            }
            
            if (content) {
                const editor = document.getElementById('editor');
                editor.innerHTML = content;
                // Remove any placeholder text
                editor.removeAttribute('data-placeholder');
            }

            // Populate byline
            if (articleData.byline) {
                document.getElementById('byline').value = articleData.byline;
            }
            
            // Update submit button to indicate editing mode
            const submitButtons = document.querySelectorAll('#submitTop, #submitBottom');
            submitButtons.forEach(btn => {
                if (btn) {
                    btn.textContent = 'Update Article';
                    btn.style.backgroundColor = '#dc2626'; // Red color for update
                    console.log('‚úÖ Submit buttons updated to "Update Article"');
                }
            });

            // Update page title to indicate editing
            document.title = `T4L Ambassador - Edit: ${articleData.title || 'Article'}`;
            
            console.log('‚úÖ Form populated successfully');
        }

        // ‚úÖ ENHANCED: Fetch article from server for editing
        function fetchArticleForEditing(articleId) {
            console.log('üîÑ Fetching article from server:', articleId);
            
            fetch(`/api/ambassador/articles/${articleId}`, {
                credentials: 'include'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: Failed to fetch article`);
                }
                return response.json();
            })
            .then(data => {
                if (data.article) {
                    console.log('‚úÖ Article fetched successfully from server');
                    populateFormWithArticle(data.article);
                    // Also save to localStorage for future edits and offline access
                    localStorage.setItem(`article_${articleId}`, JSON.stringify(data.article));
                    console.log('‚úÖ Article saved to localStorage for future edits');
                } else {
                    throw new Error('No article data in response');
                }
            })
            .catch(error => {
                console.error('‚ùå Error fetching article:', error);
                showToast('Could not load article for editing. Please try again.', true);
                
                // Try to load from sessionStorage as last resort
                const sessionArticle = sessionStorage.getItem(`article_${articleId}`);
                if (sessionArticle) {
                    try {
                        const articleData = JSON.parse(sessionArticle);
                        populateFormWithArticle(articleData);
                        showToast('Loaded from session storage');
                    } catch (e) {
                        console.error('Failed to load from sessionStorage:', e);
                    }
                }
            });
        }

        // Submission handling
        function collectAndValidate() {
            const title = (document.getElementById('articleTitle').value || '').trim();
            const contentHtml = (document.getElementById('editor').innerHTML || '').trim();
            const byline = (document.getElementById('byline').value || '').trim();
            const errors = [];
            if (!title) errors.push('Title is required');
            const textContent = contentHtml.replace(/<[^>]*>/g, '').trim();
            if (!textContent) errors.push('Content is required');
            if (!byline) errors.push('Byline is required');
            return { title, contentHtml, byline, errors };
        }

        // ‚úÖ ENHANCED SUBMIT FUNCTION WITH LOADING INDICATORS
        function submitArticle() {
            const { title, contentHtml, byline, errors } = collectAndValidate();
            if (errors.length) { 
                showToast(errors[0], true); 
                return; 
            }

            // ‚úÖ CHECK IF EDIT MODE
            const urlParams = new URLSearchParams(window.location.search);
            const editArticleId = urlParams.get('edit');
            
            const isEditMode = !!editArticleId;
            const endpoint = isEditMode ? `/api/ambassador/articles/${editArticleId}` : '/api/ambassador/articles';
            const method = isEditMode ? 'PATCH' : 'POST';

            console.log(`üîÑ ${isEditMode ? 'Updating' : 'Submitting'} article...`);

            // ‚úÖ SHOW LOADING STATE
            const submitButtons = document.querySelectorAll('#submitTop, #submitBottom');
            const originalButtonText = isEditMode ? 'Update Article' : 'Submit';
            const originalButtonHTML = [];
            
            submitButtons.forEach((btn, index) => {
                originalButtonHTML[index] = btn.innerHTML;
                btn.disabled = true;
                btn.innerHTML = `
                    <div class="flex items-center justify-center gap-2">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>${isEditMode ? 'Updating...' : 'Submitting...'}</span>
                    </div>
                `;
                btn.style.opacity = '0.7';
                btn.style.cursor = 'not-allowed';
            });

            // ‚úÖ SHOW LOADING TOAST
            showLoadingToast(isEditMode ? 'Updating article...' : 'Submitting article...');

            // ‚úÖ FIX: For edit mode, check current status and only reset if "needs_update"
            // Otherwise, preserve the admin's status (approved, published, etc.)
            const submitUpdate = async () => {
                let statusToSend = null;
                
                if (isEditMode) {
                    // Fetch current article to check its status
                    try {
                        const currentArticleResponse = await fetch(`/api/ambassador/articles/${editArticleId}`, {
                            credentials: 'include'
                        });
                        if (currentArticleResponse.ok) {
                            const currentArticleData = await currentArticleResponse.json();
                            const currentStatus = currentArticleData.article?.status || currentArticleData.status;
                            
                            // Only reset to "pending" if admin requested changes
                            // Preserve "approved", "published", etc.
                            if (currentStatus === 'needs_update') {
                                statusToSend = 'pending';
                                console.log('üîÑ Resetting status from "needs_update" to "pending"');
                            } else {
                                console.log(`‚úÖ Preserving current status: "${currentStatus}"`);
                                // Don't send status field - backend will preserve it
                            }
                        }
                    } catch (err) {
                        console.warn('‚ö†Ô∏è Could not fetch current article status, defaulting to preserve status:', err);
                        // If we can't fetch, don't send status to preserve existing one
                    }
                }

                return fetch(endpoint, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ 
                        title, 
                        contentHtml, 
                        byline,
                        // Only send status if we explicitly want to change it
                        ...(statusToSend && { status: statusToSend })
                    })
                });
            };

            // Ensure authenticated before submit
            checkAuth().then(() => {
                return submitUpdate();
            }).then(async res => {
                if (!res.ok) {
                    if (res.status === 401) {
                        const redirectParam = encodeURIComponent(window.location.pathname);
                        showToast('Please sign in to submit.', true);
                        window.location.href = `/signin?redirect=${redirectParam}`;
                        throw new Error('Unauthorized');
                    }
                    if (res.status === 403) {
                        showToast('You do not have permission to submit articles.', true);
                        throw new Error('Forbidden');
                    }
                    let msg = isEditMode ? 'Update failed' : 'Submission failed';
                    try { const j = await res.json(); if (j && j.error) msg = j.error; } catch(_) {}
                    throw new Error(msg);
                }
                return res.json();
            }).then((data) => {
                // ‚úÖ REMOVE LOADING STATE ON SUCCESS
                hideLoadingToast();
                
                const successMessage = isEditMode ? '‚úÖ Article updated successfully!' : '‚úÖ Article submitted for review!';
                showToast(successMessage);
                
                // ‚úÖ Get article ID from response
                const articleId = isEditMode ? editArticleId : (data.id || data.article?.id || data.article?.article_id);
                
                if (articleId) {
                  const articleData = {
                    id: articleId,
                    title: title,
                    contentHtml: contentHtml,
                    byline: byline,
                    status: isEditMode ? 'pending' : (data.status || data.article?.status || 'pending'),
                    createdAt: Date.now(),
                    updatedAt: isEditMode ? Date.now() : undefined
                  };
                  localStorage.setItem(`article_${articleId}`, JSON.stringify(articleData));
                  localStorage.setItem('lastSubmittedArticleId', articleId);
                  sessionStorage.setItem('currentArticleId', articleId);
                  
                  console.log('‚úÖ Article saved, redirecting to review page...');
                  
                  // ‚úÖ Show success message before redirect
                  setTimeout(() => {
                    window.location.href = '/ambassador-review.html';
                  }, 1500);
                } else {
                  // Fallback: just go to review page
                  setTimeout(() => {
                    window.location.href = '/ambassador-review.html';
                  }, 1500);
                }
            }).catch(err => {
                console.error('‚ùå Submission error:', err);
                
                // ‚úÖ RESTORE BUTTONS ON ERROR
                hideLoadingToast();
                submitButtons.forEach((btn, index) => {
                    btn.disabled = false;
                    btn.innerHTML = originalButtonHTML[index];
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                });
                
                if (err && (err.message === 'Unauthorized' || err.message === 'Forbidden')) return;
                showToast(err.message || (isEditMode ? 'Update failed' : 'Submission failed'), true);
            });
        }

        // Logout functionality
        function setupLogout() {
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                    fetch('/logout', { method: 'POST' })
                        .then(() => {
                            window.location.href = '/signin';
                        })
                        .catch(error => {
                            console.error('Logout error:', error);
                            window.location.href = '/signin';
                        });
                });
            }
        }

        function goToReviewPage() {
            const lastArticleId = localStorage.getItem('lastSubmittedArticleId');
            if (lastArticleId) {
                window.location.href = `/ambassador-review.html?articleId=${lastArticleId}`;
            } else {
                window.location.href = '/ambassador-review.html';
            }
        }

        function updateReviewPageLinks() {
            const lastArticleId = localStorage.getItem('lastSubmittedArticleId');
            const reviewLinks = document.querySelectorAll('a[href*="ambassador-review"]');
            
            reviewLinks.forEach(link => {
                const href = link.getAttribute('href') || '';
                if (!lastArticleId) return;
                if (href.includes('articleId=')) return;
                const separator = href.includes('?') ? '&' : '?';
                link.setAttribute('href', `${href}${separator}articleId=${lastArticleId}`);
            });
        }

        // Gate page on load and bind event listeners
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth().catch(() => {});
            
            // Setup editor placeholder
            setupEditorPlaceholder();
            
            // Setup logout
            setupLogout();
            
            // ‚úÖ ENHANCED: CHECK EDIT MODE AND LOAD ARTICLE
            checkEditModeAndLoadArticle();
            
            // Bind submit button event listeners after DOM is ready
            const submitTop = document.getElementById('submitTop');
            const submitBottom = document.getElementById('submitBottom');
            
            if (submitTop) {
                submitTop.addEventListener('click', submitArticle);
            }
            
            if (submitBottom) {
                submitBottom.addEventListener('click', submitArticle);
            }

            updateReviewPageLinks();
        });
    </script>
</body>
</html>